import{v as le,x as g,m as M,d as ie,y as re,z as ce,A as ue,i as de,j as B,q as ve,p as me,o as u,a as t,b as i,c as m,t as l,n as I,f as _e,F as G,r as $,k as te,s as ne,R as he}from"./index-BpniKF0S.js";import{u as fe,G as pe,_ as ge}from"./localization-CL7M9jiY.js";import{G as oe}from"./GeneralButton-BlePV9zY.js";import{u as we,a as xe}from"./questions-BV-D6sRM.js";const Ae=10,q=Ae*60*1e3,Ce=le(()=>{const{questions:ae,loadAll:D,loadSection:V,reset:L}=we(),d=g([]),x=g(new Map),v=g(new Map),A=g(!1),_=g(!1),C=g(null),Q=g(null),h=g(q),R=g(null),T=M(()=>{const n=[];for(const e of ae.values())e.type==="choice"&&n.push(e);return n}),N=(n=10)=>{const e=[...T.value],r=[];for(let s=0;s<Math.min(n,e.length);s++){const o=Math.floor(Math.random()*e.length);r.push(e[o]),e.splice(o,1)}return r},y=n=>{const e=[...n];for(let r=e.length-1;r>0;r--){const s=Math.floor(Math.random()*(r+1));[e[r],e[s]]=[e[s],e[r]]}return e},H=()=>{Q.value=Date.now(),h.value=q,R.value=window.setInterval(()=>{if(Q.value){const n=Date.now()-Q.value;h.value=Math.max(0,q-n),h.value<=0&&(S(),b())}},1e3)},S=()=>{R.value&&(clearInterval(R.value),R.value=null)},U=n=>{const e=Math.ceil(n/1e3),r=Math.floor(e/60),s=e%60;return`${r.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},P=async n=>{n?await V(n):await D(),d.value=N(10),x.value.clear();for(const e of d.value)e.options&&x.value.set(e.id,y(e.options));v.value.clear(),A.value=!0,_.value=!1,C.value=null,H()},z=(n,e)=>{_.value||v.value.set(n,e)},O=n=>v.value.get(n)??null,b=()=>{var s;if(_.value)return;S();const n=[];let e=0,r=0;for(const o of d.value){const f=v.value.get(o.id),w=(s=o.options)==null?void 0:s.find(k=>k.id===f),E=(w==null?void 0:w.isAnswer)??!1;n.push({questionId:o.id,selectedOptionId:f??null,isCorrect:E}),E?e++:r++}C.value={correctAnswers:e,wrongAnswers:r,totalQuestions:d.value.length,percentage:Math.round(e/d.value.length*100),answers:n},_.value=!0},j=()=>{S(),d.value=[],x.value.clear(),v.value.clear(),A.value=!1,_.value=!1,C.value=null,Q.value=null,h.value=q,L()},X=n=>x.value.get(n.id)??[],W=n=>d.value.find(e=>e.id===n),J=n=>{var e;return(e=C.value)==null?void 0:e.answers.find(r=>r.questionId===n)},K=M(()=>d.value.length>0&&v.value.size===d.value.length),Y=M(()=>v.value.size),c=M(()=>U(h.value)),F=M(()=>h.value<=3e4);return{examQuestions:d,userAnswers:v,isExamStarted:A,isExamFinished:_,examResults:C,timeRemaining:h,formattedTimeRemaining:c,isTimeRunningOut:F,startExam:P,selectAnswer:z,getSelectedAnswer:O,finishExam:b,resetExam:j,getRandomizedOptions:X,getQuestionById:W,getAnswerById:J,isAllQuestionsAnswered:K,answeredQuestionsCount:Y,stopTimer:S}}),Ee={class:"exam-header"},Se=["title"],ke={key:0,class:"loading"},Qe={key:1,class:"exam-content"},Re={class:"questions-list"},Te={class:"question-header"},ye={class:"question-number"},be={class:"question-text"},Ie={class:"options-list"},Me=["name","value","checked","onChange","disabled"],Oe={class:"option-text"},Be={class:"finish-section"},Ne={key:2,class:"results-content"},Ue={class:"results-header"},ze={class:"results-summary"},Fe={class:"result-item correct"},Ge={class:"result-label"},$e={class:"result-value"},qe={class:"result-item wrong"},De={class:"result-label"},Ve={class:"result-value"},Le={class:"result-item total"},He={class:"result-label"},Pe={class:"result-value"},je={class:"result-item percentage"},Xe={class:"result-label"},We={class:"result-value"},Je={class:"results-questions"},Ke={class:"question-header"},Ye={class:"question-number"},Ze={class:"question-text"},es={class:"options-list"},ss={class:"option-text"},ts={class:"actions"},ns=ie({__name:"ExamPage",setup(ae){const D=ve(),V=me(),L=xe(),{locale:d}=fe(),{examQuestions:x,isExamStarted:v,isExamFinished:A,examResults:_,startExam:C,selectAnswer:Q,getSelectedAnswer:h,finishExam:R,resetExam:T,getRandomizedOptions:N,getAnswerById:y,formattedTimeRemaining:H,isTimeRunningOut:S,isAllQuestionsAnswered:U,stopTimer:P}=Ce(),z=M(()=>V.params.sectionId),O=g(new Map),b=g(!1);re((s,o,f)=>{T(),f()}),ce(()=>{v.value&&T(),C(z.value).catch(console.error)}),ue(()=>{P()});const j=(s,o)=>{Q(s,o),b.value=!1},X=()=>{for(const s of x.value)if(h(s.id)===null)return s.id;return null},W=s=>{const o=O.value.get(s);o&&o.scrollIntoView({behavior:"smooth",block:"center"})},J=()=>{if(U.value)R(),window.scrollTo(0,0);else{b.value=!0;const s=X();s&&W(s)}},K=async()=>{T(),window.scrollTo(0,0),await C(z.value)},Y=()=>{T(),D.push({name:he.Home})},c=s=>L.t(d.value,s),F=s=>{if(!A.value)return"";const o=y(s);return o?o.isCorrect?"correct":"wrong":""},n=(s,o)=>{var k;if(!A.value)return"";const f=y(s);if(!f)return"";const w=x.value.find(a=>a.id===s),E=(k=w==null?void 0:w.options)==null?void 0:k.find(a=>a.id===o);return E?E.isAnswer?"correct-answer":f.selectedOptionId===o&&!f.isCorrect?"wrong-answer":"":""},e=(s,o)=>{o?O.value.set(s,o):O.value.delete(s)},r=s=>h(s)===null;return(s,o)=>(u(),de(pe,null,{topBar:B(()=>[t("div",Ee,[i(v)&&!i(A)?(u(),m("div",{key:0,class:I(["timer",{"time-running-out":i(S)}]),title:i(S)?c("Time is running out!"):c("Time remaining")},l(i(H)),11,Se)):_e("",!0)])]),default:B(()=>{var f,w,E,k;return[i(v)?i(A)?(u(),m("div",Ne,[t("div",Ue,[t("h2",null,l(c("Exam Results")),1),t("div",ze,[t("div",Fe,[t("span",Ge,l(c("Correct")),1),t("span",$e,l((f=i(_))==null?void 0:f.correctAnswers),1)]),t("div",qe,[t("span",De,l(c("Wrong")),1),t("span",Ve,l((w=i(_))==null?void 0:w.wrongAnswers),1)]),t("div",Le,[t("span",He,l(c("Total")),1),t("span",Pe,l((E=i(_))==null?void 0:E.totalQuestions),1)]),t("div",je,[t("span",Xe,l(c("Score")),1),t("span",We,l((k=i(_))==null?void 0:k.percentage)+"%",1)])])]),t("div",Je,[(u(!0),m(G,null,$(i(x),(a,Z)=>{var p,ee;return u(),m("div",{key:a.id,class:I(["result-question",F(a.id)])},[t("div",Ke,[t("span",Ye,l(Z+1)+".",1),t("span",Ze,l(a.question),1),t("span",{class:I(["result-indicator",(p=i(y)(a.id))!=null&&p.isCorrect?"correct":"wrong"])},l((ee=i(y)(a.id))!=null&&ee.isCorrect?"✓":"✗"),3)]),t("div",es,[(u(!0),m(G,null,$(i(N)(a),se=>(u(),m("div",{key:se.id,class:I(["option-item",n(a.id,se.id)])},[t("span",ss,l(se.value),1)],2))),128))])],2)}),128))]),t("div",ts,[te(oe,{onClick:K,class:"new-exam-button"},{default:B(()=>[ne(l(c("Start New Exam")),1)]),_:1}),te(oe,{onClick:Y,class:"home-button"},{default:B(()=>[ne(l(c("Go Home")),1)]),_:1})])])):(u(),m("div",Qe,[t("div",Re,[(u(!0),m(G,null,$(i(x),(a,Z)=>(u(),m("div",{key:a.id,class:I(["question-item",F(a.id),{"unanswered-highlight":b.value&&r(a.id)}]),ref_for:!0,ref:p=>e(a.id,p)},[t("div",Te,[t("span",ye,l(Z+1)+".",1),t("span",be,l(a.question),1)]),t("div",Ie,[(u(!0),m(G,null,$(i(N)(a),p=>(u(),m("label",{key:p.id,class:I(["option-item",n(a.id,p.id)])},[t("input",{type:"radio",name:`question-${a.id}`,value:p.id,checked:i(h)(a.id)===p.id,onChange:ee=>j(a.id,p.id),disabled:i(A)},null,40,Me),t("span",Oe,l(p.value),1)],2))),128))])],2))),128))]),t("div",Be,[te(oe,{onClick:J,class:"finish-button"},{default:B(()=>[ne(l(i(U)?c("Finish Exam"):c("Check Unanswered Questions")),1)]),_:1})])])):(u(),m("div",ke,l(c("Loading exam...")),1))]}),_:1}))}}),rs=ge(ns,[["__scopeId","data-v-d9f9f668"]]);export{rs as default};
