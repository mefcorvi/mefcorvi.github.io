import{p as de,l as te,q as j,s as pe,v as U,x as se,y as ve,z as we,A as f,B as _e,C as V,d as me,h as fe,i as L,n as d,b as s,D as ge,R as W,o as h,a as _,w as I,j as G,e as J,c as y,t as F,F as X,r as Y,f as q,m as he,E as ke}from"./index-DwRbg5NA.js";import{G as ye,m as Ae,S as Z,a as Ce,_ as Qe}from"./GeneralPage-BUgeCV3j.js";import{G as ze}from"./GeneralButton-Xw-qP9c3.js";import{u as be,a as xe}from"./questions-BSEUo4E2.js";const H=new WeakMap;function ee(r,e,i={}){const{mode:A="replace",route:v=de(),router:c=te(),transform:g=p=>p}=i;H.has(c)||H.set(c,new Map);const l=H.get(c);let t=v.params[r];ve(()=>{t=void 0});let a;const x=pe((p,k)=>(a=k,{get(){return p(),g(t!==void 0&&t!==""?t:U(e))},set(m){t!==m&&(t=m===e||m===null?void 0:m,l.set(r,m===e||m===null?void 0:m),k(),se(()=>{if(l.size===0)return;const w=Object.fromEntries(l.entries());l.clear();const{params:C,query:Q,hash:z}=v;c[U(A)]({params:{...C,...w},query:Q,hash:z})}))}}));return j(()=>v.params[r],p=>{t=p,a()},{flush:"sync"}),x}const Oe=we(()=>{const r=new Map,e=new Map,{questions:i,loadAll:A,loadSection:v}=be(),c=f(),g=_e({id:-1,value:"I don't know",isAnswer:!1}),l=()=>{let n=c.value;for(;n===c.value;)if(n=Me(i,r,e),!n)return n;return n},t=V(()=>{if(!c.value)return null;const n=i.get(c.value);if(!n)throw new Error(`Failed to get question by id ${c.value}`);return n}),a=f([]),x=()=>{var n;a.value=[...(((n=t.value)==null?void 0:n.options)??[]).sort(()=>Math.random()-.5),g]},p=f(),k=f(!1),m=n=>{c.value=n},w=n=>i.has(n),C=f(0),Q=f(0),z=()=>{C.value=0,Q.value=0},O=n=>{if(t.value&&t.value.type==="choice"){if(!a.value.includes(n))throw new Error("Current question does not have the selected option");p.value=n}},P=()=>{p.value&&t.value&&(p.value.isAnswer?(C.value++,r.set(t.value.id,(r.get(t.value.id)??0)+1),e.set(t.value.id,(e.get(t.value.id)??0)-1),(e.get(t.value.id)??0)<=0&&e.delete(t.value.id)):(Q.value++,e.set(t.value.id,(e.get(t.value.id)??0)+1),r.set(t.value.id,(r.get(t.value.id)??0)-1),(r.get(t.value.id)??0)<=0&&r.delete(t.value.id)))},b=()=>{t.value&&t.value.type==="text"&&(k.value=!0)};j(()=>{var n;return(n=t.value)==null?void 0:n.id},()=>{p.value=void 0,k.value=!1,x()},{immediate:!0,flush:"sync"});const R=V(()=>({correctQuestions:r.size,wrongQuestions:e.size,unansweredQuestions:i.size-r.size-e.size,totalQuestions:i.size,correctPercentage:r.size/i.size*100,wrongPercentage:e.size/i.size*100,unansweredPercentage:(i.size-r.size-e.size)/i.size*100}));return{startAll:async()=>{await A(),r.clear(),e.clear(),z()},startSection:async n=>{await v(n),r.clear(),e.clear(),z()},stat:R,correctCount:C,correctQuestions:r,wrongQuestions:e,currentOptionsRandomized:a,currentQuestion:t,isAnswerRevealed:k,selectedAnswer:p,wrongCount:Q,getRandomQuestionId:l,resetCount:z,updateCounters:P,revealAnswer:b,selectAnswer:O,setQuestion:m,hasQuestion:w}});function Me(r,e,i){if(Math.random()<i.size/10){const l=[...i.keys()];let t="";for(;l.length>0;){const a=Math.floor(Math.random()*l.length);if(t=l[a],r.has(t))return t;l.splice(a,1),i.delete(t)}}const A=Math.max(...e.values()),v=new Set;for(const[l,t]of e)t===A&&v.add(l);v.size===e.size&&v.clear();let c="";const g=[...r.keys()];for(;!c;){const l=g[Math.floor(Math.random()*g.length)];v.has(l)||(c=l)}return c}const Se=["src"],Te=["innerHTML"],Ie=me({__name:"QuestionPage",setup(r){const e=ge(),i=te(),A=xe(),{startAll:v,startSection:c,stat:g,isAnswerRevealed:l,currentOptionsRandomized:t,currentQuestion:a,getRandomQuestionId:x,revealAnswer:p,selectAnswer:k,updateCounters:m,selectedAnswer:w,setQuestion:C,hasQuestion:Q}=Oe(),z=V(()=>{var o;return((o=a.value)==null?void 0:o.note)!==void 0}),O=ee("id",""),P=ee("sectionId",""),b=f(),R=f(!1),N=()=>{if(O.value!=="")if(b.value=void 0,R.value=!1,Q(O.value))C(O.value);else{const o=x();if(!o){i.replace({name:W.Home});return}i.replace({params:{id:o}})}};j(O,N),P.value?c(P.value).then(N):v().then(N);let D;const n=f(!1);let S;const ne=()=>{b.value=void 0,window.clearTimeout(D),S=void 0,window.clearTimeout(S),n.value=!0,S=window.setTimeout(async()=>{S=void 0,await i.replace({params:{id:x()}}),await ke(w).toBeUndefined(),await se(),n.value=!1},parseInt(e.pageFadeOutDuration,10))},E=()=>{var o,u;if(!S&&!(((o=a.value)==null?void 0:o.type)==="choice"&&!w.value)){if(((u=a.value)==null?void 0:u.type)==="text"&&!l.value){p();return}ne()}},oe=o=>{const u=[];return o.id===-1&&u.push(e.dontKnowOption),w.value?w.value.isAnswer?o===w.value?e.correct:(u.push(e["wrong-fade"]),u):o===b.value?(u.push(e["correct-blinking"]),u):o.isAnswer?(u.push(e.correct),u):(u.push(e.wrong),u):u},ae=o=>{if(w.value){E();return}if(k(o),m(),!o.isAnswer){const u=t.value.find(B=>B.isAnswer);b.value=u}D=window.setTimeout(()=>{b.value=void 0},1e3)},$=f("es"),re=o=>{ce(o)||E()},ie=()=>{var o;(o=window.getSelection())!=null&&o.isCollapsed&&($.value==="es"?$.value="ru":$.value="es")},T=o=>A.t($.value,o),le=()=>{R.value=!0},ue=()=>{i.push({name:W.Settings})};function ce(o){const u=o.target;return u.tagName==="BUTTON"||u.tagName==="A"}return(o,u)=>(h(),fe(ye,{onClick:re,class:d({[s(e).fadeOut]:n.value})},{topBar:L(()=>[_("div",{class:d(s(e).navigation)},[_("div",{class:d([{[s(e).disabled]:!z.value}]),onClick:I(le,["stop"])},[G(Z,{type:"mdi",path:s(Ae)},null,8,["path"])],2),_("div",{onClick:I(ue,["stop"])},[G(Z,{type:"mdi",path:s(Ce)},null,8,["path"])])],2)]),default:L(()=>{var B;return[_("div",{class:d(s(e).progress)},[_("div",{class:d(s(e).correctAnswers),style:J({width:`${s(g).correctPercentage}%`})},null,6),_("div",{class:d(s(e).wrongAnswers),style:J({width:`${s(g).wrongPercentage}%`})},null,6)],2),s(a)?(h(),y("div",{key:0,class:d(s(e).question)},[_("div",{class:d(s(e).text),onClick:I(ie,["stop"])},[_("div",null,[_("div",{class:d(s(e).sectionTitle)},F(T(s(a).section.title)),3),_("div",null,F(T(s(a).question)),1)])],2),_("div",{class:d(s(e).answers)},[s(a).type==="choice"?(h(!0),y(X,{key:0},Y(s(t),M=>(h(),y("div",{key:`${s(a).id}-${M.id}`,class:d(s(e).option)},[G(ze,{onClick:I(K=>ae(M),["stop"]),disabled:!!s(w),class:d([s(e).button,oe(M)])},{default:L(()=>[he(F(T(M.value)),1)]),_:2},1032,["onClick","disabled","class"])],2))),128)):q("",!0),s(a).type==="text"?(h(),y("div",{key:1,class:d([s(e).answer,s(l)?"":s(e).hiddenAnswer]),onClick:I(E,["stop"])},[(h(!0),y(X,null,Y(T(s(a).answer).split(`
`),(M,K)=>(h(),y("p",{key:K},F(M),1))),128))],2)):q("",!0)],2),(B=s(a))!=null&&B.note?(h(),y("div",{key:s(a).id,class:d(["scroll",[s(e).note,{[s(e).hidden]:!s(w)||n.value}]])},[s(a).noteImage?(h(),y("img",{key:0,src:`/notes/${s(a).noteImage}`},null,8,Se)):q("",!0),_("div",{innerHTML:T(s(a).note)},null,8,Te)],2)):q("",!0)],2)):q("",!0)]}),_:1},8,["class"]))}}),qe="200ms",Pe="_counter_1plem_4",Re="_question_1plem_8",Ne="_text_1plem_15",$e="_answers_1plem_46",Be="_option_1plem_56",Fe="_fadeOut_1plem_60",De="_button_1plem_66",Ee="_correct_1plem_66",Le="_success_1plem_1",Ge="_wrong_1plem_73",He="_next_1plem_80",Ve="_answer_1plem_46",je="_hiddenAnswer_1plem_93",Ke="_navigation_1plem_96",Ue="_back_1plem_103",We="_forward_1plem_107",Je="_disabled_1plem_116",Xe="_progress_1plem_120",Ye="_correctAnswers_1plem_129",Ze="_wrongAnswers_1plem_135",et="_note_1plem_153",tt="_hidden_1plem_93",st="_sectionTitle_1plem_201",nt={pageFadeOutDuration:qe,counter:Pe,question:Re,text:Ne,answers:$e,option:Be,fadeOut:Fe,button:De,correct:Ee,"correct-blinking":"_correct-blinking_1plem_70",success:Le,wrong:Ge,"wrong-fade":"_wrong-fade_1plem_77",next:He,answer:Ve,hiddenAnswer:je,navigation:Ke,back:Ue,forward:We,disabled:Je,progress:Xe,correctAnswers:Ye,wrongAnswers:Ze,note:et,hidden:tt,sectionTitle:st},ot={$style:nt},ut=Qe(Ie,[["__cssModules",ot]]);export{ut as default};
