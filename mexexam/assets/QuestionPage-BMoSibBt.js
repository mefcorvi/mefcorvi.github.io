import{q as ue,m as ee,h as G,s as le,v as H,x as te,y as ce,z as de,A,B as R,C as ve,d as we,i as ge,j as E,n as p,b as n,D as pe,o as b,a as _,w as I,k as F,t as y,c as O,F as J,r as X,f as $,p as _e,R as Y,E as fe}from"./index-CoqqePcj.js";import{u as me,G as he,m as Ae,S as Z,a as ke,_ as ye}from"./localization-DftHOjfF.js";import{G as Qe}from"./GeneralButton-BdtpEo5H.js";import{u as je,a as Ce}from"./questions-Cq92112M.js";const D=new WeakMap;function V(r,e,l={}){const{mode:m="replace",route:c=ue(),router:w=ee(),transform:d=f=>f}=l;D.has(w)||D.set(w,new Map);const u=D.get(w);let v=c.params[r];ce(()=>{v=void 0});let i;const t=le((f,z)=>(i=z,{get(){return f(),d(v!==void 0&&v!==""?v:H(e))},set(g){v!==g&&(v=g===e||g===null?void 0:g,u.set(r,g===e||g===null?void 0:g),z(),te(()=>{if(u.size===0)return;const Q=Object.fromEntries(u.entries());u.clear();const{params:h,query:q,hash:S}=c;w[H(m)]({params:{...h,...Q},query:q,hash:S})}))}}));return G(()=>c.params[r],f=>{v=f,i()},{flush:"sync"}),t}const be=de(()=>{const r=A(new Map),e=A(new Map),{questions:l,loadAll:m,loadSection:c,reset:w}=je(),d=R(()=>{const a=new Map;for(const C of l.values())C.type==="choice"&&a.set(C.id,C);return a}),u=A(),v=ve({id:-1,value:"I don't know",isAnswer:!1}),i=()=>{let a=u.value;for(;a===u.value&&d.value.size>1;)if(a=ze(d.value,r.value,e.value),!a)return a;return a},t=R(()=>{if(!u.value)return null;const a=l.get(u.value);return a||null}),f=A([]),z=()=>{var a;f.value=[...(((a=t.value)==null?void 0:a.options)??[]).sort(()=>Math.random()-.5),v]},g=A(),Q=A(!1),h=a=>{u.value=a},q=a=>l.has(a),S=a=>{if(t.value&&t.value.type==="choice"){if(!f.value.includes(a))throw new Error("Current question does not have the selected option");g.value=a}},x=()=>{g.value&&t.value&&(g.value.isAnswer?(r.value.set(t.value.id,(r.value.get(t.value.id)??0)+1),e.value.set(t.value.id,(e.value.get(t.value.id)??0)-1),(e.value.get(t.value.id)??0)<=0&&e.value.delete(t.value.id)):(e.value.set(t.value.id,(e.value.get(t.value.id)??0)+1),r.value.set(t.value.id,(r.value.get(t.value.id)??0)-1),(r.value.get(t.value.id)??0)<=0&&r.value.delete(t.value.id)))},L=()=>{t.value&&t.value.type==="text"&&(Q.value=!0)};G(()=>{var a;return(a=t.value)==null?void 0:a.id},()=>{g.value=void 0,Q.value=!1,z()},{immediate:!0,flush:"sync"});const j=R(()=>({correctQuestions:r.value.size,wrongQuestions:e.value.size,unansweredQuestions:d.value.size-r.value.size-e.value.size,totalQuestions:d.value.size,correctPercentage:r.value.size/d.value.size*100,wrongPercentage:e.value.size/d.value.size*100,unansweredPercentage:(d.value.size-r.value.size-e.value.size)/d.value.size*100}));return{startAll:async()=>{await m(),r.value.clear(),e.value.clear()},startSection:async a=>{w(),await c(a),r.value.clear(),e.value.clear()},stat:j,correctCount:R(()=>r.value),correctQuestions:r,wrongQuestions:e,currentOptionsRandomized:f,currentQuestion:t,isAnswerRevealed:Q,selectedAnswer:g,wrongCount:R(()=>e.value.size),getRandomQuestionId:i,updateCounters:x,revealAnswer:L,selectAnswer:S,setQuestion:h,hasQuestion:q}});function ze(r,e,l){const m=[...r.keys()],c=m.map(w=>l.has(w)?5:e.has(w)?1/(e.get(w)||1)**2:10);return xe(m,c)}function xe(r,e){if(r.length!==e.length)throw new Error("Длины массивов values и weights должны совпадать.");const l=r.length;if(l===0)throw new Error("Массив values не должен быть пустым.");const m=e.reduce((i,t)=>i+t,0);if(m===0)throw new Error("Сумма весов не должна быть равна 0.");const c=new Array(l);for(let i=0;i<l;i++)c[i]=e[i]/m*l;const w=new Array(l),d=[],u=[];for(let i=0;i<l;i++)c[i]<1?d.push(i):u.push(i);for(;d.length>0&&u.length>0;){const i=d.pop(),t=u.pop();w[i]=t,c[t]=c[t]+c[i]-1,c[t]<1?d.push(t):u.push(t)}for(;d.length>0;)c[d.pop()]=1;for(;u.length>0;)c[u.pop()]=1;const v=Math.floor(Math.random()*l);return Math.random()<c[v]?r[v]:r[w[v]]}const Oe=we({__name:"QuestionPage",setup(r){const e=pe(),l=ee(),m=Ce(),{locale:c}=me(),{startAll:w,startSection:d,stat:u,isAnswerRevealed:v,currentOptionsRandomized:i,currentQuestion:t,getRandomQuestionId:f,revealAnswer:z,selectAnswer:g,updateCounters:Q,selectedAnswer:h,setQuestion:q,hasQuestion:S}=be(),x=V("id",""),L=V("sectionId",""),j=A(),U=()=>{if(x.value!=="")if(j.value=void 0,S(x.value))q(x.value);else{const s=f();if(!s){l.replace({name:Y.Home});return}l.replace({params:{id:s}})}},M=A(!1);G(()=>[x.value,L.value],async(s,o)=>{o||(o=["",""]),!(!s[0]&&!s[1])&&(s[0]===o[0]&&s[1]===o[1]||((s[1]!==o[1]||!o[1])&&(s[1]?(M.value=!1,await d(s[1])):M.value||(M.value=!0,await w())),U()))},{immediate:!0});let a;const C=A(!1);let T;const se=()=>{j.value=void 0,window.clearTimeout(a),T=void 0,window.clearTimeout(T),C.value=!0,T=window.setTimeout(async()=>{T=void 0,await l.replace({params:{id:f()}}),await fe(h).toBeUndefined(),await te(),C.value=!1},parseInt(e.pageFadeOutDuration,10))},N=()=>{var s,o;if(!T&&!(((s=t.value)==null?void 0:s.type)==="choice"&&!h.value)){if(((o=t.value)==null?void 0:o.type)==="text"&&!v.value){z();return}se()}},ne=s=>{const o=[];return s.id===-1&&o.push(e.dontKnowOption),h.value?h.value.isAnswer?s===h.value?e.correct:(o.push(e["wrong-fade"]),o):s===j.value?(o.push(e["correct-blinking"]),o):s.isAnswer?(o.push(e.correct),o):(o.push(e.wrong),o):o},ae=s=>{if(h.value){N();return}if(g(s),Q(),!s.isAnswer){const o=i.value.find(k=>k.isAnswer);j.value=o}a=window.setTimeout(()=>{j.value=void 0},1e3)},B=A("es"),re=s=>{ie(s)||N()},W=()=>{var s;(s=window.getSelection())!=null&&s.isCollapsed&&(B.value==="es"?B.value=c.value:B.value="es")},P=s=>m.t(B.value,s),oe=()=>{l.push({name:Y.Settings})};function ie(s){const o=s.target;return o.tagName==="BUTTON"||o.tagName==="A"}return(s,o)=>(b(),ge(he,{onClick:re,class:p({[n(e).fadeOut]:C.value})},{topBar:E(()=>[_("div",{class:p(n(e).navigation)},[_("div",{onClick:I(W,["stop"]),class:p(n(e).languageButton)},[F(Z,{type:"mdi",path:n(Ae)},null,8,["path"]),_("span",{class:p(n(e).languageLabel)},y(B.value.toUpperCase()),3)],2),_("div",{onClick:I(oe,["stop"])},[F(Z,{type:"mdi",path:n(ke)},null,8,["path"])])],2)]),default:E(()=>[_("div",{class:p(n(e).progress)},[_("div",{class:p(n(e).correctAnswers)},y(n(u).correctQuestions),3),_("div",{class:p(n(e).wrongAnswers)},y(n(u).wrongQuestions),3),_("div",{class:p(n(e).allAnswers)},y(n(u).totalQuestions),3)],2),n(t)?(b(),O("div",{key:0,class:p(n(e).question)},[_("div",{class:p(n(e).text),onClick:I(W,["stop"])},[_("div",null,[_("div",{class:p(n(e).sectionTitle)},y(P(n(t).section.title)),3),_("div",null,y(P(n(t).question)),1)])],2),_("div",{class:p(n(e).answers)},[n(t).type==="choice"?(b(!0),O(J,{key:0},X(n(i),k=>(b(),O("div",{key:`${n(t).id}-${k.id}`,class:p(n(e).option)},[F(Qe,{onClick:I(K=>ae(k),["stop"]),disabled:!!n(h),class:p([n(e).button,ne(k)])},{default:E(()=>[_e(y(P(k.value)),1)]),_:2},1032,["onClick","disabled","class"])],2))),128)):$("",!0),n(t).type==="text"?(b(),O("div",{key:1,class:p([n(e).answer,n(v)?"":n(e).hiddenAnswer]),onClick:I(N,["stop"])},[(b(!0),O(J,null,X(P(n(t).answer).split(`
`),(k,K)=>(b(),O("p",{key:K},y(k),1))),128))],2)):$("",!0)],2)],2)):$("",!0)]),_:1},8,["class"]))}}),qe="200ms",Se="_counter_1r7j1_4",Te="_question_1r7j1_8",Be="_text_1r7j1_15",Re="_answers_1r7j1_46",Ie="_option_1r7j1_56",Me="_fadeOut_1r7j1_60",Pe="_button_1r7j1_66",Le="_correct_1r7j1_66",Ne="_success_1r7j1_1",Ee="_wrong_1r7j1_73",Fe="_next_1r7j1_80",$e="_answer_1r7j1_46",De="_hiddenAnswer_1r7j1_93",Ge="_navigation_1r7j1_96",Ue="_back_1r7j1_103",We="_forward_1r7j1_107",Ke="_disabled_1r7j1_116",He="_progress_1r7j1_120",Je="_correctAnswers_1r7j1_133",Xe="_wrongAnswers_1r7j1_137",Ye="_allAnswers_1r7j1_141",Ze="_sectionTitle_1r7j1_156",Ve="_languageButton_1r7j1_160",et="_languageLabel_1r7j1_175",tt={pageFadeOutDuration:qe,counter:Se,question:Te,text:Be,answers:Re,option:Ie,fadeOut:Me,button:Pe,correct:Le,"correct-blinking":"_correct-blinking_1r7j1_70",success:Ne,wrong:Ee,"wrong-fade":"_wrong-fade_1r7j1_77",next:Fe,answer:$e,hiddenAnswer:De,navigation:Ge,back:Ue,forward:We,disabled:Ke,progress:He,correctAnswers:Je,wrongAnswers:Xe,allAnswers:Ye,sectionTitle:Ze,languageButton:Ve,languageLabel:et},st={$style:tt},it=ye(Oe,[["__cssModules",st]]);export{it as default};
