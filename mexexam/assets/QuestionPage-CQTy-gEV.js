import{p as de,l as se,q as j,s as ve,v as J,x as te,y as we,z as _e,A as x,B as M,C as fe,d as pe,h as ge,i as G,n as _,b as s,D as he,o as A,a as g,w as P,j as H,t as Q,c as k,F as X,r as Y,f as B,m as me,R as Z,E as xe}from"./index-Ba8279V5.js";import{G as Ae,m as ke,S as V,a as ye,_ as Qe}from"./GeneralPage-Dd5Akdmf.js";import{G as Ce}from"./GeneralButton-D-qznZJK.js";import{u as ze,a as be}from"./questions-DsOehLP2.js";const W=new WeakMap;function ee(r,e,l={}){const{mode:h="replace",route:c=de(),router:p=se(),transform:i=m=>m}=l;W.has(p)||W.set(p,new Map);const d=W.get(p);let v=c.params[r];we(()=>{v=void 0});let t;const n=ve((m,C)=>(t=C,{get(){return m(),i(v!==void 0&&v!==""?v:J(e))},set(w){v!==w&&(v=w===e||w===null?void 0:w,d.set(r,w===e||w===null?void 0:w),C(),te(()=>{if(d.size===0)return;const f=Object.fromEntries(d.entries());d.clear();const{params:S,query:T,hash:I}=c;p[J(h)]({params:{...S,...f},query:T,hash:I})}))}}));return j(()=>c.params[r],m=>{v=m,t()},{flush:"sync"}),n}const Oe=_e(()=>{const r=x(new Map),e=x(new Map),{questions:l,loadAll:h,loadSection:c,reset:p}=ze(),i=M(()=>{const o=new Map;for(const b of l.values())b.type==="choice"&&o.set(b.id,b);return o}),d=x(),v=fe({id:-1,value:"I don't know",isAnswer:!1}),t=()=>{let o=d.value;for(;o===d.value&&i.value.size>1;)if(o=Me(i.value,r.value,e.value),!o)return o;return o},n=M(()=>{if(!d.value)return null;const o=l.get(d.value);return o||null}),m=x([]),C=()=>{var o;m.value=[...(((o=n.value)==null?void 0:o.options)??[]).sort(()=>Math.random()-.5),v]},w=x(),f=x(!1),S=o=>{d.value=o},T=o=>l.has(o),I=o=>{if(n.value&&n.value.type==="choice"){if(!m.value.includes(o))throw new Error("Current question does not have the selected option");w.value=o}},z=()=>{w.value&&n.value&&(w.value.isAnswer?(r.value.set(n.value.id,(r.value.get(n.value.id)??0)+1),e.value.set(n.value.id,(e.value.get(n.value.id)??0)-1),(e.value.get(n.value.id)??0)<=0&&e.value.delete(n.value.id)):(e.value.set(n.value.id,(e.value.get(n.value.id)??0)+1),r.value.set(n.value.id,(r.value.get(n.value.id)??0)-1),(r.value.get(n.value.id)??0)<=0&&r.value.delete(n.value.id)))},F=()=>{n.value&&n.value.type==="text"&&(f.value=!0)};j(()=>{var o;return(o=n.value)==null?void 0:o.id},()=>{w.value=void 0,f.value=!1,C()},{immediate:!0,flush:"sync"});const y=M(()=>({correctQuestions:r.value.size,wrongQuestions:e.value.size,unansweredQuestions:i.value.size-r.value.size-e.value.size,totalQuestions:i.value.size,correctPercentage:r.value.size/i.value.size*100,wrongPercentage:e.value.size/i.value.size*100,unansweredPercentage:(i.value.size-r.value.size-e.value.size)/i.value.size*100}));return{startAll:async()=>{await h(),r.value.clear(),e.value.clear()},startSection:async o=>{p(),await c(o),r.value.clear(),e.value.clear()},stat:y,correctCount:M(()=>r.value),correctQuestions:r,wrongQuestions:e,currentOptionsRandomized:m,currentQuestion:n,isAnswerRevealed:f,selectedAnswer:w,wrongCount:M(()=>e.value.size),getRandomQuestionId:t,updateCounters:z,revealAnswer:F,selectAnswer:I,setQuestion:S,hasQuestion:T}});function Me(r,e,l){const h=new Map([...r].filter(([i])=>!e.has(i)&&!l.has(i)));if(h.size>0)return[...h.keys()][Math.floor(Math.random()*h.size)];const c=[...r.keys()],p=c.map(i=>l.has(i)?(l.get(i)||1)*3:1/(e.get(i)||1));return Se(c,p)}function Se(r,e){if(r.length!==e.length)throw new Error("Длины массивов values и weights должны совпадать.");const l=r.length;if(l===0)throw new Error("Массив values не должен быть пустым.");const h=e.reduce((t,n)=>t+n,0);if(h===0)throw new Error("Сумма весов не должна быть равна 0.");const c=new Array(l);for(let t=0;t<l;t++)c[t]=e[t]/h*l;const p=new Array(l),i=[],d=[];for(let t=0;t<l;t++)c[t]<1?i.push(t):d.push(t);for(;i.length>0&&d.length>0;){const t=i.pop(),n=d.pop();p[t]=n,c[n]=c[n]+c[t]-1,c[n]<1?i.push(n):d.push(n)}for(;i.length>0;)c[i.pop()]=1;for(;d.length>0;)c[d.pop()]=1;const v=Math.floor(Math.random()*l);return Math.random()<c[v]?r[v]:r[p[v]]}const Te=["src"],Ie=["innerHTML"],qe=pe({__name:"QuestionPage",setup(r){const e=he(),l=se(),h=be(),{startAll:c,startSection:p,stat:i,isAnswerRevealed:d,currentOptionsRandomized:v,currentQuestion:t,getRandomQuestionId:n,revealAnswer:m,selectAnswer:C,updateCounters:w,selectedAnswer:f,setQuestion:S,hasQuestion:T}=Oe(),I=M(()=>{var a;return((a=t.value)==null?void 0:a.note)!==void 0}),z=ee("id",""),F=ee("sectionId",""),y=x(),D=x(!1),K=()=>{if(z.value!=="")if(y.value=void 0,D.value=!1,T(z.value))S(z.value);else{const a=n();if(!a){l.replace({name:Z.Home});return}l.replace({params:{id:a}})}},o=x(!1);j(()=>[z.value,F.value],async(a,u)=>{u||(u=["",""]),!(!a[0]&&!a[1])&&(a[0]===u[0]&&a[1]===u[1]||((a[1]!==u[1]||!u[1])&&(a[1]?(o.value=!1,await p(a[1])):o.value||(o.value=!0,await c())),K()))},{immediate:!0});let b;const N=x(!1);let q;const ne=()=>{y.value=void 0,window.clearTimeout(b),q=void 0,window.clearTimeout(q),N.value=!0,q=window.setTimeout(async()=>{q=void 0,await l.replace({params:{id:n()}}),await xe(f).toBeUndefined(),await te(),N.value=!1},parseInt(e.pageFadeOutDuration,10))},L=()=>{var a,u;if(!q&&!(((a=t.value)==null?void 0:a.type)==="choice"&&!f.value)){if(((u=t.value)==null?void 0:u.type)==="text"&&!d.value){m();return}ne()}},ae=a=>{const u=[];return a.id===-1&&u.push(e.dontKnowOption),f.value?f.value.isAnswer?a===f.value?e.correct:(u.push(e["wrong-fade"]),u):a===y.value?(u.push(e["correct-blinking"]),u):a.isAnswer?(u.push(e.correct),u):(u.push(e.wrong),u):u},oe=a=>{if(f.value){L();return}if(C(a),w(),!a.isAnswer){const u=v.value.find(E=>E.isAnswer);y.value=u}b=window.setTimeout(()=>{y.value=void 0},1e3)},$=x("es"),re=a=>{ce(a)||L()},ie=()=>{var a;(a=window.getSelection())!=null&&a.isCollapsed&&($.value==="es"?$.value="ru":$.value="es")},R=a=>h.t($.value,a),ue=()=>{D.value=!0},le=()=>{l.push({name:Z.Settings})};function ce(a){const u=a.target;return u.tagName==="BUTTON"||u.tagName==="A"}return(a,u)=>(A(),ge(Ae,{onClick:re,class:_({[s(e).fadeOut]:N.value})},{topBar:G(()=>[g("div",{class:_(s(e).navigation)},[g("div",{class:_([{[s(e).disabled]:!I.value}]),onClick:P(ue,["stop"])},[H(V,{type:"mdi",path:s(ke)},null,8,["path"])],2),g("div",{onClick:P(le,["stop"])},[H(V,{type:"mdi",path:s(ye)},null,8,["path"])])],2)]),default:G(()=>{var E;return[g("div",{class:_(s(e).progress)},[g("div",{class:_(s(e).correctAnswers)},Q(s(i).correctQuestions),3),g("div",{class:_(s(e).wrongAnswers)},Q(s(i).wrongQuestions),3),g("div",{class:_(s(e).allAnswers)},Q(s(i).totalQuestions),3)],2),s(t)?(A(),k("div",{key:0,class:_(s(e).question)},[g("div",{class:_(s(e).text),onClick:P(ie,["stop"])},[g("div",null,[g("div",{class:_(s(e).sectionTitle)},Q(R(s(t).section.title)),3),g("div",null,Q(R(s(t).question)),1)])],2),g("div",{class:_(s(e).answers)},[s(t).type==="choice"?(A(!0),k(X,{key:0},Y(s(v),O=>(A(),k("div",{key:`${s(t).id}-${O.id}`,class:_(s(e).option)},[H(Ce,{onClick:P(U=>oe(O),["stop"]),disabled:!!s(f),class:_([s(e).button,ae(O)])},{default:G(()=>[me(Q(R(O.value)),1)]),_:2},1032,["onClick","disabled","class"])],2))),128)):B("",!0),s(t).type==="text"?(A(),k("div",{key:1,class:_([s(e).answer,s(d)?"":s(e).hiddenAnswer]),onClick:P(L,["stop"])},[(A(!0),k(X,null,Y(R(s(t).answer).split(`
`),(O,U)=>(A(),k("p",{key:U},Q(O),1))),128))],2)):B("",!0)],2),(E=s(t))!=null&&E.note?(A(),k("div",{key:s(t).id,class:_(["scroll",[s(e).note,{[s(e).hidden]:!s(f)||N.value}]])},[s(t).noteImage?(A(),k("img",{key:0,src:`/notes/${s(t).noteImage}`},null,8,Te)):B("",!0),g("div",{innerHTML:R(s(t).note)},null,8,Ie)],2)):B("",!0)],2)):B("",!0)]}),_:1},8,["class"]))}}),Re="200ms",Pe="_counter_17esx_4",Be="_question_17esx_8",Ne="_text_17esx_15",$e="_answers_17esx_46",Ee="_option_17esx_56",Fe="_fadeOut_17esx_60",De="_button_17esx_66",Le="_correct_17esx_66",Ge="_success_17esx_1",He="_wrong_17esx_73",We="_next_17esx_80",je="_answer_17esx_46",Ke="_hiddenAnswer_17esx_93",Ue="_navigation_17esx_96",Je="_back_17esx_103",Xe="_forward_17esx_107",Ye="_disabled_17esx_116",Ze="_progress_17esx_120",Ve="_correctAnswers_17esx_134",es="_wrongAnswers_17esx_137",ss="_allAnswers_17esx_140",ts="_note_17esx_155",ns="_hidden_17esx_93",as="_sectionTitle_17esx_203",os={pageFadeOutDuration:Re,counter:Pe,question:Be,text:Ne,answers:$e,option:Ee,fadeOut:Fe,button:De,correct:Le,"correct-blinking":"_correct-blinking_17esx_70",success:Ge,wrong:He,"wrong-fade":"_wrong-fade_17esx_77",next:We,answer:je,hiddenAnswer:Ke,navigation:Ue,back:Je,forward:Xe,disabled:Ye,progress:Ze,correctAnswers:Ve,wrongAnswers:es,allAnswers:ss,note:ts,hidden:ns,sectionTitle:as},rs={$style:os},ds=Qe(qe,[["__cssModules",rs]]);export{ds as default};
