import{p as ce,l as ee,q as j,s as de,v as W,x as se,y as ve,z as _e,A as m,B as we,C as P,d as fe,h as pe,i as E,n as c,b as t,D as ge,o as x,a as _,w as R,j as G,t as Q,c as A,F as J,r as X,f as q,m as me,R as Y,E as he}from"./index-CQzgXPOC.js";import{G as xe,m as ke,S as Z,a as Ae,_ as ye}from"./GeneralPage-BXFMJca9.js";import{G as Qe}from"./GeneralButton-CJRY6lGc.js";import{u as Ce,a as ze}from"./questions-BSkh9so0.js";const H=new WeakMap;function V(r,e,i={}){const{mode:y="replace",route:w=ce(),router:f=ee(),transform:d=h=>h}=i;H.has(f)||H.set(f,new Map);const u=H.get(f);let l=w.params[r];ve(()=>{l=void 0});let s;const k=de((h,g)=>(s=g,{get(){return h(),d(l!==void 0&&l!==""?l:W(e))},set(v){l!==v&&(l=v===e||v===null?void 0:v,u.set(r,v===e||v===null?void 0:v),g(),se(()=>{if(u.size===0)return;const p=Object.fromEntries(u.entries());u.clear();const{params:O,query:M,hash:S}=w;f[W(y)]({params:{...O,...p},query:M,hash:S})}))}}));return j(()=>w.params[r],h=>{l=h,s()},{flush:"sync"}),k}const be=_e(()=>{const r=m(new Map),e=m(new Map),{questions:i,loadAll:y,loadSection:w,reset:f}=Ce(),d=m(),u=we({id:-1,value:"I don't know",isAnswer:!1}),l=()=>{let o=d.value;for(;o===d.value&&i.size>1;)if(o=Oe(i,r.value,e.value),!o)return o;return o},s=P(()=>{if(!d.value)return null;const o=i.get(d.value);return o||null}),k=m([]),h=()=>{var o;k.value=[...(((o=s.value)==null?void 0:o.options)??[]).sort(()=>Math.random()-.5),u]},g=m(),v=m(!1),p=o=>{d.value=o},O=o=>i.has(o),M=o=>{if(s.value&&s.value.type==="choice"){if(!k.value.includes(o))throw new Error("Current question does not have the selected option");g.value=o}},S=()=>{g.value&&s.value&&(g.value.isAnswer?(r.value.set(s.value.id,(r.value.get(s.value.id)??0)+1),e.value.set(s.value.id,(e.value.get(s.value.id)??0)-1),(e.value.get(s.value.id)??0)<=0&&e.value.delete(s.value.id)):(e.value.set(s.value.id,(e.value.get(s.value.id)??0)+1),r.value.set(s.value.id,(r.value.get(s.value.id)??0)-1),(r.value.get(s.value.id)??0)<=0&&r.value.delete(s.value.id)))},C=()=>{s.value&&s.value.type==="text"&&(v.value=!0)};j(()=>{var o;return(o=s.value)==null?void 0:o.id},()=>{g.value=void 0,v.value=!1,h()},{immediate:!0,flush:"sync"});const F=P(()=>({correctQuestions:r.value.size,wrongQuestions:e.value.size,unansweredQuestions:i.size-r.value.size-e.value.size,totalQuestions:i.size,correctPercentage:r.value.size/i.size*100,wrongPercentage:e.value.size/i.size*100,unansweredPercentage:(i.size-r.value.size-e.value.size)/i.size*100}));return{startAll:async()=>{await y(),r.value.clear(),e.value.clear()},startSection:async o=>{f(),await w(o),r.value.clear(),e.value.clear()},stat:F,correctCount:P(()=>r.value),correctQuestions:r,wrongQuestions:e,currentOptionsRandomized:k,currentQuestion:s,isAnswerRevealed:v,selectedAnswer:g,wrongCount:P(()=>e.value.size),getRandomQuestionId:l,updateCounters:S,revealAnswer:C,selectAnswer:M,setQuestion:p,hasQuestion:O}});function Oe(r,e,i){if(Math.random()<i.size/10){const u=[...i.keys()];let l="";for(;u.length>0;){const s=Math.floor(Math.random()*u.length);if(l=u[s],r.has(l))return l;u.splice(s,1),i.delete(l)}}const y=Math.max(...e.values()),w=new Set;for(const[u,l]of e)l===y&&w.add(u);w.size===e.size&&w.clear();let f="";const d=[...r.keys()];for(;!f;){const u=d[Math.floor(Math.random()*d.length)];w.has(u)||(f=u)}return f}const Me=["src"],Se=["innerHTML"],Te=fe({__name:"QuestionPage",setup(r){const e=ge(),i=ee(),y=ze(),{startAll:w,startSection:f,stat:d,isAnswerRevealed:u,currentOptionsRandomized:l,currentQuestion:s,getRandomQuestionId:k,revealAnswer:h,selectAnswer:g,updateCounters:v,selectedAnswer:p,setQuestion:O,hasQuestion:M}=be(),S=P(()=>{var n;return((n=s.value)==null?void 0:n.note)!==void 0}),C=V("id",""),F=V("sectionId",""),z=m(),D=m(!1),o=()=>{if(C.value!=="")if(z.value=void 0,D.value=!1,M(C.value))O(C.value);else{const n=k();if(!n){i.replace({name:Y.Home});return}i.replace({params:{id:n}})}};j(()=>[C.value,F.value],async(n,a)=>{a||(a=["",""]),!(!n[0]&&!n[1])&&(n[0]===a[0]&&n[1]===a[1]||((n[1]!==a[1]||!a[1])&&(n[1]?await f(n[1]):await w()),o()))},{immediate:!0});let K;const N=m(!1);let T;const te=()=>{z.value=void 0,window.clearTimeout(K),T=void 0,window.clearTimeout(T),N.value=!0,T=window.setTimeout(async()=>{T=void 0,await i.replace({params:{id:k()}}),await he(p).toBeUndefined(),await se(),N.value=!1},parseInt(e.pageFadeOutDuration,10))},L=()=>{var n,a;if(!T&&!(((n=s.value)==null?void 0:n.type)==="choice"&&!p.value)){if(((a=s.value)==null?void 0:a.type)==="text"&&!u.value){h();return}te()}},ne=n=>{const a=[];return n.id===-1&&a.push(e.dontKnowOption),p.value?p.value.isAnswer?n===p.value?e.correct:(a.push(e["wrong-fade"]),a):n===z.value?(a.push(e["correct-blinking"]),a):n.isAnswer?(a.push(e.correct),a):(a.push(e.wrong),a):a},ae=n=>{if(p.value){L();return}if(g(n),v(),!n.isAnswer){const a=l.value.find($=>$.isAnswer);z.value=a}K=window.setTimeout(()=>{z.value=void 0},1e3)},B=m("es"),oe=n=>{le(n)||L()},re=()=>{var n;(n=window.getSelection())!=null&&n.isCollapsed&&(B.value==="es"?B.value="ru":B.value="es")},I=n=>y.t(B.value,n),ie=()=>{D.value=!0},ue=()=>{i.push({name:Y.Settings})};function le(n){const a=n.target;return a.tagName==="BUTTON"||a.tagName==="A"}return(n,a)=>(x(),pe(xe,{onClick:oe,class:c({[t(e).fadeOut]:N.value})},{topBar:E(()=>[_("div",{class:c(t(e).navigation)},[_("div",{class:c([{[t(e).disabled]:!S.value}]),onClick:R(ie,["stop"])},[G(Z,{type:"mdi",path:t(ke)},null,8,["path"])],2),_("div",{onClick:R(ue,["stop"])},[G(Z,{type:"mdi",path:t(Ae)},null,8,["path"])])],2)]),default:E(()=>{var $;return[_("div",{class:c(t(e).progress)},[_("div",{class:c(t(e).correctAnswers)},Q(t(d).correctQuestions),3),_("div",{class:c(t(e).wrongAnswers)},Q(t(d).wrongQuestions),3),_("div",{class:c(t(e).allAnswers)},Q(t(d).totalQuestions),3)],2),t(s)?(x(),A("div",{key:0,class:c(t(e).question)},[_("div",{class:c(t(e).text),onClick:R(re,["stop"])},[_("div",null,[_("div",{class:c(t(e).sectionTitle)},Q(I(t(s).section.title)),3),_("div",null,Q(I(t(s).question)),1)])],2),_("div",{class:c(t(e).answers)},[t(s).type==="choice"?(x(!0),A(J,{key:0},X(t(l),b=>(x(),A("div",{key:`${t(s).id}-${b.id}`,class:c(t(e).option)},[G(Qe,{onClick:R(U=>ae(b),["stop"]),disabled:!!t(p),class:c([t(e).button,ne(b)])},{default:E(()=>[me(Q(I(b.value)),1)]),_:2},1032,["onClick","disabled","class"])],2))),128)):q("",!0),t(s).type==="text"?(x(),A("div",{key:1,class:c([t(e).answer,t(u)?"":t(e).hiddenAnswer]),onClick:R(L,["stop"])},[(x(!0),A(J,null,X(I(t(s).answer).split(`
`),(b,U)=>(x(),A("p",{key:U},Q(b),1))),128))],2)):q("",!0)],2),($=t(s))!=null&&$.note?(x(),A("div",{key:t(s).id,class:c(["scroll",[t(e).note,{[t(e).hidden]:!t(p)||N.value}]])},[t(s).noteImage?(x(),A("img",{key:0,src:`/notes/${t(s).noteImage}`},null,8,Me)):q("",!0),_("div",{innerHTML:I(t(s).note)},null,8,Se)],2)):q("",!0)],2)):q("",!0)]}),_:1},8,["class"]))}}),Ie="200ms",Re="_counter_17esx_4",qe="_question_17esx_8",Pe="_text_17esx_15",Ne="_answers_17esx_46",Be="_option_17esx_56",$e="_fadeOut_17esx_60",Fe="_button_17esx_66",De="_correct_17esx_66",Le="_success_17esx_1",Ee="_wrong_17esx_73",Ge="_next_17esx_80",He="_answer_17esx_46",je="_hiddenAnswer_17esx_93",Ke="_navigation_17esx_96",Ue="_back_17esx_103",We="_forward_17esx_107",Je="_disabled_17esx_116",Xe="_progress_17esx_120",Ye="_correctAnswers_17esx_134",Ze="_wrongAnswers_17esx_137",Ve="_allAnswers_17esx_140",es="_note_17esx_155",ss="_hidden_17esx_93",ts="_sectionTitle_17esx_203",ns={pageFadeOutDuration:Ie,counter:Re,question:qe,text:Pe,answers:Ne,option:Be,fadeOut:$e,button:Fe,correct:De,"correct-blinking":"_correct-blinking_17esx_70",success:Le,wrong:Ee,"wrong-fade":"_wrong-fade_17esx_77",next:Ge,answer:He,hiddenAnswer:je,navigation:Ke,back:Ue,forward:We,disabled:Je,progress:Xe,correctAnswers:Ye,wrongAnswers:Ze,allAnswers:Ve,note:es,hidden:ss,sectionTitle:ts},as={$style:ns},ls=ye(Te,[["__cssModules",as]]);export{ls as default};
