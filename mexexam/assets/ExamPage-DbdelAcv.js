import{a as f,k as E,q as oe,P as ae,Q as ie,S as le,v as re,y as B,m as ce,x as v,E as n,u as o,D as _,F as l,J as y,G as ue,H as q,I as D,L as se,M as te}from"./vendor-MUXKnC7j.js";import{u as de,G as me,_ as ve}from"./GeneralPage-CKKAZ6MA.js";import{G as ne}from"./GeneralButton-Yat-S8-6.js";import{u as _e}from"./questions-C3MRY4z2.js";import{u as fe}from"./statistics-Bd1wb4X0.js";import{c as he}from"./utils-B0mUfX74.js";import{u as pe,R as ge}from"./index-BidEZUHt.js";const we=10,V=we*60*1e3,xe=he(()=>{const{questions:$,loadSections:H}=_e(),{recordCorrectAnswer:m,recordWrongAnswer:Q,recordSessionStart:I}=fe(),c=f([]),w=f(new Map),h=f(new Map),T=f(!1),p=f(!1),C=f(null),x=f(null),g=f(V),S=f(null),b=f(null),N=E(()=>b.value===null?[...$.values()]:[...$.values()].filter(s=>s.section.id===b.value)),U=E(()=>{const s=[];for(const e of N.value)e.type==="choice"&&s.push(e);return s}),P=(s=10)=>{const e=[...U.value],i=[];for(let u=0;u<Math.min(s,e.length);u++){const t=Math.floor(Math.random()*e.length);i.push(e[t]),e.splice(t,1)}return i},W=s=>{const e=[...s];for(let i=e.length-1;i>0;i--){const u=Math.floor(Math.random()*(i+1));[e[i],e[u]]=[e[u],e[i]]}return e},z=()=>{x.value=Date.now(),g.value=V,S.value=window.setInterval(()=>{if(x.value){const s=Date.now()-x.value;g.value=Math.max(0,V-s),g.value<=0&&(A(),F())}},1e3)},A=()=>{S.value&&(clearInterval(S.value),S.value=null)},M=s=>{const e=Math.ceil(s/1e3),i=Math.floor(e/60),u=e%60;return`${i.toString().padStart(2,"0")}:${u.toString().padStart(2,"0")}`},X=async s=>{await H(),b.value=s??null,c.value=P(10),w.value.clear();for(const e of c.value)e.options&&w.value.set(e.id,W(e.options));h.value.clear(),T.value=!0,p.value=!1,C.value=null,z(),I()},j=(s,e)=>{p.value||h.value.set(s,e)},J=s=>h.value.get(s)??null,F=()=>{var u;if(p.value)return;A();const s=[];let e=0,i=0;for(const t of c.value){const k=h.value.get(t.id),d=(u=t.options)==null?void 0:u.find(O=>O.id===k),R=(d==null?void 0:d.isAnswer)??!1;s.push({questionId:t.id,selectedOptionId:k??null,isCorrect:R}),R?(e++,m(t.id)):(i++,Q(t.id))}C.value={correctAnswers:e,wrongAnswers:i,totalQuestions:c.value.length,percentage:Math.round(e/c.value.length*100),answers:s},p.value=!0},K=()=>{A(),c.value=[],w.value.clear(),h.value.clear(),T.value=!1,p.value=!1,C.value=null,x.value=null,g.value=V},Y=s=>w.value.get(s.id)??[],G=s=>c.value.find(e=>e.id===s),L=s=>{var e;return(e=C.value)==null?void 0:e.answers.find(i=>i.questionId===s)},Z=E(()=>c.value.length>0&&h.value.size===c.value.length),ee=E(()=>h.value.size),a=E(()=>M(g.value)),r=E(()=>g.value<=3e4);return{examQuestions:c,userAnswers:h,isExamStarted:T,isExamFinished:p,examResults:C,timeRemaining:g,formattedTimeRemaining:a,isTimeRunningOut:r,startExam:X,selectAnswer:j,getSelectedAnswer:J,finishExam:F,resetExam:K,getRandomizedOptions:Y,getQuestionById:G,getAnswerById:L,isAllQuestionsAnswered:Z,answeredQuestionsCount:ee,stopTimer:A}}),Se={class:"exam-header"},Ae=["title"],Ce={key:0,class:"loading"},Ee={key:1,class:"exam-content"},Qe={class:"questions-list"},ke=["data-question-id"],Re={class:"question-header"},ye={class:"question-number"},Ie={class:"question-text"},Te={class:"options-list"},be=["name","value","checked","onChange","disabled"],Me={class:"option-text"},Oe={class:"finish-section"},Be={key:2,class:"results-content"},Ne={class:"results-header"},Ue={class:"results-summary"},ze={class:"result-item correct"},Fe={class:"result-label"},Ge={class:"result-value"},Le={class:"result-item wrong"},qe={class:"result-label"},De={class:"result-value"},Ve={class:"result-item total"},$e={class:"result-label"},He={class:"result-value"},Pe={class:"result-item percentage"},We={class:"result-label"},Xe={class:"result-value"},je={class:"results-questions"},Je={class:"question-header"},Ke={class:"question-number"},Ye={class:"question-text"},Ze={class:"options-list"},es={class:"option-text"},ss={class:"actions"},ts=oe({__name:"ExamPage",setup($){const H=ce(),{t:m}=pe(),{examQuestions:Q,isExamStarted:I,isExamFinished:c,examResults:w,startExam:h,selectAnswer:T,getSelectedAnswer:p,finishExam:C,resetExam:x,getRandomizedOptions:g,getAnswerById:S,formattedTimeRemaining:b,isTimeRunningOut:N,isAllQuestionsAnswered:U,stopTimer:P}=xe(),{pushLocale:W}=de(),z=E(()=>H.params.sectionId),A=f(new Map),M=f(!1);ae((a,r,s)=>{x(),s()}),ie(()=>{I.value&&x(),h(z.value).catch(console.error)}),le(()=>{P()});const X=(a,r)=>{T(a,r),M.value=!1},j=()=>{for(const a of Q.value)if(p(a.id)===null)return a.id;return null},J=a=>{const r=A.value.get(a);r&&r.scrollIntoView({behavior:"smooth",block:"center"})},F=()=>{if(U.value)C(),window.scrollTo(0,0);else{M.value=!0;const a=j();a&&J(a)}},K=async()=>{x(),window.scrollTo(0,0),await h(z.value)},Y=()=>{x(),W(ge.Home)},G=a=>{if(!c.value)return"";const r=S(a);return r?r.isCorrect?"correct":"wrong":""},L=(a,r)=>{var u;if(!c.value)return"";const s=S(a);if(!s)return"";const e=Q.value.find(t=>t.id===a),i=(u=e==null?void 0:e.options)==null?void 0:u.find(t=>t.id===r);return i?i.isAnswer?"correct-answer":s.selectedOptionId===r&&!s.isCorrect?"wrong-answer":"":""},Z=(a,r)=>{r?A.value.set(a,r):A.value.delete(a)},ee=a=>p(a)===null;return(a,r)=>(v(),re(me,null,{topBar:B(()=>[n("div",Se,[o(I)&&!o(c)?(v(),_("div",{key:0,class:y(["timer",{"time-running-out":o(N)}]),title:o(N)?o(m)("Time is running out!"):o(m)("Time remaining")},l(o(b)),11,Ae)):ue("",!0)])]),default:B(()=>{var s,e,i,u;return[o(I)?o(c)?(v(),_("div",Be,[n("div",Ne,[n("h2",null,l(o(m)("Exam Results")),1),n("div",Ue,[n("div",ze,[n("span",Fe,l(o(m)("Correct")),1),n("span",Ge,l((s=o(w))==null?void 0:s.correctAnswers),1)]),n("div",Le,[n("span",qe,l(o(m)("Wrong")),1),n("span",De,l((e=o(w))==null?void 0:e.wrongAnswers),1)]),n("div",Ve,[n("span",$e,l(o(m)("Total")),1),n("span",He,l((i=o(w))==null?void 0:i.totalQuestions),1)]),n("div",Pe,[n("span",We,l(o(m)("Score")),1),n("span",Xe,l((u=o(w))==null?void 0:u.percentage)+"%",1)])])]),n("div",je,[(v(!0),_(q,null,D(o(Q),(t,k)=>{var d,R;return v(),_("div",{key:t.id,class:y(["result-question",G(t.id)])},[n("div",Je,[n("span",Ke,l(k+1)+".",1),n("span",Ye,l(t.question),1),n("span",{class:y(["result-indicator",(d=o(S)(t.id))!=null&&d.isCorrect?"correct":"wrong"])},l((R=o(S)(t.id))!=null&&R.isCorrect?"✓":"✗"),3)]),n("div",Ze,[(v(!0),_(q,null,D(o(g)(t),O=>(v(),_("div",{key:O.id,class:y(["option-item",L(t.id,O.id)])},[n("span",es,l(O.value),1)],2))),128))])],2)}),128))]),n("div",ss,[se(ne,{onClick:K,class:"new-exam-button"},{default:B(()=>[te(l(o(m)("Start New Exam")),1)]),_:1}),se(ne,{onClick:Y,class:"home-button"},{default:B(()=>[te(l(o(m)("Go Home")),1)]),_:1})])])):(v(),_("div",Ee,[n("div",Qe,[(v(!0),_(q,null,D(o(Q),(t,k)=>(v(),_("div",{key:t.id,"data-question-id":t.id,class:y(["question-item",G(t.id),{"unanswered-highlight":M.value&&ee(t.id)}]),ref_for:!0,ref:d=>Z(t.id,d)},[n("div",Re,[n("span",ye,l(k+1)+".",1),n("span",Ie,l(t.question),1)]),n("div",Te,[(v(!0),_(q,null,D(o(g)(t),d=>(v(),_("label",{key:d.id,class:y(["option-item",L(t.id,d.id)])},[n("input",{type:"radio",name:`question-${t.id}`,value:d.id,checked:o(p)(t.id)===d.id,onChange:R=>X(t.id,d.id),disabled:o(c)},null,40,be),n("span",Me,l(d.value),1)],2))),128))])],10,ke))),128))]),n("div",Oe,[se(ne,{onClick:F,class:"finish-button"},{default:B(()=>[te(l(o(U)?o(m)("Finish Exam"):o(m)("Check Unanswered Questions")),1)]),_:1})])])):(v(),_("div",Ce,l(o(m)("Loading exam...")),1))]}),_:1}))}}),us=ve(ts,[["__scopeId","data-v-77f7bf6d"]]);export{us as default};
