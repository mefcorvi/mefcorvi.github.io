import{p as ue,l as Y,q as G,s as ce,v as V,x as Z,y as de,z as ve,A as _e,B as g,C as we,D as E,d as fe,h as pe,i as B,n as v,b as t,E as ge,o as p,a as f,w as O,j as T,e as K,c as m,t as F,F as U,r as W,f as S,m as he,G as me,R as ke}from"./index-CjNIU-8T.js";import{G as be,m as ye,S as J,a as Ae,_ as Ce}from"./GeneralPage-D5x9NvVY.js";import{G as je}from"./GeneralButton-CbsHXWRf.js";import{u as Qe,a as ze,_ as xe}from"./questions-C7CLpqdS.js";const D=new WeakMap;function Oe(i,e,l={}){const{mode:k="replace",route:a=ue(),router:u=Y(),transform:_=w=>w}=l;D.has(u)||D.set(u,new Map);const r=D.get(u);let s=a.params[i];de(()=>{s=void 0});let A;const h=ce((w,x)=>(A=x,{get(){return w(),_(s!==void 0&&s!==""?s:V(e))},set(d){s!==d&&(s=d===e||d===null?void 0:d,r.set(i,d===e||d===null?void 0:d),x(),Z(()=>{if(r.size===0)return;const C=Object.fromEntries(r.entries());r.clear();const{params:j,query:M,hash:b}=a;u[V(k)]({params:{...j,...C},query:M,hash:b})}))}}));return G(()=>a.params[i],w=>{s=w,A()},{flush:"sync"}),h}function X(i){return ve(i,()=>new Set,void 0,{serializer:{read(e){return e?new Set(e.split(",")):new Set},write(e){return[...e].join(",")}}})}const Se=_e(()=>{const i=X("correct-questions-2"),e=X("wrong-questions-2"),{questions:l,loadAll:k}=Qe(),a=g(),u=we({id:-1,value:"I don't know",isAnswer:!1}),_=()=>{let o=a.value;for(;o===a.value;)if(o=Me(l,i.value,e.value),!o)return o;return o},r=E(()=>{if(!a.value)return null;const o=l.get(a.value);if(!o)throw new Error(`Failed to get question by id ${a.value}`);return o}),s=g([]),A=()=>{var o;s.value=[...(((o=r.value)==null?void 0:o.options)??[]).sort(()=>Math.random()-.5),u]},h=g(),w=g(!1),x=o=>{a.value=o},d=o=>l.has(o),C=g(0),j=g(0),M=()=>{C.value=0,j.value=0},b=o=>{if(r.value&&r.value.type==="choice"){if(!s.value.includes(o))throw new Error("Current question does not have the selected option");h.value=o}},Q=()=>{h.value&&r.value&&(h.value.isAnswer?(C.value++,i.value.add(r.value.id),e.value.delete(r.value.id)):(j.value++,e.value.add(r.value.id),i.value.delete(r.value.id)))},z=()=>{r.value&&r.value.type==="text"&&(w.value=!0)};G(()=>{var o;return(o=r.value)==null?void 0:o.id},()=>{h.value=void 0,w.value=!1,A()},{immediate:!0,flush:"sync"});const P=E(()=>({correctQuestions:i.value.size,wrongQuestions:e.value.size,unansweredQuestions:l.size-i.value.size-e.value.size,totalQuestions:l.size,correctPercentage:i.value.size/l.size*100,wrongPercentage:e.value.size/l.size*100,unansweredPercentage:(l.size-i.value.size-e.value.size)/l.size*100}));return{startAll:async()=>{await k()},stat:P,correctCount:C,correctQuestions:i,wrongQuestions:e,currentOptionsRandomized:s,currentQuestion:r,isAnswerRevealed:w,selectedAnswer:h,wrongCount:j,getRandomQuestionId:_,resetCount:M,updateCounters:Q,revealAnswer:z,selectAnswer:b,setQuestion:x,hasQuestion:d}});function Me(i,e,l){if(Math.random()<l.size/10){const a=[...l];let u="";for(;a.length>0;){const _=Math.floor(Math.random()*a.length);if(u=a[_],i.has(u))return u;a.splice(_,1),l.delete(u)}}if(Math.random()<.2){const a=[...e];let u="";for(;a.length>0;){const _=Math.floor(Math.random()*a.length);if(u=a[_],i.has(u))return u;a.splice(_,1),e.delete(u)}}const k=[...i.keys()];return k[Math.floor(Math.random()*k.length)]}const qe=["src"],Pe=["innerHTML"],Re=fe({__name:"QuestionPage",setup(i){const e=ge(),l=Y(),k=ze(),{startAll:a,stat:u,isAnswerRevealed:_,currentOptionsRandomized:r,currentQuestion:s,getRandomQuestionId:A,revealAnswer:h,selectAnswer:w,updateCounters:x,selectedAnswer:d,setQuestion:C,hasQuestion:j}=Se(),M=E(()=>{var n;return((n=s.value)==null?void 0:n.note)!==void 0}),b=Oe("id",""),Q=g(),z=g(!1),P=()=>{b.value!==""&&(Q.value=void 0,z.value=!1,j(b.value)?C(b.value):l.replace({params:{id:A()}}))};G(b,P),a().then(P);let I;const o=g(!1);let q;const ee=()=>{Q.value=void 0,window.clearTimeout(I),q=void 0,window.clearTimeout(q),o.value=!0,q=window.setTimeout(async()=>{q=void 0,await l.replace({params:{id:A()}}),await me(d).toBeUndefined(),await Z(),o.value=!1},parseInt(e.pageFadeOutDuration,10))},$=()=>{var n,c;if(!q&&!(((n=s.value)==null?void 0:n.type)==="choice"&&!d.value)){if(((c=s.value)==null?void 0:c.type)==="text"&&!_.value){h();return}ee()}},te=n=>{const c=[];return n.id===-1&&c.push(e.dontKnowOption),d.value?d.value.isAnswer?n===d.value?e.correct:(c.push(e["wrong-fade"]),c):n===Q.value?(c.push(e["correct-blinking"]),c):n.isAnswer?(c.push(e.correct),c):(c.push(e.wrong),c):c},se=n=>{if(d.value){$();return}if(w(n),x(),!n.isAnswer){const c=r.value.find(y=>y.isAnswer);Q.value=c}I=window.setTimeout(()=>{Q.value=void 0},1e3)},R=g("es"),ne=n=>{L(n)||$()},oe=()=>{var n;(n=window.getSelection())!=null&&n.isCollapsed&&(R.value==="es"?R.value="ru":R.value="es")},N=n=>k.t(R.value,n),ae=n=>{L(n)||(n.stopPropagation(),re())},re=()=>{z.value=!1},ie=()=>{z.value=!0},le=()=>{l.push({name:ke.Settings})};function L(n){const c=n.target;return c.tagName==="BUTTON"||c.tagName==="A"}return(n,c)=>(p(),pe(be,{onClick:ne,class:v({[t(e).fadeOut]:o.value})},{topBar:B(()=>[f("div",{class:v(t(e).navigation)},[f("div",{class:v([{[t(e).disabled]:!M.value}]),onClick:O(ie,["stop"])},[T(J,{type:"mdi",path:t(ye)},null,8,["path"])],2),f("div",{onClick:O(le,["stop"])},[T(J,{type:"mdi",path:t(Ae)},null,8,["path"])])],2)]),default:B(()=>[f("div",{class:v(t(e).progress)},[f("div",{class:v(t(e).correctAnswers),style:K({width:`${t(u).correctPercentage}%`})},null,6),f("div",{class:v(t(e).wrongAnswers),style:K({width:`${t(u).wrongPercentage}%`})},null,6)],2),t(s)?(p(),m("div",{key:0,class:v(t(e).question)},[f("div",{class:v(t(e).text),onClick:O(oe,["stop"])},[f("div",null,[T(xe,{section:t(s).section},null,8,["section"]),f("div",null,F(N(t(s).question)),1)])],2),f("div",{class:v(t(e).answers)},[t(s).type==="choice"?(p(!0),m(U,{key:0},W(t(r),y=>(p(),m("div",{key:`${t(s).id}-${y.id}`,class:v(t(e).option)},[T(je,{onClick:O(H=>se(y),["stop"]),class:v([t(e).button,te(y)])},{default:B(()=>[he(F(N(y.value)),1)]),_:2},1032,["onClick","class"])],2))),128)):S("",!0),t(s).type==="text"?(p(),m("div",{key:1,class:v([t(e).answer,t(_)?"":t(e).hiddenAnswer]),onClick:O($,["stop"])},[(p(!0),m(U,null,W(N(t(s).answer).split(`
`),(y,H)=>(p(),m("p",{key:H},F(y),1))),128))],2)):S("",!0)],2)],2)):S("",!0),t(s)?(p(),m("div",{key:1,onClick:O(ae,["stop"]),class:v([t(e).noteContainer,{[t(e).hidden]:!z.value}])},[t(s).note?(p(),m("div",{key:0,class:v(["scroll",[t(e).note,{[t(e).hidden]:!z.value}]])},[t(s).noteImage?(p(),m("img",{key:0,src:`/notes/${t(s).noteImage}`},null,8,qe)):S("",!0),f("div",{innerHTML:N(t(s).note)},null,8,Pe)],2)):S("",!0)],2)):S("",!0)]),_:1},8,["class"]))}}),Ne="200ms",Te="_counter_1lkbj_4",Ie="_question_1lkbj_8",$e="_text_1lkbj_15",Be="_answers_1lkbj_46",Fe="_option_1lkbj_56",De="_fadeOut_1lkbj_60",Ee="_button_1lkbj_66",Ge="_correct_1lkbj_66",Le="_success_1lkbj_1",He="_wrong_1lkbj_73",Ve="_next_1lkbj_80",Ke="_answer_1lkbj_46",Ue="_hiddenAnswer_1lkbj_93",We="_navigation_1lkbj_96",Je="_back_1lkbj_103",Xe="_forward_1lkbj_107",Ye="_disabled_1lkbj_116",Ze="_progress_1lkbj_120",et="_correctAnswers_1lkbj_129",tt="_wrongAnswers_1lkbj_135",st="_noteContainer_1lkbj_153",nt="_hidden_1lkbj_93",ot="_note_1lkbj_153",at={pageFadeOutDuration:Ne,counter:Te,question:Ie,text:$e,answers:Be,option:Fe,fadeOut:De,button:Ee,correct:Ge,"correct-blinking":"_correct-blinking_1lkbj_70",success:Le,wrong:He,"wrong-fade":"_wrong-fade_1lkbj_77",next:Ve,answer:Ke,hiddenAnswer:Ue,navigation:We,back:Je,forward:Xe,disabled:Ye,progress:Ze,correctAnswers:et,wrongAnswers:tt,noteContainer:st,hidden:nt,note:ot},rt={$style:at},dt=Ce(Re,[["__cssModules",rt]]);export{dt as default};
