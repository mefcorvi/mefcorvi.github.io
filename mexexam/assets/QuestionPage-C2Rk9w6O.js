import{p as ve,l as ne,q as j,s as _e,v as U,x as se,y as we,z as pe,A as ge,B as h,C as he,D as H,d as me,h as ke,i as E,n as d,b as t,E as ye,R as W,o as g,a as _,w as M,j as G,e as J,c as k,t as B,F as X,r as Y,f as T,m as Ae,G as Ce}from"./index-U-5K9r7o.js";import{G as Qe,m as ze,S as Z,a as Se,_ as be}from"./GeneralPage-BQB1LHDS.js";import{G as xe}from"./GeneralButton-JCHhSEoH.js";import{u as Oe,a as Me}from"./questions-DNrXRlOp.js";const L=new WeakMap;function ee(u,e,i={}){const{mode:y="replace",route:c=ve(),router:o=ne(),transform:v=f=>f}=i;L.has(o)||L.set(o,new Map);const m=L.get(o);let a=c.params[u];we(()=>{a=void 0});let r;const x=_e((f,A)=>(r=A,{get(){return f(),v(a!==void 0&&a!==""?a:U(e))},set(w){a!==w&&(a=w===e||w===null?void 0:w,m.set(u,w===e||w===null?void 0:w),A(),se(()=>{if(m.size===0)return;const p=Object.fromEntries(m.entries());m.clear();const{params:Q,query:z,hash:q}=c;o[U(y)]({params:{...Q,...p},query:z,hash:q})}))}}));return j(()=>c.params[u],f=>{a=f,r()},{flush:"sync"}),x}function te(u){return pe(u,()=>new Set,void 0,{serializer:{read(e){return e?new Set(e.split(",")):new Set},write(e){return[...e].join(",")}}})}const Te=ge(()=>{const u=te("correct-questions-2"),e=te("wrong-questions-2"),{questions:i,loadAll:y,loadSection:c}=Oe(),o=h(),v=he({id:-1,value:"I don't know",isAnswer:!1}),m=()=>{let s=o.value;for(;s===o.value;)if(s=qe(i,u.value,e.value),!s)return s;return s},a=H(()=>{if(!o.value)return null;const s=i.get(o.value);if(!s)throw new Error(`Failed to get question by id ${o.value}`);return s}),r=h([]),x=()=>{var s;r.value=[...(((s=a.value)==null?void 0:s.options)??[]).sort(()=>Math.random()-.5),v]},f=h(),A=h(!1),w=s=>{o.value=s},p=s=>i.has(s),Q=h(0),z=h(0),q=()=>{Q.value=0,z.value=0},O=s=>{if(a.value&&a.value.type==="choice"){if(!r.value.includes(s))throw new Error("Current question does not have the selected option");f.value=s}},R=()=>{f.value&&a.value&&(f.value.isAnswer?(Q.value++,u.value.add(a.value.id),e.value.delete(a.value.id)):(z.value++,e.value.add(a.value.id),u.value.delete(a.value.id)))},S=()=>{a.value&&a.value.type==="text"&&(A.value=!0)};j(()=>{var s;return(s=a.value)==null?void 0:s.id},()=>{f.value=void 0,A.value=!1,x()},{immediate:!0,flush:"sync"});const b=H(()=>({correctQuestions:u.value.size,wrongQuestions:e.value.size,unansweredQuestions:i.size-u.value.size-e.value.size,totalQuestions:i.size,correctPercentage:u.value.size/i.size*100,wrongPercentage:e.value.size/i.size*100,unansweredPercentage:(i.size-u.value.size-e.value.size)/i.size*100}));return{startAll:async()=>{await y()},startSection:async s=>{await c(s)},stat:b,correctCount:Q,correctQuestions:u,wrongQuestions:e,currentOptionsRandomized:r,currentQuestion:a,isAnswerRevealed:A,selectedAnswer:f,wrongCount:z,getRandomQuestionId:m,resetCount:q,updateCounters:R,revealAnswer:S,selectAnswer:O,setQuestion:w,hasQuestion:p}});function qe(u,e,i){if(Math.random()<i.size/10){const c=[...i];let o="";for(;c.length>0;){const v=Math.floor(Math.random()*c.length);if(o=c[v],u.has(o))return o;c.splice(v,1),i.delete(o)}}if(Math.random()<.2){const c=[...e];let o="";for(;c.length>0;){const v=Math.floor(Math.random()*c.length);if(o=c[v],u.has(o))return o;c.splice(v,1),e.delete(o)}}const y=[...u.keys()];return y[Math.floor(Math.random()*y.length)]}const Ie=["src"],Pe=["innerHTML"],Re=me({__name:"QuestionPage",setup(u){const e=ye(),i=ne(),y=Me(),{startAll:c,startSection:o,stat:v,isAnswerRevealed:m,currentOptionsRandomized:a,currentQuestion:r,getRandomQuestionId:x,revealAnswer:f,selectAnswer:A,updateCounters:w,selectedAnswer:p,setQuestion:Q,hasQuestion:z}=Te(),q=H(()=>{var n;return((n=r.value)==null?void 0:n.note)!==void 0}),O=ee("id",""),R=ee("sectionId",""),S=h(),b=h(!1),N=()=>{if(O.value!=="")if(S.value=void 0,b.value=!1,z(O.value))Q(O.value);else{const n=x();if(!n){i.replace({name:W.Home});return}i.replace({params:{id:n}})}};j(O,N),R.value?o(R.value).then(N):c().then(N);let F;const s=h(!1);let I;const oe=()=>{S.value=void 0,window.clearTimeout(F),I=void 0,window.clearTimeout(I),s.value=!0,I=window.setTimeout(async()=>{I=void 0,await i.replace({params:{id:x()}}),await Ce(p).toBeUndefined(),await se(),s.value=!1},parseInt(e.pageFadeOutDuration,10))},D=()=>{var n,l;if(!I&&!(((n=r.value)==null?void 0:n.type)==="choice"&&!p.value)){if(((l=r.value)==null?void 0:l.type)==="text"&&!m.value){f();return}oe()}},ae=n=>{const l=[];return n.id===-1&&l.push(e.dontKnowOption),p.value?p.value.isAnswer?n===p.value?e.correct:(l.push(e["wrong-fade"]),l):n===S.value?(l.push(e["correct-blinking"]),l):n.isAnswer?(l.push(e.correct),l):(l.push(e.wrong),l):l},re=n=>{if(p.value){D();return}if(A(n),w(),!n.isAnswer){const l=a.value.find(C=>C.isAnswer);S.value=l}F=window.setTimeout(()=>{S.value=void 0},1e3)},$=h("es"),ie=n=>{V(n)||D()},ue=()=>{var n;(n=window.getSelection())!=null&&n.isCollapsed&&($.value==="es"?$.value="ru":$.value="es")},P=n=>y.t($.value,n),le=n=>{V(n)||(n.stopPropagation(),ce())},ce=()=>{b.value=!1},de=()=>{b.value=!0},fe=()=>{i.push({name:W.Settings})};function V(n){const l=n.target;return l.tagName==="BUTTON"||l.tagName==="A"}return(n,l)=>(g(),ke(Qe,{onClick:ie,class:d({[t(e).fadeOut]:s.value})},{topBar:E(()=>[_("div",{class:d(t(e).navigation)},[_("div",{class:d([{[t(e).disabled]:!q.value}]),onClick:M(de,["stop"])},[G(Z,{type:"mdi",path:t(ze)},null,8,["path"])],2),_("div",{onClick:M(fe,["stop"])},[G(Z,{type:"mdi",path:t(Se)},null,8,["path"])])],2)]),default:E(()=>[_("div",{class:d(t(e).progress)},[_("div",{class:d(t(e).correctAnswers),style:J({width:`${t(v).correctPercentage}%`})},null,6),_("div",{class:d(t(e).wrongAnswers),style:J({width:`${t(v).wrongPercentage}%`})},null,6)],2),t(r)?(g(),k("div",{key:0,class:d(t(e).question)},[_("div",{class:d(t(e).text),onClick:M(ue,["stop"])},[_("div",null,[_("div",{class:d(t(e).sectionTitle)},B(P(t(r).section.title)),3),_("div",null,B(P(t(r).question)),1)])],2),_("div",{class:d(t(e).answers)},[t(r).type==="choice"?(g(!0),k(X,{key:0},Y(t(a),C=>(g(),k("div",{key:`${t(r).id}-${C.id}`,class:d(t(e).option)},[G(xe,{onClick:M(K=>re(C),["stop"]),class:d([t(e).button,ae(C)])},{default:E(()=>[Ae(B(P(C.value)),1)]),_:2},1032,["onClick","class"])],2))),128)):T("",!0),t(r).type==="text"?(g(),k("div",{key:1,class:d([t(e).answer,t(m)?"":t(e).hiddenAnswer]),onClick:M(D,["stop"])},[(g(!0),k(X,null,Y(P(t(r).answer).split(`
`),(C,K)=>(g(),k("p",{key:K},B(C),1))),128))],2)):T("",!0)],2)],2)):T("",!0),t(r)?(g(),k("div",{key:1,onClick:M(le,["stop"]),class:d([t(e).noteContainer,{[t(e).hidden]:!b.value}])},[t(r).note?(g(),k("div",{key:0,class:d(["scroll",[t(e).note,{[t(e).hidden]:!b.value}]])},[t(r).noteImage?(g(),k("img",{key:0,src:`/notes/${t(r).noteImage}`},null,8,Ie)):T("",!0),_("div",{innerHTML:P(t(r).note)},null,8,Pe)],2)):T("",!0)],2)):T("",!0)]),_:1},8,["class"]))}}),Ne="200ms",$e="_counter_1f8nf_4",Be="_question_1f8nf_8",Fe="_text_1f8nf_15",De="_answers_1f8nf_46",Ee="_option_1f8nf_56",Ge="_fadeOut_1f8nf_60",Le="_button_1f8nf_66",He="_correct_1f8nf_66",je="_success_1f8nf_1",Ve="_wrong_1f8nf_73",Ke="_next_1f8nf_80",Ue="_answer_1f8nf_46",We="_hiddenAnswer_1f8nf_93",Je="_navigation_1f8nf_96",Xe="_back_1f8nf_103",Ye="_forward_1f8nf_107",Ze="_disabled_1f8nf_116",et="_progress_1f8nf_120",tt="_correctAnswers_1f8nf_129",nt="_wrongAnswers_1f8nf_135",st="_noteContainer_1f8nf_153",ot="_hidden_1f8nf_93",at="_note_1f8nf_153",rt="_sectionTitle_1f8nf_210",it={pageFadeOutDuration:Ne,counter:$e,question:Be,text:Fe,answers:De,option:Ee,fadeOut:Ge,button:Le,correct:He,"correct-blinking":"_correct-blinking_1f8nf_70",success:je,wrong:Ve,"wrong-fade":"_wrong-fade_1f8nf_77",next:Ke,answer:Ue,hiddenAnswer:We,navigation:Je,back:Xe,forward:Ye,disabled:Ze,progress:et,correctAnswers:tt,wrongAnswers:nt,noteContainer:st,hidden:ot,note:at,sectionTitle:rt},ut={$style:it},vt=be(Re,[["__cssModules",ut]]);export{vt as default};
