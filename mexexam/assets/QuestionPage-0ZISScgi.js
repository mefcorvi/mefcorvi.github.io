import{p as le,q as te,h as W,z as ce,A as J,B as se,C as ve,v as de,x as A,m as S,D as pe,d as ge,i as we,j as D,n as w,b as t,E as _e,o as Q,a as f,w as I,k as X,t as y,c as z,f as P,F as Y,r as Z,s as fe,R as V,G as me}from"./index-D4hfDQEj.js";import{u as he,G as Ae,m as ke,S as Qe,_ as ye}from"./localization-C-adBSIF.js";import{G as Ce}from"./GeneralButton-u7d60ZM2.js";import{u as be,a as ze}from"./questions-BiuSgwHY.js";const G=new WeakMap;function ee(r,e,l={}){const{mode:m="replace",route:u=le(),router:g=te(),transform:c=d=>d}=l;G.has(g)||G.set(g,new Map);const v=G.get(g);let p=u.params[r];ve(()=>{p=void 0});let i;const s=ce((d,C)=>(i=C,{get(){return d(),c(p!==void 0&&p!==""?p:J(e))},set(_){p!==_&&(p=_===e||_===null?void 0:_,v.set(r,_===e||_===null?void 0:_),C(),se(()=>{if(v.size===0)return;const b=Object.fromEntries(v.entries());v.clear();const{params:q,query:h,hash:T}=u;g[J(m)]({params:{...q,...b},query:h,hash:T})}))}}));return W(()=>u.params[r],d=>{p=d,i()},{flush:"sync"}),s}const xe=de(()=>{const r=A(new Map),e=A(new Map),{questions:l,loadAll:m,loadSection:u,reset:g}=be(),c=S(()=>{const a=new Map;for(const O of l.values())O.type==="choice"&&a.set(O.id,O);return a}),v=A(),p=pe({id:-1,value:"I don't know",isAnswer:!1}),i=()=>{let a=v.value;for(;a===v.value&&c.value.size>1;)if(a=Be(c.value,r.value,e.value),!a)return a;return a},s=S(()=>{if(!v.value)return null;const a=l.get(v.value);return a||null}),d=A([]),C=()=>{var a;d.value=[...(((a=s.value)==null?void 0:a.options)??[]).sort(()=>Math.random()-.5),p]},_=A(),b=A(!1),q=a=>{v.value=a},h=a=>l.has(a),T=a=>{if(s.value&&s.value.type==="choice"){if(!d.value.includes(a))throw new Error("Current question does not have the selected option");_.value=a}},L=()=>{_.value&&s.value&&(_.value.isAnswer?(r.value.set(s.value.id,(r.value.get(s.value.id)??0)+1),e.value.set(s.value.id,(e.value.get(s.value.id)??0)-1),(e.value.get(s.value.id)??0)<=0&&e.value.delete(s.value.id)):(e.value.set(s.value.id,(e.value.get(s.value.id)??0)+1),r.value.set(s.value.id,(r.value.get(s.value.id)??0)-1),(r.value.get(s.value.id)??0)<=0&&r.value.delete(s.value.id)))},x=()=>{s.value&&s.value.type==="text"&&(b.value=!0)};W(()=>{var a;return(a=s.value)==null?void 0:a.id},()=>{_.value=void 0,b.value=!1,C()},{immediate:!0,flush:"sync"});const N=S(()=>({correctQuestions:r.value.size,wrongQuestions:e.value.size,unansweredQuestions:c.value.size-r.value.size-e.value.size,totalQuestions:c.value.size,correctPercentage:r.value.size/c.value.size*100,wrongPercentage:e.value.size/c.value.size*100,unansweredPercentage:(c.value.size-r.value.size-e.value.size)/c.value.size*100}));return{startAll:async()=>{await m(),r.value.clear(),e.value.clear()},startSection:async a=>{g(),await u(a),r.value.clear(),e.value.clear()},stat:N,correctCount:S(()=>r.value),correctQuestions:r,wrongQuestions:e,currentOptionsRandomized:d,currentQuestion:s,isAnswerRevealed:b,selectedAnswer:_,wrongCount:S(()=>e.value.size),getRandomQuestionId:i,updateCounters:L,revealAnswer:x,selectAnswer:T,setQuestion:q,hasQuestion:h}});function Be(r,e,l){const m=[...r.keys()],u=m.map(g=>l.has(g)?5:e.has(g)?1/(e.get(g)||1)**2:10);return Oe(m,u)}function Oe(r,e){if(r.length!==e.length)throw new Error("Длины массивов values и weights должны совпадать.");const l=r.length;if(l===0)throw new Error("Массив values не должен быть пустым.");const m=e.reduce((i,s)=>i+s,0);if(m===0)throw new Error("Сумма весов не должна быть равна 0.");const u=new Array(l);for(let i=0;i<l;i++)u[i]=e[i]/m*l;const g=new Array(l),c=[],v=[];for(let i=0;i<l;i++)u[i]<1?c.push(i):v.push(i);for(;c.length>0&&v.length>0;){const i=c.pop(),s=v.pop();g[i]=s,u[s]=u[s]+u[i]-1,u[s]<1?c.push(s):v.push(s)}for(;c.length>0;)u[c.pop()]=1;for(;v.length>0;)u[v.pop()]=1;const p=Math.floor(Math.random()*l);return Math.random()<u[p]?r[p]:r[g[p]]}const Se=ge({__name:"QuestionPage",setup(r){const e=_e(),l=te(),m=ze(),{locale:u,getLanguageName:g}=he(),{startAll:c,startSection:v,stat:p,isAnswerRevealed:i,currentOptionsRandomized:s,currentQuestion:d,getRandomQuestionId:C,revealAnswer:_,selectAnswer:b,updateCounters:q,selectedAnswer:h,setQuestion:T,hasQuestion:L}=xe(),x=ee("id",""),N=ee("sectionId",""),B=A(),j=()=>{if(x.value!=="")if(B.value=void 0,L(x.value))T(x.value);else{const n=C();if(!n){l.replace({name:V.Home});return}l.replace({params:{id:n}})}},a=A(!1);W(()=>[x.value,N.value],async(n,o)=>{o||(o=["",""]),!(!n[0]&&!n[1])&&(n[0]===o[0]&&n[1]===o[1]||((n[1]!==o[1]||!o[1])&&(n[1]?(a.value=!1,await v(n[1])):a.value||(a.value=!0,await c())),j()))},{immediate:!0});let O;const E=A(!1);let R;const ne=()=>{B.value=void 0,window.clearTimeout(O),R=void 0,window.clearTimeout(R),E.value=!0,R=window.setTimeout(async()=>{R=void 0,await l.replace({params:{id:C()}}),await me(h).toBeUndefined(),await se(),E.value=!1},parseInt(e.pageFadeOutDuration,10))},F=()=>{var n,o;if(!R&&!(((n=d.value)==null?void 0:n.type)==="choice"&&!h.value)){if(((o=d.value)==null?void 0:o.type)==="text"&&!i.value){_();return}ne()}},ae=n=>{const o=[];return n.id===-1&&o.push(e.dontKnowOption),h.value?h.value.isAnswer?n===h.value?e.correct:(o.push(e["wrong-fade"]),o):n===B.value?(o.push(e["correct-blinking"]),o):n.isAnswer?(o.push(e.correct),o):(o.push(e.wrong),o):o},re=n=>{if(h.value){F();return}if(b(n),q(),!n.isAnswer){const o=s.value.find(k=>k.isAnswer);B.value=o}O=window.setTimeout(()=>{B.value=void 0},1e3)},$=A(!1),K=S(()=>$.value?"es":u.value),oe=n=>{ue(n)||F()},U=()=>{var n;(n=window.getSelection())!=null&&n.isCollapsed&&($.value=!$.value)},M=n=>m.t(K.value,n),ie=()=>{l.push({name:V.Settings})};function ue(n){const o=n.target;return o.tagName==="BUTTON"||o.tagName==="A"}return(n,o)=>(Q(),we(Ae,{onClick:oe,class:w({[t(e).fadeOut]:E.value})},{topBar:D(()=>[f("div",{class:w(t(e).navigation)},[f("div",{onClick:I(ie,["stop"])},[X(Qe,{type:"mdi",path:t(ke)},null,8,["path"])])],2)]),default:D(()=>[f("div",{class:w(t(e).progress)},[f("div",{class:w(t(e).correctAnswers)},y(t(p).correctQuestions),3),f("div",{class:w(t(e).wrongAnswers)},y(t(p).wrongQuestions),3),f("div",{class:w(t(e).allAnswers)},y(t(p).totalQuestions),3)],2),t(d)?(Q(),z("div",{key:0,class:w(t(e).question)},[f("div",{class:w(t(e).text),onClick:I(U,["stop"])},[f("div",null,[f("div",{class:w(t(e).sectionTitle)},y(M(t(d).section.title)),3),f("div",null,y(M(t(d).question)),1)])],2),f("div",{class:w(t(e).languageButtonContainer)},[t(u)!=="es"?(Q(),z("div",{key:0,onClick:I(U,["stop"]),class:w(t(e).languageButton)},[f("span",{class:w(t(e).languageLabel)},"→ "+y(K.value===t(u)?t(g)("es"):t(g)(t(u))),3)],2)):P("",!0)],2),f("div",{class:w(t(e).answers)},[t(d).type==="choice"?(Q(!0),z(Y,{key:0},Z(t(s),k=>(Q(),z("div",{key:`${t(d).id}-${k.id}`,class:w(t(e).option)},[X(Ce,{onClick:I(H=>re(k),["stop"]),disabled:!!t(h),class:w([t(e).button,ae(k)])},{default:D(()=>[fe(y(M(k.value)),1)]),_:2},1032,["onClick","disabled","class"])],2))),128)):P("",!0),t(d).type==="text"?(Q(),z("div",{key:1,class:w([t(e).answer,t(i)?"":t(e).hiddenAnswer]),onClick:I(F,["stop"])},[(Q(!0),z(Y,null,Z(M(t(d).answer).split(`
`),(k,H)=>(Q(),z("p",{key:H},y(k),1))),128))],2)):P("",!0)],2)],2)):P("",!0)]),_:1},8,["class"]))}}),qe="200ms",Te="_counter_vpivr_4",Re="_question_vpivr_8",Ie="_text_vpivr_15",Me="_languageButtonContainer_vpivr_46",Pe="_answers_vpivr_53",Le="_option_vpivr_63",Ne="_fadeOut_vpivr_67",Ee="_button_vpivr_73",Fe="_correct_vpivr_73",$e="_success_vpivr_1",De="_wrong_vpivr_80",Ge="_next_vpivr_87",We="_answer_vpivr_53",je="_hiddenAnswer_vpivr_100",Ke="_navigation_vpivr_103",Ue="_back_vpivr_110",He="_forward_vpivr_114",Je="_disabled_vpivr_123",Xe="_progress_vpivr_127",Ye="_correctAnswers_vpivr_141",Ze="_wrongAnswers_vpivr_145",Ve="_allAnswers_vpivr_149",et="_sectionTitle_vpivr_164",tt="_languageButton_vpivr_46",st="_languageLabel_vpivr_187",nt={pageFadeOutDuration:qe,counter:Te,question:Re,text:Ie,languageButtonContainer:Me,answers:Pe,option:Le,fadeOut:Ne,button:Ee,correct:Fe,"correct-blinking":"_correct-blinking_vpivr_77",success:$e,wrong:De,"wrong-fade":"_wrong-fade_vpivr_84",next:Ge,answer:We,hiddenAnswer:je,navigation:Ke,back:Ue,forward:He,disabled:Je,progress:Xe,correctAnswers:Ye,wrongAnswers:Ze,allAnswers:Ve,sectionTitle:et,languageButton:tt,languageLabel:st},at={$style:nt},lt=ye(Se,[["__cssModules",at]]);export{lt as default};
