import{u as W}from"./questions-ceva1npV.js";import{u as b}from"./statistics-BywHeOGk.js";import{c as I,t as x}from"./utils-DsLRjVzv.js";import{a as p,k as w,Z as B,w as C,Q as F,_ as K,o as Z,r as _,d as j,e as G}from"./vendor-CiK06CAF.js";const te=I(()=>{const t=p(new Map),e=p(new Map),{questions:l,loadSections:n}=W(),{recordCorrectAnswer:r,recordWrongAnswer:v,recordSessionStart:c,getQuestionStats:d}=b(),f=p(null),s=w(()=>{if(f.value){const u=new Map;for(const o of l.values())o.section.id===f.value&&u.set(o.id,o);return u}return l}),i=w(()=>{const u=new Map;for(const o of s.value.values())o.type==="choice"&&u.set(o.id,o);return u}),g=p(),A=B({id:-1,value:"I don't know",isAnswer:!1}),S=()=>{let u=g.value;for(;u===g.value&&i.value.size>1;)if(u=H(i.value,t.value,e.value),!u)return u;return u},a=w(()=>{if(!g.value)return null;const u=s.value.get(g.value);return u||null}),Q=p([]),y=()=>{var u;Q.value=[...(((u=a.value)==null?void 0:u.options)??[]).sort(()=>Math.random()-.5),A]},h=p(),z=p(!1),M=u=>{g.value=u},q=u=>s.value.has(u),E=u=>{if(a.value&&a.value.type==="choice"){if(!Q.value.includes(u))throw new Error("Current question does not have the selected option");h.value=u}},k=()=>{h.value&&a.value&&(h.value.isAnswer?(t.value.set(a.value.id,(t.value.get(a.value.id)??0)+1),e.value.set(a.value.id,(e.value.get(a.value.id)??0)-1),(e.value.get(a.value.id)??0)<=0&&e.value.delete(a.value.id),r(a.value.id)):(e.value.set(a.value.id,(e.value.get(a.value.id)??0)+1),t.value.set(a.value.id,(t.value.get(a.value.id)??0)-1),(t.value.get(a.value.id)??0)<=0&&t.value.delete(a.value.id),v(a.value.id)))},R=()=>{a.value&&a.value.type==="text"&&(z.value=!0)},D=()=>{a.value&&(t.value.set(a.value.id,(t.value.get(a.value.id)??0)+1),e.value.set(a.value.id,(e.value.get(a.value.id)??0)-1),(e.value.get(a.value.id)??0)<=0&&e.value.delete(a.value.id),r(a.value.id))},O=()=>{a.value&&(e.value.set(a.value.id,(e.value.get(a.value.id)??0)+1),t.value.set(a.value.id,(t.value.get(a.value.id)??0)-1),(t.value.get(a.value.id)??0)<=0&&t.value.delete(a.value.id),v(a.value.id))};C(()=>{var u;return(u=a.value)==null?void 0:u.id},()=>{h.value=void 0,z.value=!1,y()},{immediate:!0,flush:"sync"});const P=w(()=>({correctQuestions:t.value.size,wrongQuestions:e.value.size,unansweredQuestions:i.value.size-t.value.size-e.value.size,totalQuestions:i.value.size,correctPercentage:t.value.size/i.value.size*100,wrongPercentage:e.value.size/i.value.size*100,unansweredPercentage:(i.value.size-t.value.size-e.value.size)/i.value.size*100}));return{startAll:async()=>{await n(),f.value=null,t.value.clear(),e.value.clear();for(const u of l.values())if(u.type==="choice"){const o=d(u.id);o.correctCount>0&&t.value.set(u.id,o.correctCount),o.wrongCount>0&&e.value.set(u.id,o.wrongCount)}c()},startSection:async u=>{await n(),f.value=u,t.value.clear(),e.value.clear();for(const o of l.values())if(o.type==="choice"&&o.section.id===u){const m=d(o.id);m.correctCount>0&&t.value.set(o.id,m.correctCount),m.wrongCount>0&&e.value.set(o.id,m.wrongCount)}c()},stat:P,correctCount:w(()=>t.value),correctQuestions:t,wrongQuestions:e,currentOptionsRandomized:Q,currentQuestion:a,isAnswerRevealed:z,selectedAnswer:h,wrongCount:w(()=>e.value.size),getRandomQuestionId:S,updateCounters:k,revealAnswer:R,selectAnswer:E,setQuestion:M,hasQuestion:q,markQuestionCorrect:D,markQuestionWrong:O}});function H(t,e,l){const n=[...t.keys()],r=n.map(v=>l.has(v)?5:e.has(v)?1/(e.get(v)||1)**2:10);return J(n,r)}function J(t,e){if(t.length!==e.length)throw new Error("Длины массивов values и weights должны совпадать.");const l=t.length;if(l===0)throw new Error("Массив values не должен быть пустым.");const n=e.reduce((s,i)=>s+i,0);if(n===0)throw new Error("Сумма весов не должна быть равна 0.");const r=new Array(l);for(let s=0;s<l;s++)r[s]=e[s]/n*l;const v=new Array(l),c=[],d=[];for(let s=0;s<l;s++)r[s]<1?c.push(s):d.push(s);for(;c.length>0&&d.length>0;){const s=c.pop(),i=d.pop();v[s]=i,r[i]=r[i]+r[s]-1,r[i]<1?c.push(i):d.push(i)}for(;c.length>0;)r[c.pop()]=1;for(;d.length>0;)r[d.pop()]=1;const f=Math.floor(Math.random()*l);return Math.random()<r[f]?t[f]:t[v[f]]}const L=()=>{const t=p(!1),e=j();return e!=null&&e.root.isMounted||(t.value=!0),e!=null&&e.isMounted&&(t.value=!0),F(()=>{t.value=!0}),K(()=>{t.value=!1}),Z(()=>{t.value=!N(e)}),_(t)};function N(t){if(!t)return!1;let e=t.parent;for(;e;){if(e.isDeactivated)return!0;e=e.parent}return!1}function T(t,e,l){let n;x(()=>{n&&(n.stop(),n=void 0)}),C(t,r=>{if(!r){n&&(n.stop(),n=void 0);return}n||(n=G(),n.run(e))},l)}function ae(t,e){T(L(),t,e)}export{ae as a,te as u};
