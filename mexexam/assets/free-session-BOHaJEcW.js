import{u as q}from"./questions-pKEcFAiO.js";import{c as I}from"./utils-BRnDto5j.js";import{a as c,k as h,V as R,w as E}from"./vendor-mc0iK3xg.js";const K=I(()=>{const t=c(new Map),a=c(new Map),{questions:n,loadAll:v,loadSection:r,reset:i}=q(),l=h(()=>{const u=new Map;for(const p of n.values())p.type==="choice"&&u.set(p.id,p);return u}),o=c(),d=R({id:-1,value:"I don't know",isAnswer:!1}),s=()=>{let u=o.value;for(;u===o.value&&l.value.size>1;)if(u=O(l.value,t.value,a.value),!u)return u;return u},e=h(()=>{if(!o.value)return null;const u=n.get(o.value);return u||null}),w=c([]),m=()=>{var u;w.value=[...(((u=e.value)==null?void 0:u.options)??[]).sort(()=>Math.random()-.5),d]},f=c(),g=c(!1),z=u=>{o.value=u},Q=u=>n.has(u),A=u=>{if(e.value&&e.value.type==="choice"){if(!w.value.includes(u))throw new Error("Current question does not have the selected option");f.value=u}},y=()=>{f.value&&e.value&&(f.value.isAnswer?(t.value.set(e.value.id,(t.value.get(e.value.id)??0)+1),a.value.set(e.value.id,(a.value.get(e.value.id)??0)-1),(a.value.get(e.value.id)??0)<=0&&a.value.delete(e.value.id)):(a.value.set(e.value.id,(a.value.get(e.value.id)??0)+1),t.value.set(e.value.id,(t.value.get(e.value.id)??0)-1),(t.value.get(e.value.id)??0)<=0&&t.value.delete(e.value.id)))},M=()=>{e.value&&e.value.type==="text"&&(g.value=!0)},S=()=>{e.value&&(t.value.set(e.value.id,(t.value.get(e.value.id)??0)+1),a.value.set(e.value.id,(a.value.get(e.value.id)??0)-1),(a.value.get(e.value.id)??0)<=0&&a.value.delete(e.value.id))},C=()=>{e.value&&(a.value.set(e.value.id,(a.value.get(e.value.id)??0)+1),t.value.set(e.value.id,(t.value.get(e.value.id)??0)-1),(t.value.get(e.value.id)??0)<=0&&t.value.delete(e.value.id))};E(()=>{var u;return(u=e.value)==null?void 0:u.id},()=>{f.value=void 0,g.value=!1,m()},{immediate:!0,flush:"sync"});const k=h(()=>({correctQuestions:t.value.size,wrongQuestions:a.value.size,unansweredQuestions:l.value.size-t.value.size-a.value.size,totalQuestions:l.value.size,correctPercentage:t.value.size/l.value.size*100,wrongPercentage:a.value.size/l.value.size*100,unansweredPercentage:(l.value.size-t.value.size-a.value.size)/l.value.size*100}));return{startAll:async()=>{await v(),t.value.clear(),a.value.clear()},startSection:async u=>{i(),await r(u),t.value.clear(),a.value.clear()},stat:k,correctCount:h(()=>t.value),correctQuestions:t,wrongQuestions:a,currentOptionsRandomized:w,currentQuestion:e,isAnswerRevealed:g,selectedAnswer:f,wrongCount:h(()=>a.value.size),getRandomQuestionId:s,updateCounters:y,revealAnswer:M,selectAnswer:A,setQuestion:z,hasQuestion:Q,markQuestionCorrect:S,markQuestionWrong:C}});function O(t,a,n){const v=[...t.keys()],r=v.map(i=>n.has(i)?5:a.has(i)?1/(a.get(i)||1)**2:10);return P(v,r)}function P(t,a){if(t.length!==a.length)throw new Error("Длины массивов values и weights должны совпадать.");const n=t.length;if(n===0)throw new Error("Массив values не должен быть пустым.");const v=a.reduce((s,e)=>s+e,0);if(v===0)throw new Error("Сумма весов не должна быть равна 0.");const r=new Array(n);for(let s=0;s<n;s++)r[s]=a[s]/v*n;const i=new Array(n),l=[],o=[];for(let s=0;s<n;s++)r[s]<1?l.push(s):o.push(s);for(;l.length>0&&o.length>0;){const s=l.pop(),e=o.pop();i[s]=e,r[e]=r[e]+r[s]-1,r[e]<1?l.push(e):o.push(e)}for(;l.length>0;)r[l.pop()]=1;for(;o.length>0;)r[o.pop()]=1;const d=Math.floor(Math.random()*n);return Math.random()<r[d]?t[d]:t[i[d]]}export{K as u};
