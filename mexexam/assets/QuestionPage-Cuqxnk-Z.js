import{p as ce,l as ee,q as W,s as de,v as U,x as se,y as ve,z as we,A as x,B as _e,C as O,d as pe,h as fe,i as L,n as _,b as t,D as ge,o as k,a as f,w as R,j as G,t as C,c as y,F as J,r as X,f as P,m as he,R as Y,E as me}from"./index-CTe4ZO8O.js";import{G as xe,m as Ae,S as Z,a as ke,_ as ye}from"./GeneralPage-DZLNdyX5.js";import{G as Qe}from"./GeneralButton-BuJqFcFu.js";import{u as Ce,a as be}from"./questions-CUJ3sEGu.js";const H=new WeakMap;function V(r,s,o={}){const{mode:h="replace",route:u=ce(),router:d=ee(),transform:l=A=>A}=o;H.has(d)||H.set(d,new Map);const v=H.get(d);let w=u.params[r];ve(()=>{w=void 0});let e;const c=de((A,m)=>(e=m,{get(){return A(),l(w!==void 0&&w!==""?w:U(s))},set(p){w!==p&&(w=p===s||p===null?void 0:p,v.set(r,p===s||p===null?void 0:p),m(),se(()=>{if(v.size===0)return;const g=Object.fromEntries(v.entries());v.clear();const{params:T,query:S,hash:I}=u;d[U(h)]({params:{...T,...g},query:S,hash:I})}))}}));return W(()=>u.params[r],A=>{w=A,e()},{flush:"sync"}),c}const ze=we(()=>{const r=x(new Map),s=x(new Map),{questions:o,loadAll:h,loadSection:u,reset:d}=Ce(),l=x(),v=_e({id:-1,value:"I don't know",isAnswer:!1}),w=()=>{let a=l.value;for(;a===l.value&&o.size>1;)if(a=Oe(o,r.value,s.value),!a)return a;return a},e=O(()=>{if(!l.value)return null;const a=o.get(l.value);return a||null}),c=x([]),A=()=>{var a;c.value=[...(((a=e.value)==null?void 0:a.options)??[]).sort(()=>Math.random()-.5),v]},m=x(),p=x(!1),g=a=>{l.value=a},T=a=>o.has(a),S=a=>{if(e.value&&e.value.type==="choice"){if(!c.value.includes(a))throw new Error("Current question does not have the selected option");m.value=a}},I=()=>{m.value&&e.value&&(m.value.isAnswer?(r.value.set(e.value.id,(r.value.get(e.value.id)??0)+1),s.value.set(e.value.id,(s.value.get(e.value.id)??0)-1),(s.value.get(e.value.id)??0)<=0&&s.value.delete(e.value.id)):(s.value.set(e.value.id,(s.value.get(e.value.id)??0)+1),r.value.set(e.value.id,(r.value.get(e.value.id)??0)-1),(r.value.get(e.value.id)??0)<=0&&r.value.delete(e.value.id)))},b=()=>{e.value&&e.value.type==="text"&&(p.value=!0)};W(()=>{var a;return(a=e.value)==null?void 0:a.id},()=>{m.value=void 0,p.value=!1,A()},{immediate:!0,flush:"sync"});const E=O(()=>[...o.values()].filter(a=>a.type==="choice")),Q=O(()=>({correctQuestions:r.value.size,wrongQuestions:s.value.size,unansweredQuestions:o.size-r.value.size-s.value.size,totalQuestions:E.value.length,correctPercentage:r.value.size/o.size*100,wrongPercentage:s.value.size/o.size*100,unansweredPercentage:(o.size-r.value.size-s.value.size)/o.size*100}));return{startAll:async()=>{await h(),r.value.clear(),s.value.clear()},startSection:async a=>{d(),await u(a),r.value.clear(),s.value.clear()},stat:Q,correctCount:O(()=>r.value),correctQuestions:r,wrongQuestions:s,currentOptionsRandomized:c,currentQuestion:e,isAnswerRevealed:p,selectedAnswer:m,wrongCount:O(()=>s.value.size),getRandomQuestionId:w,updateCounters:I,revealAnswer:b,selectAnswer:S,setQuestion:g,hasQuestion:T}});function Oe(r,s,o){const h=[...r.keys()],u=h.map(d=>o.has(d)?(o.get(d)??0)*2:s.has(d)?(s.get(d)??0)/2:1);return Te(h,u)}function Te(r,s){if(r.length!==s.length)throw new Error("Длины массивов values и weights должны совпадать.");const o=r.length;if(o===0)throw new Error("Массив values не должен быть пустым.");const h=s.reduce((e,c)=>e+c,0);if(h===0)throw new Error("Сумма весов не должна быть равна 0.");const u=new Array(o);for(let e=0;e<o;e++)u[e]=s[e]/h*o;const d=new Array(o),l=[],v=[];for(let e=0;e<o;e++)u[e]<1?l.push(e):v.push(e);for(;l.length>0&&v.length>0;){const e=l.pop(),c=v.pop();d[e]=c,u[c]=u[c]+u[e]-1,u[c]<1?l.push(c):v.push(c)}for(;l.length>0;)u[l.pop()]=1;for(;v.length>0;)u[v.pop()]=1;const w=Math.floor(Math.random()*o);return Math.random()<u[w]?r[w]:r[d[w]]}const Se=["src"],Ie=["innerHTML"],qe=pe({__name:"QuestionPage",setup(r){const s=ge(),o=ee(),h=be(),{startAll:u,startSection:d,stat:l,isAnswerRevealed:v,currentOptionsRandomized:w,currentQuestion:e,getRandomQuestionId:c,revealAnswer:A,selectAnswer:m,updateCounters:p,selectedAnswer:g,setQuestion:T,hasQuestion:S}=ze(),I=O(()=>{var n;return((n=e.value)==null?void 0:n.note)!==void 0}),b=V("id",""),E=V("sectionId",""),Q=x(),F=x(!1),j=()=>{if(b.value!=="")if(Q.value=void 0,F.value=!1,S(b.value))T(b.value);else{const n=c();if(!n){o.replace({name:Y.Home});return}o.replace({params:{id:n}})}};W(()=>[b.value,E.value],async(n,i)=>{i||(i=["",""]),!(!n[0]&&!n[1])&&(n[0]===i[0]&&n[1]===i[1]||((n[1]!==i[1]||!i[1])&&(n[1]?await d(n[1]):await u()),j()))},{immediate:!0});let a;const B=x(!1);let q;const te=()=>{Q.value=void 0,window.clearTimeout(a),q=void 0,window.clearTimeout(q),B.value=!0,q=window.setTimeout(async()=>{q=void 0,await o.replace({params:{id:c()}}),await me(g).toBeUndefined(),await se(),B.value=!1},parseInt(s.pageFadeOutDuration,10))},D=()=>{var n,i;if(!q&&!(((n=e.value)==null?void 0:n.type)==="choice"&&!g.value)){if(((i=e.value)==null?void 0:i.type)==="text"&&!v.value){A();return}te()}},ne=n=>{const i=[];return n.id===-1&&i.push(s.dontKnowOption),g.value?g.value.isAnswer?n===g.value?s.correct:(i.push(s["wrong-fade"]),i):n===Q.value?(i.push(s["correct-blinking"]),i):n.isAnswer?(i.push(s.correct),i):(i.push(s.wrong),i):i},oe=n=>{if(g.value){D();return}if(m(n),p(),!n.isAnswer){const i=w.value.find($=>$.isAnswer);Q.value=i}a=window.setTimeout(()=>{Q.value=void 0},1e3)},N=x("es"),ae=n=>{le(n)||D()},re=()=>{var n;(n=window.getSelection())!=null&&n.isCollapsed&&(N.value==="es"?N.value="ru":N.value="es")},M=n=>h.t(N.value,n),ie=()=>{F.value=!0},ue=()=>{o.push({name:Y.Settings})};function le(n){const i=n.target;return i.tagName==="BUTTON"||i.tagName==="A"}return(n,i)=>(k(),fe(xe,{onClick:ae,class:_({[t(s).fadeOut]:B.value})},{topBar:L(()=>[f("div",{class:_(t(s).navigation)},[f("div",{class:_([{[t(s).disabled]:!I.value}]),onClick:R(ie,["stop"])},[G(Z,{type:"mdi",path:t(Ae)},null,8,["path"])],2),f("div",{onClick:R(ue,["stop"])},[G(Z,{type:"mdi",path:t(ke)},null,8,["path"])])],2)]),default:L(()=>{var $;return[f("div",{class:_(t(s).progress)},[f("div",{class:_(t(s).correctAnswers)},C(t(l).correctQuestions),3),f("div",{class:_(t(s).wrongAnswers)},C(t(l).wrongQuestions),3),f("div",{class:_(t(s).allAnswers)},C(t(l).totalQuestions),3)],2),t(e)?(k(),y("div",{key:0,class:_(t(s).question)},[f("div",{class:_(t(s).text),onClick:R(re,["stop"])},[f("div",null,[f("div",{class:_(t(s).sectionTitle)},C(M(t(e).section.title)),3),f("div",null,C(M(t(e).question)),1)])],2),f("div",{class:_(t(s).answers)},[t(e).type==="choice"?(k(!0),y(J,{key:0},X(t(w),z=>(k(),y("div",{key:`${t(e).id}-${z.id}`,class:_(t(s).option)},[G(Qe,{onClick:R(K=>oe(z),["stop"]),disabled:!!t(g),class:_([t(s).button,ne(z)])},{default:L(()=>[he(C(M(z.value)),1)]),_:2},1032,["onClick","disabled","class"])],2))),128)):P("",!0),t(e).type==="text"?(k(),y("div",{key:1,class:_([t(s).answer,t(v)?"":t(s).hiddenAnswer]),onClick:R(D,["stop"])},[(k(!0),y(J,null,X(M(t(e).answer).split(`
`),(z,K)=>(k(),y("p",{key:K},C(z),1))),128))],2)):P("",!0)],2),($=t(e))!=null&&$.note?(k(),y("div",{key:t(e).id,class:_(["scroll",[t(s).note,{[t(s).hidden]:!t(g)||B.value}]])},[t(e).noteImage?(k(),y("img",{key:0,src:`/notes/${t(e).noteImage}`},null,8,Se)):P("",!0),f("div",{innerHTML:M(t(e).note)},null,8,Ie)],2)):P("",!0)],2)):P("",!0)]}),_:1},8,["class"]))}}),Me="200ms",Re="_counter_17esx_4",Pe="_question_17esx_8",Be="_text_17esx_15",Ne="_answers_17esx_46",$e="_option_17esx_56",Ee="_fadeOut_17esx_60",Fe="_button_17esx_66",De="_correct_17esx_66",Le="_success_17esx_1",Ge="_wrong_17esx_73",He="_next_17esx_80",We="_answer_17esx_46",je="_hiddenAnswer_17esx_93",Ke="_navigation_17esx_96",Ue="_back_17esx_103",Je="_forward_17esx_107",Xe="_disabled_17esx_116",Ye="_progress_17esx_120",Ze="_correctAnswers_17esx_134",Ve="_wrongAnswers_17esx_137",es="_allAnswers_17esx_140",ss="_note_17esx_155",ts="_hidden_17esx_93",ns="_sectionTitle_17esx_203",os={pageFadeOutDuration:Me,counter:Re,question:Pe,text:Be,answers:Ne,option:$e,fadeOut:Ee,button:Fe,correct:De,"correct-blinking":"_correct-blinking_17esx_70",success:Le,wrong:Ge,"wrong-fade":"_wrong-fade_17esx_77",next:He,answer:We,hiddenAnswer:je,navigation:Ke,back:Ue,forward:Je,disabled:Xe,progress:Ye,correctAnswers:Ze,wrongAnswers:Ve,allAnswers:es,note:ss,hidden:ts,sectionTitle:ns},as={$style:os},cs=ye(qe,[["__cssModules",as]]);export{cs as default};
