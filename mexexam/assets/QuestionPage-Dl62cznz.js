import{p as de,l as se,q as j,s as ve,v as J,x as te,y as we,z as _e,A as x,B as S,C as fe,d as pe,h as ge,i as G,n as f,b as s,D as he,o as A,a as g,w as P,j as H,t as Q,c as k,F as X,r as Y,f as B,m as me,R as Z,E as xe}from"./index-A6gVzhwH.js";import{G as Ae,m as ke,S as V,a as ye,_ as Qe}from"./GeneralPage-CTpajYoh.js";import{G as Ce}from"./GeneralButton-CFPaq5Fw.js";import{u as be,a as ze}from"./questions-C9u3mUob.js";const W=new WeakMap;function ee(r,e,l={}){const{mode:h="replace",route:d=de(),router:w=se(),transform:u=m=>m}=l;W.has(w)||W.set(w,new Map);const c=W.get(w);let v=d.params[r];we(()=>{v=void 0});let t;const n=ve((m,C)=>(t=C,{get(){return m(),u(v!==void 0&&v!==""?v:J(e))},set(_){v!==_&&(v=_===e||_===null?void 0:_,c.set(r,_===e||_===null?void 0:_),C(),te(()=>{if(c.size===0)return;const p=Object.fromEntries(c.entries());c.clear();const{params:T,query:q,hash:I}=d;w[J(h)]({params:{...T,...p},query:q,hash:I})}))}}));return j(()=>d.params[r],m=>{v=m,t()},{flush:"sync"}),n}const Oe=_e(()=>{const r=x(new Map),e=x(new Map),{questions:l,loadAll:h,loadSection:d,reset:w}=be(),u=S(()=>{const o=new Map;for(const z of l.values())z.type==="choice"&&o.set(z.id,z);return o}),c=x(),v=fe({id:-1,value:"I don't know",isAnswer:!1}),t=()=>{let o=c.value;for(;o===c.value&&u.value.size>1;)if(o=Se(u.value,r.value,e.value),!o)return o;return o},n=S(()=>{if(!c.value)return null;const o=l.get(c.value);return o||null}),m=x([]),C=()=>{var o;m.value=[...(((o=n.value)==null?void 0:o.options)??[]).sort(()=>Math.random()-.5),v]},_=x(),p=x(!1),T=o=>{c.value=o},q=o=>l.has(o),I=o=>{if(n.value&&n.value.type==="choice"){if(!m.value.includes(o))throw new Error("Current question does not have the selected option");_.value=o}},b=()=>{_.value&&n.value&&(_.value.isAnswer?(r.value.set(n.value.id,(r.value.get(n.value.id)??0)+1),e.value.set(n.value.id,(e.value.get(n.value.id)??0)-1),(e.value.get(n.value.id)??0)<=0&&e.value.delete(n.value.id)):(e.value.set(n.value.id,(e.value.get(n.value.id)??0)+1),r.value.set(n.value.id,(r.value.get(n.value.id)??0)-1),(r.value.get(n.value.id)??0)<=0&&r.value.delete(n.value.id)))},F=()=>{n.value&&n.value.type==="text"&&(p.value=!0)};j(()=>{var o;return(o=n.value)==null?void 0:o.id},()=>{_.value=void 0,p.value=!1,C()},{immediate:!0,flush:"sync"});const y=S(()=>({correctQuestions:r.value.size,wrongQuestions:e.value.size,unansweredQuestions:u.value.size-r.value.size-e.value.size,totalQuestions:u.value.size,correctPercentage:r.value.size/u.value.size*100,wrongPercentage:e.value.size/u.value.size*100,unansweredPercentage:(u.value.size-r.value.size-e.value.size)/u.value.size*100}));return{startAll:async()=>{await h(),r.value.clear(),e.value.clear()},startSection:async o=>{w(),await d(o),r.value.clear(),e.value.clear()},stat:y,correctCount:S(()=>r.value),correctQuestions:r,wrongQuestions:e,currentOptionsRandomized:m,currentQuestion:n,isAnswerRevealed:p,selectedAnswer:_,wrongCount:S(()=>e.value.size),getRandomQuestionId:t,updateCounters:b,revealAnswer:F,selectAnswer:I,setQuestion:T,hasQuestion:q}});function Se(r,e,l){const h=[...r.keys()],d=h.map(w=>l.has(w)?5:e.has(w)?1/(e.get(w)||1)**2:10);return Te(h,d)}function Te(r,e){if(r.length!==e.length)throw new Error("Длины массивов values и weights должны совпадать.");const l=r.length;if(l===0)throw new Error("Массив values не должен быть пустым.");const h=e.reduce((t,n)=>t+n,0);if(h===0)throw new Error("Сумма весов не должна быть равна 0.");const d=new Array(l);for(let t=0;t<l;t++)d[t]=e[t]/h*l;const w=new Array(l),u=[],c=[];for(let t=0;t<l;t++)d[t]<1?u.push(t):c.push(t);for(;u.length>0&&c.length>0;){const t=u.pop(),n=c.pop();w[t]=n,d[n]=d[n]+d[t]-1,d[n]<1?u.push(n):c.push(n)}for(;u.length>0;)d[u.pop()]=1;for(;c.length>0;)d[c.pop()]=1;const v=Math.floor(Math.random()*l);return Math.random()<d[v]?r[v]:r[w[v]]}const qe=["src"],Ie=["innerHTML"],Me=pe({__name:"QuestionPage",setup(r){const e=he(),l=se(),h=ze(),{startAll:d,startSection:w,stat:u,isAnswerRevealed:c,currentOptionsRandomized:v,currentQuestion:t,getRandomQuestionId:n,revealAnswer:m,selectAnswer:C,updateCounters:_,selectedAnswer:p,setQuestion:T,hasQuestion:q}=Oe(),I=S(()=>{var a;return((a=t.value)==null?void 0:a.note)!==void 0}),b=ee("id",""),F=ee("sectionId",""),y=x(),D=x(!1),K=()=>{if(b.value!=="")if(y.value=void 0,D.value=!1,q(b.value))T(b.value);else{const a=n();if(!a){l.replace({name:Z.Home});return}l.replace({params:{id:a}})}},o=x(!1);j(()=>[b.value,F.value],async(a,i)=>{i||(i=["",""]),!(!a[0]&&!a[1])&&(a[0]===i[0]&&a[1]===i[1]||((a[1]!==i[1]||!i[1])&&(a[1]?(o.value=!1,await w(a[1])):o.value||(o.value=!0,await d())),K()))},{immediate:!0});let z;const N=x(!1);let M;const ne=()=>{y.value=void 0,window.clearTimeout(z),M=void 0,window.clearTimeout(M),N.value=!0,M=window.setTimeout(async()=>{M=void 0,await l.replace({params:{id:n()}}),await xe(p).toBeUndefined(),await te(),N.value=!1},parseInt(e.pageFadeOutDuration,10))},L=()=>{var a,i;if(!M&&!(((a=t.value)==null?void 0:a.type)==="choice"&&!p.value)){if(((i=t.value)==null?void 0:i.type)==="text"&&!c.value){m();return}ne()}},ae=a=>{const i=[];return a.id===-1&&i.push(e.dontKnowOption),p.value?p.value.isAnswer?a===p.value?e.correct:(i.push(e["wrong-fade"]),i):a===y.value?(i.push(e["correct-blinking"]),i):a.isAnswer?(i.push(e.correct),i):(i.push(e.wrong),i):i},oe=a=>{if(p.value){L();return}if(C(a),_(),!a.isAnswer){const i=v.value.find(E=>E.isAnswer);y.value=i}z=window.setTimeout(()=>{y.value=void 0},1e3)},$=x("es"),re=a=>{ce(a)||L()},ie=()=>{var a;(a=window.getSelection())!=null&&a.isCollapsed&&($.value==="es"?$.value="ru":$.value="es")},R=a=>h.t($.value,a),ue=()=>{D.value=!0},le=()=>{l.push({name:Z.Settings})};function ce(a){const i=a.target;return i.tagName==="BUTTON"||i.tagName==="A"}return(a,i)=>(A(),ge(Ae,{onClick:re,class:f({[s(e).fadeOut]:N.value})},{topBar:G(()=>[g("div",{class:f(s(e).navigation)},[g("div",{class:f([{[s(e).disabled]:!I.value}]),onClick:P(ue,["stop"])},[H(V,{type:"mdi",path:s(ke)},null,8,["path"])],2),g("div",{onClick:P(le,["stop"])},[H(V,{type:"mdi",path:s(ye)},null,8,["path"])])],2)]),default:G(()=>{var E;return[g("div",{class:f(s(e).progress)},[g("div",{class:f(s(e).correctAnswers)},Q(s(u).correctQuestions),3),g("div",{class:f(s(e).wrongAnswers)},Q(s(u).wrongQuestions),3),g("div",{class:f(s(e).allAnswers)},Q(s(u).totalQuestions),3)],2),s(t)?(A(),k("div",{key:0,class:f(s(e).question)},[g("div",{class:f(s(e).text),onClick:P(ie,["stop"])},[g("div",null,[g("div",{class:f(s(e).sectionTitle)},Q(R(s(t).section.title)),3),g("div",null,Q(R(s(t).question)),1)])],2),g("div",{class:f(s(e).answers)},[s(t).type==="choice"?(A(!0),k(X,{key:0},Y(s(v),O=>(A(),k("div",{key:`${s(t).id}-${O.id}`,class:f(s(e).option)},[H(Ce,{onClick:P(U=>oe(O),["stop"]),disabled:!!s(p),class:f([s(e).button,ae(O)])},{default:G(()=>[me(Q(R(O.value)),1)]),_:2},1032,["onClick","disabled","class"])],2))),128)):B("",!0),s(t).type==="text"?(A(),k("div",{key:1,class:f([s(e).answer,s(c)?"":s(e).hiddenAnswer]),onClick:P(L,["stop"])},[(A(!0),k(X,null,Y(R(s(t).answer).split(`
`),(O,U)=>(A(),k("p",{key:U},Q(O),1))),128))],2)):B("",!0)],2),(E=s(t))!=null&&E.note?(A(),k("div",{key:s(t).id,class:f(["scroll",[s(e).note,{[s(e).hidden]:!s(p)||N.value}]])},[s(t).noteImage?(A(),k("img",{key:0,src:`/notes/${s(t).noteImage}`},null,8,qe)):B("",!0),g("div",{innerHTML:R(s(t).note)},null,8,Ie)],2)):B("",!0)],2)):B("",!0)]}),_:1},8,["class"]))}}),Re="200ms",Pe="_counter_17esx_4",Be="_question_17esx_8",Ne="_text_17esx_15",$e="_answers_17esx_46",Ee="_option_17esx_56",Fe="_fadeOut_17esx_60",De="_button_17esx_66",Le="_correct_17esx_66",Ge="_success_17esx_1",He="_wrong_17esx_73",We="_next_17esx_80",je="_answer_17esx_46",Ke="_hiddenAnswer_17esx_93",Ue="_navigation_17esx_96",Je="_back_17esx_103",Xe="_forward_17esx_107",Ye="_disabled_17esx_116",Ze="_progress_17esx_120",Ve="_correctAnswers_17esx_134",es="_wrongAnswers_17esx_137",ss="_allAnswers_17esx_140",ts="_note_17esx_155",ns="_hidden_17esx_93",as="_sectionTitle_17esx_203",os={pageFadeOutDuration:Re,counter:Pe,question:Be,text:Ne,answers:$e,option:Ee,fadeOut:Fe,button:De,correct:Le,"correct-blinking":"_correct-blinking_17esx_70",success:Ge,wrong:He,"wrong-fade":"_wrong-fade_17esx_77",next:We,answer:je,hiddenAnswer:Ke,navigation:Ue,back:Je,forward:Xe,disabled:Ye,progress:Ze,correctAnswers:Ve,wrongAnswers:es,allAnswers:ss,note:ts,hidden:ns,sectionTitle:as},rs={$style:os},ds=Qe(Me,[["__cssModules",rs]]);export{ds as default};
