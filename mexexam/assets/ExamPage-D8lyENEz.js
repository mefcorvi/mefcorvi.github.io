import{v as oe,x as f,m as b,d as le,y as ie,i as re,j as O,q as ce,p as ue,o as d,a as t,b as i,c as _,t as l,n as T,f as de,F as $,r as q,k as se,s as te,R as ve}from"./index-Ca6MFhOh.js";import{u as me,G as _e,_ as he}from"./localization-C-5DZP1f.js";import{G as ne}from"./GeneralButton-5IfIYKQL.js";import{u as fe,a as pe}from"./questions-C-b2EzHM.js";const we=10,D=we*60*1e3,ge=oe(()=>{const{questions:ae,loadAll:V,loadSection:H}=fe(),v=f([]),y=f(new Map),u=f(new Map),E=f(!1),m=f(!1),p=f(null),S=f(null),g=f(D),A=f(null),L=b(()=>{const n=[];for(const e of ae.values())e.type==="choice"&&n.push(e);return n}),N=(n=10)=>{const e=[...L.value],r=[];for(let s=0;s<Math.min(n,e.length);s++){const o=Math.floor(Math.random()*e.length);r.push(e[o]),e.splice(o,1)}return r},B=n=>{const e=[...n];for(let r=e.length-1;r>0;r--){const s=Math.floor(Math.random()*(r+1));[e[r],e[s]]=[e[s],e[r]]}return e},Q=()=>{S.value=Date.now(),g.value=D,A.value=window.setInterval(()=>{if(S.value){const n=Date.now()-S.value;g.value=Math.max(0,D-n),g.value<=0&&(M(),R())}},1e3)},M=()=>{A.value&&(clearInterval(A.value),A.value=null)},U=n=>{const e=Math.ceil(n/1e3),r=Math.floor(e/60),s=e%60;return`${r.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`},z=async n=>{n?await H(n):await V(),v.value=N(10),y.value.clear();for(const e of v.value)e.options&&y.value.set(e.id,B(e.options));u.value.clear(),E.value=!0,m.value=!1,p.value=null,Q()},F=(n,e)=>{m.value||u.value.set(n,e)},I=n=>u.value.get(n)??null,R=()=>{var s;if(m.value)return;M();const n=[];let e=0,r=0;for(const o of v.value){const x=u.value.get(o.id),w=(s=o.options)==null?void 0:s.find(k=>k.id===x),C=(w==null?void 0:w.isAnswer)??!1;n.push({questionId:o.id,selectedOptionId:x??null,isCorrect:C}),C?e++:r++}p.value={correctAnswers:e,wrongAnswers:r,totalQuestions:v.value.length,percentage:Math.round(e/v.value.length*100),answers:n},m.value=!0},P=()=>{M(),v.value=[],y.value.clear(),u.value.clear(),E.value=!1,m.value=!1,p.value=null,S.value=null,g.value=D},j=n=>y.value.get(n.id)??[],X=n=>v.value.find(e=>e.id===n),W=n=>{var e;return(e=p.value)==null?void 0:e.answers.find(r=>r.questionId===n)},J=b(()=>v.value.length>0&&u.value.size===v.value.length),K=b(()=>u.value.size),c=b(()=>U(g.value)),G=b(()=>g.value<=3e4);return{examQuestions:v,userAnswers:u,isExamStarted:E,isExamFinished:m,examResults:p,timeRemaining:g,formattedTimeRemaining:c,isTimeRunningOut:G,startExam:z,selectAnswer:F,getSelectedAnswer:I,finishExam:R,resetExam:P,getRandomizedOptions:j,getQuestionById:X,getAnswerById:W,isAllQuestionsAnswered:J,answeredQuestionsCount:K}}),xe={class:"exam-header"},Ae=["title"],Ce={key:0,class:"loading"},Ee={key:1,class:"exam-content"},Se={class:"questions-list"},ke={class:"question-header"},ye={class:"question-number"},Qe={class:"question-text"},Re={class:"options-list"},Te=["name","value","checked","onChange","disabled"],be={class:"option-text"},Me={class:"finish-section"},Ie={key:2,class:"results-content"},Oe={class:"results-header"},Ne={class:"results-summary"},Be={class:"result-item correct"},Ue={class:"result-label"},ze={class:"result-value"},Fe={class:"result-item wrong"},Ge={class:"result-label"},$e={class:"result-value"},qe={class:"result-item total"},De={class:"result-label"},Ve={class:"result-value"},He={class:"result-item percentage"},Le={class:"result-label"},Pe={class:"result-value"},je={class:"results-questions"},Xe={class:"question-header"},We={class:"question-number"},Je={class:"question-text"},Ke={class:"options-list"},Ye={class:"option-text"},Ze={class:"actions"},es=le({__name:"ExamPage",setup(ae){const V=ce(),H=ue(),v=pe(),{locale:y}=me(),{examQuestions:u,isExamStarted:E,isExamFinished:m,examResults:p,startExam:S,selectAnswer:g,getSelectedAnswer:A,finishExam:L,resetExam:N,getRandomizedOptions:B,getAnswerById:Q,formattedTimeRemaining:M,isTimeRunningOut:U,isAllQuestionsAnswered:z}=ge(),F=b(()=>H.params.sectionId),I=f(new Map),R=f(!1);ie(async()=>{E.value||await S(F.value)});const P=(s,o)=>{g(s,o),R.value=!1},j=()=>{for(const s of u.value)if(A(s.id)===null)return s.id;return null},X=s=>{const o=I.value.get(s);o&&o.scrollIntoView({behavior:"smooth",block:"center"})},W=()=>{if(z.value)L(),window.scrollTo(0,0);else{R.value=!0;const s=j();s&&X(s)}},J=async()=>{N(),window.scrollTo(0,0),await S(F.value)},K=()=>{N(),V.push({name:ve.Home})},c=s=>v.t(y.value,s),G=s=>{if(!m.value)return"";const o=Q(s);return o?o.isCorrect?"correct":"wrong":""},n=(s,o)=>{var k;if(!m.value)return"";const x=Q(s);if(!x)return"";const w=u.value.find(a=>a.id===s),C=(k=w==null?void 0:w.options)==null?void 0:k.find(a=>a.id===o);return C?C.isAnswer?"correct-answer":x.selectedOptionId===o&&!x.isCorrect?"wrong-answer":"":""},e=(s,o)=>{o?I.value.set(s,o):I.value.delete(s)},r=s=>A(s)===null;return(s,o)=>(d(),re(_e,null,{topBar:O(()=>[t("div",xe,[i(E)&&!i(m)?(d(),_("div",{key:0,class:T(["timer",{"time-running-out":i(U)}]),title:i(U)?c("Time is running out!"):c("Time remaining")},l(i(M)),11,Ae)):de("",!0)])]),default:O(()=>{var x,w,C,k;return[i(E)?i(m)?(d(),_("div",Ie,[t("div",Oe,[t("h2",null,l(c("Exam Results")),1),t("div",Ne,[t("div",Be,[t("span",Ue,l(c("Correct")),1),t("span",ze,l((x=i(p))==null?void 0:x.correctAnswers),1)]),t("div",Fe,[t("span",Ge,l(c("Wrong")),1),t("span",$e,l((w=i(p))==null?void 0:w.wrongAnswers),1)]),t("div",qe,[t("span",De,l(c("Total")),1),t("span",Ve,l((C=i(p))==null?void 0:C.totalQuestions),1)]),t("div",He,[t("span",Le,l(c("Score")),1),t("span",Pe,l((k=i(p))==null?void 0:k.percentage)+"%",1)])])]),t("div",je,[(d(!0),_($,null,q(i(u),(a,Y)=>{var h,Z;return d(),_("div",{key:a.id,class:T(["result-question",G(a.id)])},[t("div",Xe,[t("span",We,l(Y+1)+".",1),t("span",Je,l(a.question),1),t("span",{class:T(["result-indicator",(h=i(Q)(a.id))!=null&&h.isCorrect?"correct":"wrong"])},l((Z=i(Q)(a.id))!=null&&Z.isCorrect?"✓":"✗"),3)]),t("div",Ke,[(d(!0),_($,null,q(i(B)(a),ee=>(d(),_("div",{key:ee.id,class:T(["option-item",n(a.id,ee.id)])},[t("span",Ye,l(ee.value),1)],2))),128))])],2)}),128))]),t("div",Ze,[se(ne,{onClick:J,class:"new-exam-button"},{default:O(()=>[te(l(c("Start New Exam")),1)]),_:1}),se(ne,{onClick:K,class:"home-button"},{default:O(()=>[te(l(c("Go Home")),1)]),_:1})])])):(d(),_("div",Ee,[t("div",Se,[(d(!0),_($,null,q(i(u),(a,Y)=>(d(),_("div",{key:a.id,class:T(["question-item",G(a.id),{"unanswered-highlight":R.value&&r(a.id)}]),ref_for:!0,ref:h=>e(a.id,h)},[t("div",ke,[t("span",ye,l(Y+1)+".",1),t("span",Qe,l(a.question),1)]),t("div",Re,[(d(!0),_($,null,q(i(B)(a),h=>(d(),_("label",{key:h.id,class:T(["option-item",n(a.id,h.id)])},[t("input",{type:"radio",name:`question-${a.id}`,value:h.id,checked:i(A)(a.id)===h.id,onChange:Z=>P(a.id,h.id),disabled:i(m)},null,40,Te),t("span",be,l(h.value),1)],2))),128))])],2))),128))]),t("div",Me,[se(ne,{onClick:W,class:"finish-button"},{default:O(()=>[te(l(i(z)?c("Finish Exam"):c("Check Unanswered Questions")),1)]),_:1})])])):(d(),_("div",Ce,l(c("Loading exam...")),1))]}),_:1}))}}),os=he(es,[["__scopeId","data-v-94f59055"]]);export{os as default};
