import{p as le,q as te,h as W,z as ce,A as J,B as se,C as de,v as ve,x as k,m as O,D as we,d as ge,i as _e,j as D,n as _,b as t,E as fe,o as A,a as p,w as I,k as X,t as Q,c as b,f as P,F as Y,r as Z,s as pe,R as V,G as me}from"./index-C8uGTums.js";import{u as he,G as ke,m as qe,S as Ae,_ as Qe}from"./localization-CACs2PTF.js";import{G as ye}from"./GeneralButton-ECvFuS4o.js";import{u as Ce,a as be}from"./questions-89nltnAh.js";const G=new WeakMap;function ee(o,e,l={}){const{mode:m="replace",route:i=le(),router:g=te(),transform:c=v=>v}=l;G.has(g)||G.set(g,new Map);const d=G.get(g);let w=i.params[o];de(()=>{w=void 0});let u;const s=ce((v,y)=>(u=y,{get(){return v(),c(w!==void 0&&w!==""?w:J(e))},set(f){w!==f&&(w=f===e||f===null?void 0:f,d.set(o,f===e||f===null?void 0:f),y(),se(()=>{if(d.size===0)return;const C=Object.fromEntries(d.entries());d.clear();const{params:S,query:h,hash:T}=i;g[J(m)]({params:{...S,...C},query:h,hash:T})}))}}));return W(()=>i.params[o],v=>{w=v,u()},{flush:"sync"}),s}const ze=ve(()=>{const o=k(new Map),e=k(new Map),{questions:l,loadAll:m,loadSection:i,reset:g}=Ce(),c=O(()=>{const a=new Map;for(const B of l.values())B.type==="choice"&&a.set(B.id,B);return a}),d=k(),w=we({id:-1,value:"I don't know",isAnswer:!1}),u=()=>{let a=d.value;for(;a===d.value&&c.value.size>1;)if(a=xe(c.value,o.value,e.value),!a)return a;return a},s=O(()=>{if(!d.value)return null;const a=l.get(d.value);return a||null}),v=k([]),y=()=>{var a;v.value=[...(((a=s.value)==null?void 0:a.options)??[]).sort(()=>Math.random()-.5),w]},f=k(),C=k(!1),S=a=>{d.value=a},h=a=>l.has(a),T=a=>{if(s.value&&s.value.type==="choice"){if(!v.value.includes(a))throw new Error("Current question does not have the selected option");f.value=a}},L=()=>{f.value&&s.value&&(f.value.isAnswer?(o.value.set(s.value.id,(o.value.get(s.value.id)??0)+1),e.value.set(s.value.id,(e.value.get(s.value.id)??0)-1),(e.value.get(s.value.id)??0)<=0&&e.value.delete(s.value.id)):(e.value.set(s.value.id,(e.value.get(s.value.id)??0)+1),o.value.set(s.value.id,(o.value.get(s.value.id)??0)-1),(o.value.get(s.value.id)??0)<=0&&o.value.delete(s.value.id)))},z=()=>{s.value&&s.value.type==="text"&&(C.value=!0)};W(()=>{var a;return(a=s.value)==null?void 0:a.id},()=>{f.value=void 0,C.value=!1,y()},{immediate:!0,flush:"sync"});const N=O(()=>({correctQuestions:o.value.size,wrongQuestions:e.value.size,unansweredQuestions:c.value.size-o.value.size-e.value.size,totalQuestions:c.value.size,correctPercentage:o.value.size/c.value.size*100,wrongPercentage:e.value.size/c.value.size*100,unansweredPercentage:(c.value.size-o.value.size-e.value.size)/c.value.size*100}));return{startAll:async()=>{await m(),o.value.clear(),e.value.clear()},startSection:async a=>{g(),await i(a),o.value.clear(),e.value.clear()},stat:N,correctCount:O(()=>o.value),correctQuestions:o,wrongQuestions:e,currentOptionsRandomized:v,currentQuestion:s,isAnswerRevealed:C,selectedAnswer:f,wrongCount:O(()=>e.value.size),getRandomQuestionId:u,updateCounters:L,revealAnswer:z,selectAnswer:T,setQuestion:S,hasQuestion:h}});function xe(o,e,l){const m=[...o.keys()],i=m.map(g=>l.has(g)?5:e.has(g)?1/(e.get(g)||1)**2:10);return Be(m,i)}function Be(o,e){if(o.length!==e.length)throw new Error("Длины массивов values и weights должны совпадать.");const l=o.length;if(l===0)throw new Error("Массив values не должен быть пустым.");const m=e.reduce((u,s)=>u+s,0);if(m===0)throw new Error("Сумма весов не должна быть равна 0.");const i=new Array(l);for(let u=0;u<l;u++)i[u]=e[u]/m*l;const g=new Array(l),c=[],d=[];for(let u=0;u<l;u++)i[u]<1?c.push(u):d.push(u);for(;c.length>0&&d.length>0;){const u=c.pop(),s=d.pop();g[u]=s,i[s]=i[s]+i[u]-1,i[s]<1?c.push(s):d.push(s)}for(;c.length>0;)i[c.pop()]=1;for(;d.length>0;)i[d.pop()]=1;const w=Math.floor(Math.random()*l);return Math.random()<i[w]?o[w]:o[g[w]]}const Oe=ge({__name:"QuestionPage",setup(o){const e=fe(),l=te(),m=be(),{locale:i,getLanguageName:g}=he(),{startAll:c,startSection:d,stat:w,isAnswerRevealed:u,currentOptionsRandomized:s,currentQuestion:v,getRandomQuestionId:y,revealAnswer:f,selectAnswer:C,updateCounters:S,selectedAnswer:h,setQuestion:T,hasQuestion:L}=ze(),z=ee("id",""),N=ee("sectionId",""),x=k(),j=()=>{if(z.value!=="")if(x.value=void 0,L(z.value))T(z.value);else{const n=y();if(!n){l.replace({name:V.Home});return}l.replace({params:{id:n}})}},a=k(!1);W(()=>[z.value,N.value],async(n,r)=>{r||(r=["",""]),!(!n[0]&&!n[1])&&(n[0]===r[0]&&n[1]===r[1]||((n[1]!==r[1]||!r[1])&&(n[1]?(a.value=!1,await d(n[1])):a.value||(a.value=!0,await c())),j()))},{immediate:!0});let B;const E=k(!1);let R;const ne=()=>{x.value=void 0,window.clearTimeout(B),R=void 0,window.clearTimeout(R),E.value=!0,R=window.setTimeout(async()=>{R=void 0,await l.replace({params:{id:y()}}),await me(h).toBeUndefined(),await se(),E.value=!1},parseInt(e.pageFadeOutDuration,10))},F=()=>{var n,r;if(!R&&!(((n=v.value)==null?void 0:n.type)==="choice"&&!h.value)){if(((r=v.value)==null?void 0:r.type)==="text"&&!u.value){f();return}ne()}},ae=n=>{const r=[];return n.id===-1&&r.push(e.dontKnowOption),h.value?h.value.isAnswer?n===h.value?e.correct:(r.push(e["wrong-fade"]),r):n===x.value?(r.push(e["correct-blinking"]),r):n.isAnswer?(r.push(e.correct),r):(r.push(e.wrong),r):r},oe=n=>{if(h.value){F();return}if(C(n),S(),!n.isAnswer){const r=s.value.find(q=>q.isAnswer);x.value=r}B=window.setTimeout(()=>{x.value=void 0},1e3)},$=k(!1),K=O(()=>$.value?"es":i.value),re=n=>{ie(n)||F()},U=()=>{var n;(n=window.getSelection())!=null&&n.isCollapsed&&($.value=!$.value)},M=n=>m.t(K.value,n),ue=()=>{l.push({name:V.Settings})};function ie(n){const r=n.target;return r.tagName==="BUTTON"||r.tagName==="A"}return(n,r)=>(A(),_e(ke,{onClick:re,class:_({[t(e).fadeOut]:E.value})},{topBar:D(()=>[p("div",{class:_(t(e).navigation)},[p("div",{onClick:I(ue,["stop"])},[X(Ae,{type:"mdi",path:t(qe)},null,8,["path"])])],2)]),default:D(()=>[p("div",{class:_(t(e).progress)},[p("div",{class:_(t(e).correctAnswers)},Q(t(w).correctQuestions),3),p("div",{class:_(t(e).wrongAnswers)},Q(t(w).wrongQuestions),3),p("div",{class:_(t(e).allAnswers)},Q(t(w).totalQuestions),3)],2),t(v)?(A(),b("div",{key:0,class:_(t(e).question)},[p("div",{class:_(t(e).text),onClick:I(U,["stop"])},[p("div",null,[p("div",{class:_(t(e).sectionTitle)},Q(M(t(v).section.title)),3),p("div",null,Q(M(t(v).question)),1)])],2),p("div",{class:_(t(e).languageButtonContainer)},[t(i)!=="es"?(A(),b("div",{key:0,onClick:I(U,["stop"]),class:_(t(e).languageButton)},[p("span",{class:_(t(e).languageLabel)},"→ "+Q(K.value===t(i)?t(g)("es"):t(g)(t(i))),3)],2)):P("",!0)],2),p("div",{class:_(t(e).answers)},[t(v).type==="choice"?(A(!0),b(Y,{key:0},Z(t(s),q=>(A(),b("div",{key:`${t(v).id}-${q.id}`,class:_(t(e).option)},[X(ye,{onClick:I(H=>oe(q),["stop"]),disabled:!!t(h),class:_([t(e).button,ae(q)])},{default:D(()=>[pe(Q(M(q.value)),1)]),_:2},1032,["onClick","disabled","class"])],2))),128)):P("",!0),t(v).type==="text"?(A(),b("div",{key:1,class:_([t(e).answer,t(u)?"":t(e).hiddenAnswer]),onClick:I(F,["stop"])},[(A(!0),b(Y,null,Z(M(t(v).answer).split(`
`),(q,H)=>(A(),b("p",{key:H},Q(q),1))),128))],2)):P("",!0)],2)],2)):P("",!0)]),_:1},8,["class"]))}}),Se="200ms",Te="_counter_8kw7q_4",Re="_question_8kw7q_8",Ie="_text_8kw7q_15",Me="_languageButtonContainer_8kw7q_46",Pe="_answers_8kw7q_53",Le="_option_8kw7q_63",Ne="_fadeOut_8kw7q_67",Ee="_button_8kw7q_73",Fe="_correct_8kw7q_73",$e="_success_8kw7q_1",De="_wrong_8kw7q_80",Ge="_next_8kw7q_87",We="_answer_8kw7q_53",je="_hiddenAnswer_8kw7q_100",Ke="_navigation_8kw7q_103",Ue="_back_8kw7q_110",He="_forward_8kw7q_114",Je="_disabled_8kw7q_123",Xe="_progress_8kw7q_127",Ye="_correctAnswers_8kw7q_141",Ze="_wrongAnswers_8kw7q_145",Ve="_allAnswers_8kw7q_149",et="_sectionTitle_8kw7q_164",tt="_languageButton_8kw7q_46",st="_languageLabel_8kw7q_189",nt={pageFadeOutDuration:Se,counter:Te,question:Re,text:Ie,languageButtonContainer:Me,answers:Pe,option:Le,fadeOut:Ne,button:Ee,correct:Fe,"correct-blinking":"_correct-blinking_8kw7q_77",success:$e,wrong:De,"wrong-fade":"_wrong-fade_8kw7q_84",next:Ge,answer:We,hiddenAnswer:je,navigation:Ke,back:Ue,forward:He,disabled:Je,progress:Xe,correctAnswers:Ye,wrongAnswers:Ze,allAnswers:Ve,sectionTitle:et,languageButton:tt,languageLabel:st},at={$style:nt},lt=Qe(Oe,[["__cssModules",at]]);export{lt as default};
