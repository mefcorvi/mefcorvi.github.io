import{q as ue,m as ee,h as U,s as le,v as H,x as te,y as ce,z as de,A as b,B as I,C as ve,d as pe,i as we,j as F,n as g,b as n,D as ge,o as C,a as _,w as M,k as $,t as A,c as q,F as J,r as X,f as D,p as _e,R as Y,E as fe}from"./index-1dHLU1mh.js";import{u as me,G as he,m as be,S as Z,a as xe,_ as Ae}from"./localization-DoTCwgwX.js";import{G as ke}from"./GeneralButton-B5GnZ9rL.js";import{u as ye,a as Qe}from"./questions-CQDnNAF7.js";const G=new WeakMap;function V(o,e,l={}){const{mode:m="replace",route:c=ue(),router:p=ee(),transform:d=f=>f}=l;G.has(p)||G.set(p,new Map);const u=G.get(p);let v=c.params[o];ce(()=>{v=void 0});let i;const t=le((f,z)=>(i=z,{get(){return f(),d(v!==void 0&&v!==""?v:H(e))},set(w){v!==w&&(v=w===e||w===null?void 0:w,u.set(o,w===e||w===null?void 0:w),z(),te(()=>{if(u.size===0)return;const k=Object.fromEntries(u.entries());u.clear();const{params:h,query:S,hash:T}=c;p[H(m)]({params:{...h,...k},query:S,hash:T})}))}}));return U(()=>c.params[o],f=>{v=f,i()},{flush:"sync"}),t}const Ce=de(()=>{const o=b(new Map),e=b(new Map),{questions:l,loadAll:m,loadSection:c,reset:p}=ye(),d=I(()=>{const a=new Map;for(const Q of l.values())Q.type==="choice"&&a.set(Q.id,Q);return a}),u=b(),v=ve({id:-1,value:"I don't know",isAnswer:!1}),i=()=>{let a=u.value;for(;a===u.value&&d.value.size>1;)if(a=ze(d.value,o.value,e.value),!a)return a;return a},t=I(()=>{if(!u.value)return null;const a=l.get(u.value);return a||null}),f=b([]),z=()=>{var a;f.value=[...(((a=t.value)==null?void 0:a.options)??[]).sort(()=>Math.random()-.5),v]},w=b(),k=b(!1),h=a=>{u.value=a},S=a=>l.has(a),T=a=>{if(t.value&&t.value.type==="choice"){if(!f.value.includes(a))throw new Error("Current question does not have the selected option");w.value=a}},O=()=>{w.value&&t.value&&(w.value.isAnswer?(o.value.set(t.value.id,(o.value.get(t.value.id)??0)+1),e.value.set(t.value.id,(e.value.get(t.value.id)??0)-1),(e.value.get(t.value.id)??0)<=0&&e.value.delete(t.value.id)):(e.value.set(t.value.id,(e.value.get(t.value.id)??0)+1),o.value.set(t.value.id,(o.value.get(t.value.id)??0)-1),(o.value.get(t.value.id)??0)<=0&&o.value.delete(t.value.id)))},N=()=>{t.value&&t.value.type==="text"&&(k.value=!0)};U(()=>{var a;return(a=t.value)==null?void 0:a.id},()=>{w.value=void 0,k.value=!1,z()},{immediate:!0,flush:"sync"});const y=I(()=>({correctQuestions:o.value.size,wrongQuestions:e.value.size,unansweredQuestions:d.value.size-o.value.size-e.value.size,totalQuestions:d.value.size,correctPercentage:o.value.size/d.value.size*100,wrongPercentage:e.value.size/d.value.size*100,unansweredPercentage:(d.value.size-o.value.size-e.value.size)/d.value.size*100}));return{startAll:async()=>{await m(),o.value.clear(),e.value.clear()},startSection:async a=>{p(),await c(a),o.value.clear(),e.value.clear()},stat:y,correctCount:I(()=>o.value),correctQuestions:o,wrongQuestions:e,currentOptionsRandomized:f,currentQuestion:t,isAnswerRevealed:k,selectedAnswer:w,wrongCount:I(()=>e.value.size),getRandomQuestionId:i,updateCounters:O,revealAnswer:N,selectAnswer:T,setQuestion:h,hasQuestion:S}});function ze(o,e,l){const m=[...o.keys()],c=m.map(p=>l.has(p)?5:e.has(p)?1/(e.get(p)||1)**2:10);return Oe(m,c)}function Oe(o,e){if(o.length!==e.length)throw new Error("Длины массивов values и weights должны совпадать.");const l=o.length;if(l===0)throw new Error("Массив values не должен быть пустым.");const m=e.reduce((i,t)=>i+t,0);if(m===0)throw new Error("Сумма весов не должна быть равна 0.");const c=new Array(l);for(let i=0;i<l;i++)c[i]=e[i]/m*l;const p=new Array(l),d=[],u=[];for(let i=0;i<l;i++)c[i]<1?d.push(i):u.push(i);for(;d.length>0&&u.length>0;){const i=d.pop(),t=u.pop();p[i]=t,c[t]=c[t]+c[i]-1,c[t]<1?d.push(t):u.push(t)}for(;d.length>0;)c[d.pop()]=1;for(;u.length>0;)c[u.pop()]=1;const v=Math.floor(Math.random()*l);return Math.random()<c[v]?o[v]:o[p[v]]}const qe=pe({__name:"QuestionPage",setup(o){const e=ge(),l=ee(),m=Qe(),{locale:c}=me(),{startAll:p,startSection:d,stat:u,isAnswerRevealed:v,currentOptionsRandomized:i,currentQuestion:t,getRandomQuestionId:f,revealAnswer:z,selectAnswer:w,updateCounters:k,selectedAnswer:h,setQuestion:S,hasQuestion:T}=Ce(),O=V("id",""),N=V("sectionId",""),y=b(),W=()=>{if(O.value!=="")if(y.value=void 0,T(O.value))S(O.value);else{const s=f();if(!s){l.replace({name:Y.Home});return}l.replace({params:{id:s}})}},P=b(!1);U(()=>[O.value,N.value],async(s,r)=>{r||(r=["",""]),!(!s[0]&&!s[1])&&(s[0]===r[0]&&s[1]===r[1]||((s[1]!==r[1]||!r[1])&&(s[1]?(P.value=!1,await d(s[1])):P.value||(P.value=!0,await p())),W()))},{immediate:!0});let a;const Q=b(!1);let B;const se=()=>{y.value=void 0,window.clearTimeout(a),B=void 0,window.clearTimeout(B),Q.value=!0,B=window.setTimeout(async()=>{B=void 0,await l.replace({params:{id:f()}}),await fe(h).toBeUndefined(),await te(),Q.value=!1},parseInt(e.pageFadeOutDuration,10))},E=()=>{var s,r;if(!B&&!(((s=t.value)==null?void 0:s.type)==="choice"&&!h.value)){if(((r=t.value)==null?void 0:r.type)==="text"&&!v.value){z();return}se()}},ne=s=>{const r=[];return s.id===-1&&r.push(e.dontKnowOption),h.value?h.value.isAnswer?s===h.value?e.correct:(r.push(e["wrong-fade"]),r):s===y.value?(r.push(e["correct-blinking"]),r):s.isAnswer?(r.push(e.correct),r):(r.push(e.wrong),r):r},ae=s=>{if(h.value){E();return}if(w(s),k(),!s.isAnswer){const r=i.value.find(x=>x.isAnswer);y.value=r}a=window.setTimeout(()=>{y.value=void 0},1e3)},R=b("es"),oe=s=>{ie(s)||E()},j=()=>{var s;(s=window.getSelection())!=null&&s.isCollapsed&&(R.value==="es"?R.value=c.value:R.value="es")},L=s=>m.t(R.value,s),re=()=>{l.push({name:Y.Settings})};function ie(s){const r=s.target;return r.tagName==="BUTTON"||r.tagName==="A"}return(s,r)=>(C(),we(he,{onClick:oe,class:g({[n(e).fadeOut]:Q.value})},{topBar:F(()=>[_("div",{class:g(n(e).navigation)},[_("div",{onClick:M(j,["stop"]),class:g(n(e).languageButton)},[$(Z,{type:"mdi",path:n(be)},null,8,["path"]),_("span",{class:g(n(e).languageLabel)},A(R.value.toUpperCase()),3)],2),_("div",{onClick:M(re,["stop"])},[$(Z,{type:"mdi",path:n(xe)},null,8,["path"])])],2)]),default:F(()=>[_("div",{class:g(n(e).progress)},[_("div",{class:g(n(e).correctAnswers)},A(n(u).correctQuestions),3),_("div",{class:g(n(e).wrongAnswers)},A(n(u).wrongQuestions),3),_("div",{class:g(n(e).allAnswers)},A(n(u).totalQuestions),3)],2),n(t)?(C(),q("div",{key:0,class:g(n(e).question)},[_("div",{class:g(n(e).text),onClick:M(j,["stop"])},[_("div",null,[_("div",{class:g(n(e).sectionTitle)},A(L(n(t).section.title)),3),_("div",null,A(L(n(t).question)),1)])],2),_("div",{class:g(n(e).answers)},[n(t).type==="choice"?(C(!0),q(J,{key:0},X(n(i),x=>(C(),q("div",{key:`${n(t).id}-${x.id}`,class:g(n(e).option)},[$(ke,{onClick:M(K=>ae(x),["stop"]),disabled:!!n(h),class:g([n(e).button,ne(x)])},{default:F(()=>[_e(A(L(x.value)),1)]),_:2},1032,["onClick","disabled","class"])],2))),128)):D("",!0),n(t).type==="text"?(C(),q("div",{key:1,class:g([n(e).answer,n(v)?"":n(e).hiddenAnswer]),onClick:M(E,["stop"])},[(C(!0),q(J,null,X(L(n(t).answer).split(`
`),(x,K)=>(C(),q("p",{key:K},A(x),1))),128))],2)):D("",!0)],2)],2)):D("",!0)]),_:1},8,["class"]))}}),Se="200ms",Te="_counter_xpabe_4",Be="_question_xpabe_8",Re="_text_xpabe_15",Ie="_answers_xpabe_46",Me="_option_xpabe_56",Pe="_fadeOut_xpabe_60",Le="_button_xpabe_66",Ne="_correct_xpabe_66",Ee="_success_xpabe_1",Fe="_wrong_xpabe_73",$e="_next_xpabe_80",De="_answer_xpabe_46",Ge="_hiddenAnswer_xpabe_93",Ue="_navigation_xpabe_96",We="_back_xpabe_103",je="_forward_xpabe_107",Ke="_disabled_xpabe_116",He="_progress_xpabe_120",Je="_correctAnswers_xpabe_134",Xe="_wrongAnswers_xpabe_137",Ye="_allAnswers_xpabe_140",Ze="_sectionTitle_xpabe_155",Ve="_languageButton_xpabe_159",et="_languageLabel_xpabe_174",tt={pageFadeOutDuration:Se,counter:Te,question:Be,text:Re,answers:Ie,option:Me,fadeOut:Pe,button:Le,correct:Ne,"correct-blinking":"_correct-blinking_xpabe_70",success:Ee,wrong:Fe,"wrong-fade":"_wrong-fade_xpabe_77",next:$e,answer:De,hiddenAnswer:Ge,navigation:Ue,back:We,forward:je,disabled:Ke,progress:He,correctAnswers:Je,wrongAnswers:Xe,allAnswers:Ye,sectionTitle:Ze,languageButton:Ve,languageLabel:et},st={$style:tt},it=Ae(qe,[["__cssModules",st]]);export{it as default};
