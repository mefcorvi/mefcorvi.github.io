import{u as q}from"./questions-DOA1nkGN.js";import{c as C}from"./utils-BRnDto5j.js";import{a as v,k as h,V as I,w as R}from"./vendor-mc0iK3xg.js";const B=C(()=>{const s=v(new Map),n=v(new Map),{questions:o,loadAll:c,loadSection:r,reset:i}=q(),u=h(()=>{const t=new Map;for(const g of o.values())g.type==="choice"&&t.set(g.id,g);return t}),l=v(),d=I({id:-1,value:"I don't know",isAnswer:!1}),a=()=>{let t=l.value;for(;t===l.value&&u.value.size>1;)if(t=E(u.value,s.value,n.value),!t)return t;return t},e=h(()=>{if(!l.value)return null;const t=o.get(l.value);return t||null}),w=v([]),m=()=>{var t;w.value=[...(((t=e.value)==null?void 0:t.options)??[]).sort(()=>Math.random()-.5),d]},f=v(),p=v(!1),z=t=>{l.value=t},Q=t=>o.has(t),A=t=>{if(e.value&&e.value.type==="choice"){if(!w.value.includes(t))throw new Error("Current question does not have the selected option");f.value=t}},y=()=>{f.value&&e.value&&(f.value.isAnswer?(s.value.set(e.value.id,(s.value.get(e.value.id)??0)+1),n.value.set(e.value.id,(n.value.get(e.value.id)??0)-1),(n.value.get(e.value.id)??0)<=0&&n.value.delete(e.value.id)):(n.value.set(e.value.id,(n.value.get(e.value.id)??0)+1),s.value.set(e.value.id,(s.value.get(e.value.id)??0)-1),(s.value.get(e.value.id)??0)<=0&&s.value.delete(e.value.id)))},M=()=>{e.value&&e.value.type==="text"&&(p.value=!0)};R(()=>{var t;return(t=e.value)==null?void 0:t.id},()=>{f.value=void 0,p.value=!1,m()},{immediate:!0,flush:"sync"});const S=h(()=>({correctQuestions:s.value.size,wrongQuestions:n.value.size,unansweredQuestions:u.value.size-s.value.size-n.value.size,totalQuestions:u.value.size,correctPercentage:s.value.size/u.value.size*100,wrongPercentage:n.value.size/u.value.size*100,unansweredPercentage:(u.value.size-s.value.size-n.value.size)/u.value.size*100}));return{startAll:async()=>{await c(),s.value.clear(),n.value.clear()},startSection:async t=>{i(),await r(t),s.value.clear(),n.value.clear()},stat:S,correctCount:h(()=>s.value),correctQuestions:s,wrongQuestions:n,currentOptionsRandomized:w,currentQuestion:e,isAnswerRevealed:p,selectedAnswer:f,wrongCount:h(()=>n.value.size),getRandomQuestionId:a,updateCounters:y,revealAnswer:M,selectAnswer:A,setQuestion:z,hasQuestion:Q}});function E(s,n,o){const c=[...s.keys()],r=c.map(i=>o.has(i)?5:n.has(i)?1/(n.get(i)||1)**2:10);return k(c,r)}function k(s,n){if(s.length!==n.length)throw new Error("Длины массивов values и weights должны совпадать.");const o=s.length;if(o===0)throw new Error("Массив values не должен быть пустым.");const c=n.reduce((a,e)=>a+e,0);if(c===0)throw new Error("Сумма весов не должна быть равна 0.");const r=new Array(o);for(let a=0;a<o;a++)r[a]=n[a]/c*o;const i=new Array(o),u=[],l=[];for(let a=0;a<o;a++)r[a]<1?u.push(a):l.push(a);for(;u.length>0&&l.length>0;){const a=u.pop(),e=l.pop();i[a]=e,r[e]=r[e]+r[a]-1,r[e]<1?u.push(e):l.push(e)}for(;u.length>0;)r[u.pop()]=1;for(;l.length>0;)r[l.pop()]=1;const d=Math.floor(Math.random()*o);return Math.random()<r[d]?s[d]:s[i[d]]}export{B as u};
