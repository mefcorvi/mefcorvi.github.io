import{u as O}from"./questions-B7htOsbw.js";import{u as P}from"./statistics-Bd1wb4X0.js";import{c as x}from"./utils-B0mUfX74.js";import{a as w,k as g,Z as b,w as B}from"./vendor-MUXKnC7j.js";const L=x(()=>{const u=w(new Map),s=w(new Map),{questions:l,loadSections:d}=O(),{recordCorrectAnswer:r,recordWrongAnswer:i,recordSessionStart:v,getQuestionStats:c}=P(),f=w(null),a=g(()=>{if(f.value){const t=new Map;for(const n of l.values())n.section.id===f.value&&t.set(n.id,n);return t}return l}),o=g(()=>{const t=new Map;for(const n of a.value.values())n.type==="choice"&&t.set(n.id,n);return t}),h=w(),C=b({id:-1,value:"I don't know",isAnswer:!1}),A=()=>{let t=h.value;for(;t===h.value&&o.value.size>1;)if(t=F(o.value,u.value,s.value),!t)return t;return t},e=g(()=>{if(!h.value)return null;const t=a.value.get(h.value);return t||null}),z=w([]),S=()=>{var t;z.value=[...(((t=e.value)==null?void 0:t.options)??[]).sort(()=>Math.random()-.5),C]},p=w(),Q=w(!1),y=t=>{h.value=t},q=t=>a.value.has(t),M=t=>{if(e.value&&e.value.type==="choice"){if(!z.value.includes(t))throw new Error("Current question does not have the selected option");p.value=t}},I=()=>{p.value&&e.value&&(p.value.isAnswer?(u.value.set(e.value.id,(u.value.get(e.value.id)??0)+1),s.value.set(e.value.id,(s.value.get(e.value.id)??0)-1),(s.value.get(e.value.id)??0)<=0&&s.value.delete(e.value.id),r(e.value.id)):(s.value.set(e.value.id,(s.value.get(e.value.id)??0)+1),u.value.set(e.value.id,(u.value.get(e.value.id)??0)-1),(u.value.get(e.value.id)??0)<=0&&u.value.delete(e.value.id),i(e.value.id)))},k=()=>{e.value&&e.value.type==="text"&&(Q.value=!0)},R=()=>{e.value&&(u.value.set(e.value.id,(u.value.get(e.value.id)??0)+1),s.value.set(e.value.id,(s.value.get(e.value.id)??0)-1),(s.value.get(e.value.id)??0)<=0&&s.value.delete(e.value.id),r(e.value.id))},E=()=>{e.value&&(s.value.set(e.value.id,(s.value.get(e.value.id)??0)+1),u.value.set(e.value.id,(u.value.get(e.value.id)??0)-1),(u.value.get(e.value.id)??0)<=0&&u.value.delete(e.value.id),i(e.value.id))};B(()=>{var t;return(t=e.value)==null?void 0:t.id},()=>{p.value=void 0,Q.value=!1,S()},{immediate:!0,flush:"sync"});const W=g(()=>({correctQuestions:u.value.size,wrongQuestions:s.value.size,unansweredQuestions:o.value.size-u.value.size-s.value.size,totalQuestions:o.value.size,correctPercentage:u.value.size/o.value.size*100,wrongPercentage:s.value.size/o.value.size*100,unansweredPercentage:(o.value.size-u.value.size-s.value.size)/o.value.size*100}));return{startAll:async()=>{await d(),f.value=null,u.value.clear(),s.value.clear();for(const t of l.values())if(t.type==="choice"){const n=c(t.id);n.correctCount>0&&u.value.set(t.id,n.correctCount),n.wrongCount>0&&s.value.set(t.id,n.wrongCount)}v()},startSection:async t=>{await d(),f.value=t,u.value.clear(),s.value.clear();for(const n of l.values())if(n.type==="choice"&&n.section.id===t){const m=c(n.id);m.correctCount>0&&u.value.set(n.id,m.correctCount),m.wrongCount>0&&s.value.set(n.id,m.wrongCount)}v()},stat:W,correctCount:g(()=>u.value),correctQuestions:u,wrongQuestions:s,currentOptionsRandomized:z,currentQuestion:e,isAnswerRevealed:Q,selectedAnswer:p,wrongCount:g(()=>s.value.size),getRandomQuestionId:A,updateCounters:I,revealAnswer:k,selectAnswer:M,setQuestion:y,hasQuestion:q,markQuestionCorrect:R,markQuestionWrong:E}});function F(u,s,l){const d=[...u.keys()],r=d.map(i=>l.has(i)?5:s.has(i)?1/(s.get(i)||1)**2:10);return K(d,r)}function K(u,s){if(u.length!==s.length)throw new Error("Длины массивов values и weights должны совпадать.");const l=u.length;if(l===0)throw new Error("Массив values не должен быть пустым.");const d=s.reduce((a,o)=>a+o,0);if(d===0)throw new Error("Сумма весов не должна быть равна 0.");const r=new Array(l);for(let a=0;a<l;a++)r[a]=s[a]/d*l;const i=new Array(l),v=[],c=[];for(let a=0;a<l;a++)r[a]<1?v.push(a):c.push(a);for(;v.length>0&&c.length>0;){const a=v.pop(),o=c.pop();i[a]=o,r[o]=r[o]+r[a]-1,r[o]<1?v.push(o):c.push(o)}for(;v.length>0;)r[v.pop()]=1;for(;c.length>0;)r[c.pop()]=1;const f=Math.floor(Math.random()*l);return Math.random()<r[f]?u[f]:u[i[f]]}export{L as u};
