import{p as de,l as se,q as W,s as ve,v as J,x as te,y as we,z as _e,A as m,B as fe,C as O,d as pe,h as ge,i as L,n as _,b as t,D as he,o as k,a as p,w as R,j as G,t as C,c as y,F as X,r as Y,f as P,m as me,R as Z,E as xe}from"./index-hb_2XVUP.js";import{G as Ae,m as ke,S as V,a as ye,_ as Qe}from"./GeneralPage-C23FCwqX.js";import{G as Ce}from"./GeneralButton-BuZf0SA5.js";import{u as be,a as ze}from"./questions-C6VllCXj.js";const H=new WeakMap;function ee(r,s,o={}){const{mode:h="replace",route:u=de(),router:d=se(),transform:l=A=>A}=o;H.has(d)||H.set(d,new Map);const v=H.get(d);let w=u.params[r];we(()=>{w=void 0});let e;const c=ve((A,x)=>(e=x,{get(){return A(),l(w!==void 0&&w!==""?w:J(s))},set(f){w!==f&&(w=f===s||f===null?void 0:f,v.set(r,f===s||f===null?void 0:f),x(),te(()=>{if(v.size===0)return;const g=Object.fromEntries(v.entries());v.clear();const{params:S,query:T,hash:I}=u;d[J(h)]({params:{...S,...g},query:T,hash:I})}))}}));return W(()=>u.params[r],A=>{w=A,e()},{flush:"sync"}),c}const Oe=_e(()=>{const r=m(new Map),s=m(new Map),{questions:o,loadAll:h,loadSection:u,reset:d}=be(),l=m(),v=fe({id:-1,value:"I don't know",isAnswer:!1}),w=()=>{let a=l.value;for(;a===l.value&&o.size>1;)if(a=Se(o,r.value,s.value),!a)return a;return a},e=O(()=>{if(!l.value)return null;const a=o.get(l.value);return a||null}),c=m([]),A=()=>{var a;c.value=[...(((a=e.value)==null?void 0:a.options)??[]).sort(()=>Math.random()-.5),v]},x=m(),f=m(!1),g=a=>{l.value=a},S=a=>o.has(a),T=a=>{if(e.value&&e.value.type==="choice"){if(!c.value.includes(a))throw new Error("Current question does not have the selected option");x.value=a}},I=()=>{x.value&&e.value&&(x.value.isAnswer?(r.value.set(e.value.id,(r.value.get(e.value.id)??0)+1),s.value.set(e.value.id,(s.value.get(e.value.id)??0)-1),(s.value.get(e.value.id)??0)<=0&&s.value.delete(e.value.id)):(s.value.set(e.value.id,(s.value.get(e.value.id)??0)+1),r.value.set(e.value.id,(r.value.get(e.value.id)??0)-1),(r.value.get(e.value.id)??0)<=0&&r.value.delete(e.value.id)))},b=()=>{e.value&&e.value.type==="text"&&(f.value=!0)};W(()=>{var a;return(a=e.value)==null?void 0:a.id},()=>{x.value=void 0,f.value=!1,A()},{immediate:!0,flush:"sync"});const E=O(()=>[...o.values()].filter(a=>a.type==="choice")),Q=O(()=>({correctQuestions:r.value.size,wrongQuestions:s.value.size,unansweredQuestions:o.size-r.value.size-s.value.size,totalQuestions:E.value.length,correctPercentage:r.value.size/o.size*100,wrongPercentage:s.value.size/o.size*100,unansweredPercentage:(o.size-r.value.size-s.value.size)/o.size*100}));return{startAll:async()=>{await h(),r.value.clear(),s.value.clear()},startSection:async a=>{d(),await u(a),r.value.clear(),s.value.clear()},stat:Q,correctCount:O(()=>r.value),correctQuestions:r,wrongQuestions:s,currentOptionsRandomized:c,currentQuestion:e,isAnswerRevealed:f,selectedAnswer:x,wrongCount:O(()=>s.value.size),getRandomQuestionId:w,updateCounters:I,revealAnswer:b,selectAnswer:T,setQuestion:g,hasQuestion:S}});function Se(r,s,o){const h=[...r.keys()],u=h.map(d=>o.has(d)?(o.get(d)??0)*3:s.has(d)?1/(s.get(d)||1):1);return Te(h,u)}function Te(r,s){if(r.length!==s.length)throw new Error("Длины массивов values и weights должны совпадать.");const o=r.length;if(o===0)throw new Error("Массив values не должен быть пустым.");const h=s.reduce((e,c)=>e+c,0);if(h===0)throw new Error("Сумма весов не должна быть равна 0.");const u=new Array(o);for(let e=0;e<o;e++)u[e]=s[e]/h*o;const d=new Array(o),l=[],v=[];for(let e=0;e<o;e++)u[e]<1?l.push(e):v.push(e);for(;l.length>0&&v.length>0;){const e=l.pop(),c=v.pop();d[e]=c,u[c]=u[c]+u[e]-1,u[c]<1?l.push(c):v.push(c)}for(;l.length>0;)u[l.pop()]=1;for(;v.length>0;)u[v.pop()]=1;const w=Math.floor(Math.random()*o);return Math.random()<u[w]?r[w]:r[d[w]]}const Ie=["src"],qe=["innerHTML"],Me=pe({__name:"QuestionPage",setup(r){const s=he(),o=se(),h=ze(),{startAll:u,startSection:d,stat:l,isAnswerRevealed:v,currentOptionsRandomized:w,currentQuestion:e,getRandomQuestionId:c,revealAnswer:A,selectAnswer:x,updateCounters:f,selectedAnswer:g,setQuestion:S,hasQuestion:T}=Oe(),I=O(()=>{var n;return((n=e.value)==null?void 0:n.note)!==void 0}),b=ee("id",""),E=ee("sectionId",""),Q=m(),F=m(!1),j=()=>{if(b.value!=="")if(Q.value=void 0,F.value=!1,T(b.value))S(b.value);else{const n=c();if(!n){o.replace({name:Z.Home});return}o.replace({params:{id:n}})}},a=m(!1);W(()=>[b.value,E.value],async(n,i)=>{i||(i=["",""]),!(!n[0]&&!n[1])&&(n[0]===i[0]&&n[1]===i[1]||((n[1]!==i[1]||!i[1])&&(n[1]?(a.value=!1,await d(n[1])):a.value||(a.value=!0,await u())),j()))},{immediate:!0});let K;const B=m(!1);let q;const ne=()=>{Q.value=void 0,window.clearTimeout(K),q=void 0,window.clearTimeout(q),B.value=!0,q=window.setTimeout(async()=>{q=void 0,await o.replace({params:{id:c()}}),await xe(g).toBeUndefined(),await te(),B.value=!1},parseInt(s.pageFadeOutDuration,10))},D=()=>{var n,i;if(!q&&!(((n=e.value)==null?void 0:n.type)==="choice"&&!g.value)){if(((i=e.value)==null?void 0:i.type)==="text"&&!v.value){A();return}ne()}},ae=n=>{const i=[];return n.id===-1&&i.push(s.dontKnowOption),g.value?g.value.isAnswer?n===g.value?s.correct:(i.push(s["wrong-fade"]),i):n===Q.value?(i.push(s["correct-blinking"]),i):n.isAnswer?(i.push(s.correct),i):(i.push(s.wrong),i):i},oe=n=>{if(g.value){D();return}if(x(n),f(),!n.isAnswer){const i=w.value.find($=>$.isAnswer);Q.value=i}K=window.setTimeout(()=>{Q.value=void 0},1e3)},N=m("es"),re=n=>{ce(n)||D()},ie=()=>{var n;(n=window.getSelection())!=null&&n.isCollapsed&&(N.value==="es"?N.value="ru":N.value="es")},M=n=>h.t(N.value,n),ue=()=>{F.value=!0},le=()=>{o.push({name:Z.Settings})};function ce(n){const i=n.target;return i.tagName==="BUTTON"||i.tagName==="A"}return(n,i)=>(k(),ge(Ae,{onClick:re,class:_({[t(s).fadeOut]:B.value})},{topBar:L(()=>[p("div",{class:_(t(s).navigation)},[p("div",{class:_([{[t(s).disabled]:!I.value}]),onClick:R(ue,["stop"])},[G(V,{type:"mdi",path:t(ke)},null,8,["path"])],2),p("div",{onClick:R(le,["stop"])},[G(V,{type:"mdi",path:t(ye)},null,8,["path"])])],2)]),default:L(()=>{var $;return[p("div",{class:_(t(s).progress)},[p("div",{class:_(t(s).correctAnswers)},C(t(l).correctQuestions),3),p("div",{class:_(t(s).wrongAnswers)},C(t(l).wrongQuestions),3),p("div",{class:_(t(s).allAnswers)},C(t(l).totalQuestions),3)],2),t(e)?(k(),y("div",{key:0,class:_(t(s).question)},[p("div",{class:_(t(s).text),onClick:R(ie,["stop"])},[p("div",null,[p("div",{class:_(t(s).sectionTitle)},C(M(t(e).section.title)),3),p("div",null,C(M(t(e).question)),1)])],2),p("div",{class:_(t(s).answers)},[t(e).type==="choice"?(k(!0),y(X,{key:0},Y(t(w),z=>(k(),y("div",{key:`${t(e).id}-${z.id}`,class:_(t(s).option)},[G(Ce,{onClick:R(U=>oe(z),["stop"]),disabled:!!t(g),class:_([t(s).button,ae(z)])},{default:L(()=>[me(C(M(z.value)),1)]),_:2},1032,["onClick","disabled","class"])],2))),128)):P("",!0),t(e).type==="text"?(k(),y("div",{key:1,class:_([t(s).answer,t(v)?"":t(s).hiddenAnswer]),onClick:R(D,["stop"])},[(k(!0),y(X,null,Y(M(t(e).answer).split(`
`),(z,U)=>(k(),y("p",{key:U},C(z),1))),128))],2)):P("",!0)],2),($=t(e))!=null&&$.note?(k(),y("div",{key:t(e).id,class:_(["scroll",[t(s).note,{[t(s).hidden]:!t(g)||B.value}]])},[t(e).noteImage?(k(),y("img",{key:0,src:`/notes/${t(e).noteImage}`},null,8,Ie)):P("",!0),p("div",{innerHTML:M(t(e).note)},null,8,qe)],2)):P("",!0)],2)):P("",!0)]}),_:1},8,["class"]))}}),Re="200ms",Pe="_counter_17esx_4",Be="_question_17esx_8",Ne="_text_17esx_15",$e="_answers_17esx_46",Ee="_option_17esx_56",Fe="_fadeOut_17esx_60",De="_button_17esx_66",Le="_correct_17esx_66",Ge="_success_17esx_1",He="_wrong_17esx_73",We="_next_17esx_80",je="_answer_17esx_46",Ke="_hiddenAnswer_17esx_93",Ue="_navigation_17esx_96",Je="_back_17esx_103",Xe="_forward_17esx_107",Ye="_disabled_17esx_116",Ze="_progress_17esx_120",Ve="_correctAnswers_17esx_134",es="_wrongAnswers_17esx_137",ss="_allAnswers_17esx_140",ts="_note_17esx_155",ns="_hidden_17esx_93",as="_sectionTitle_17esx_203",os={pageFadeOutDuration:Re,counter:Pe,question:Be,text:Ne,answers:$e,option:Ee,fadeOut:Fe,button:De,correct:Le,"correct-blinking":"_correct-blinking_17esx_70",success:Ge,wrong:He,"wrong-fade":"_wrong-fade_17esx_77",next:We,answer:je,hiddenAnswer:Ke,navigation:Ue,back:Je,forward:Xe,disabled:Ye,progress:Ze,correctAnswers:Ve,wrongAnswers:es,allAnswers:ss,note:ts,hidden:ns,sectionTitle:as},rs={$style:os},ds=Qe(Me,[["__cssModules",rs]]);export{ds as default};
