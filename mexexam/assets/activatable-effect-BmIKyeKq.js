import{u as k}from"./questions-BAwy1kDB.js";import{c as R,t as D}from"./utils-DENQyvkc.js";import{a as c,k as f,V as O,w as m,Q as P,W,o as b,r as I,d as x,e as B}from"./vendor-DgBf67BD.js";const U=R(()=>{const a=c(new Map),e=c(new Map),{questions:i,loadSections:s}=k(),n=c(null),v=f(()=>{if(n.value){const u=new Map;for(const d of i.values())d.section.id===n.value&&u.set(d.id,d);return u}return i}),o=f(()=>{const u=new Map;for(const d of v.value.values())d.type==="choice"&&u.set(d.id,d);return u}),r=c(),p=O({id:-1,value:"I don't know",isAnswer:!1}),l=()=>{let u=r.value;for(;u===r.value&&o.value.size>1;)if(u=F(o.value,a.value,e.value),!u)return u;return u},t=f(()=>{if(!r.value)return null;const u=v.value.get(r.value);return u||null}),w=c([]),z=()=>{var u;w.value=[...(((u=t.value)==null?void 0:u.options)??[]).sort(()=>Math.random()-.5),p]},h=c(),g=c(!1),Q=u=>{r.value=u},A=u=>v.value.has(u),y=u=>{if(t.value&&t.value.type==="choice"){if(!w.value.includes(u))throw new Error("Current question does not have the selected option");h.value=u}},M=()=>{h.value&&t.value&&(h.value.isAnswer?(a.value.set(t.value.id,(a.value.get(t.value.id)??0)+1),e.value.set(t.value.id,(e.value.get(t.value.id)??0)-1),(e.value.get(t.value.id)??0)<=0&&e.value.delete(t.value.id)):(e.value.set(t.value.id,(e.value.get(t.value.id)??0)+1),a.value.set(t.value.id,(a.value.get(t.value.id)??0)-1),(a.value.get(t.value.id)??0)<=0&&a.value.delete(t.value.id)))},S=()=>{t.value&&t.value.type==="text"&&(g.value=!0)},C=()=>{t.value&&(a.value.set(t.value.id,(a.value.get(t.value.id)??0)+1),e.value.set(t.value.id,(e.value.get(t.value.id)??0)-1),(e.value.get(t.value.id)??0)<=0&&e.value.delete(t.value.id))},q=()=>{t.value&&(e.value.set(t.value.id,(e.value.get(t.value.id)??0)+1),a.value.set(t.value.id,(a.value.get(t.value.id)??0)-1),(a.value.get(t.value.id)??0)<=0&&a.value.delete(t.value.id))};m(()=>{var u;return(u=t.value)==null?void 0:u.id},()=>{h.value=void 0,g.value=!1,z()},{immediate:!0,flush:"sync"});const E=f(()=>({correctQuestions:a.value.size,wrongQuestions:e.value.size,unansweredQuestions:o.value.size-a.value.size-e.value.size,totalQuestions:o.value.size,correctPercentage:a.value.size/o.value.size*100,wrongPercentage:e.value.size/o.value.size*100,unansweredPercentage:(o.value.size-a.value.size-e.value.size)/o.value.size*100}));return{startAll:async()=>{await s(),n.value=null,a.value.clear(),e.value.clear()},startSection:async u=>{await s(),n.value=u,a.value.clear(),e.value.clear()},stat:E,correctCount:f(()=>a.value),correctQuestions:a,wrongQuestions:e,currentOptionsRandomized:w,currentQuestion:t,isAnswerRevealed:g,selectedAnswer:h,wrongCount:f(()=>e.value.size),getRandomQuestionId:l,updateCounters:M,revealAnswer:S,selectAnswer:y,setQuestion:Q,hasQuestion:A,markQuestionCorrect:C,markQuestionWrong:q}});function F(a,e,i){const s=[...a.keys()],n=s.map(v=>i.has(v)?5:e.has(v)?1/(e.get(v)||1)**2:10);return K(s,n)}function K(a,e){if(a.length!==e.length)throw new Error("Длины массивов values и weights должны совпадать.");const i=a.length;if(i===0)throw new Error("Массив values не должен быть пустым.");const s=e.reduce((l,t)=>l+t,0);if(s===0)throw new Error("Сумма весов не должна быть равна 0.");const n=new Array(i);for(let l=0;l<i;l++)n[l]=e[l]/s*i;const v=new Array(i),o=[],r=[];for(let l=0;l<i;l++)n[l]<1?o.push(l):r.push(l);for(;o.length>0&&r.length>0;){const l=o.pop(),t=r.pop();v[l]=t,n[t]=n[t]+n[l]-1,n[t]<1?o.push(t):r.push(t)}for(;o.length>0;)n[o.pop()]=1;for(;r.length>0;)n[r.pop()]=1;const p=Math.floor(Math.random()*i);return Math.random()<n[p]?a[p]:a[v[p]]}const V=()=>{const a=c(!1),e=x();return e!=null&&e.root.isMounted||(a.value=!0),e!=null&&e.isMounted&&(a.value=!0),P(()=>{a.value=!0}),W(()=>{a.value=!1}),b(()=>{a.value=!j(e)}),I(a)};function j(a){if(!a)return!1;let e=a.parent;for(;e;){if(e.isDeactivated)return!0;e=e.parent}return!1}function G(a,e,i){let s;D(()=>{s&&(s.stop(),s=void 0)}),m(a,n=>{if(!n){s&&(s.stop(),s=void 0);return}s||(s=B(),s.run(e))},i)}function X(a,e){G(V(),a,e)}export{X as a,U as u};
