import{p as le,q as te,h as W,B as ce,C as J,D as se,E as de,v as ve,x as A,m as S,G as fe,d as ge,i as we,j as D,n as w,b as t,H as _e,o as Q,a as p,w as R,k as X,t as y,c as z,f as P,F as Y,r as Z,s as pe,R as V,I as me}from"./index-D54GVbqE.js";import{u as he,G as Ae,m as ke,S as Qe,_ as ye}from"./localization-CRv5ILsv.js";import{G as Ce}from"./GeneralButton-uVm0t9aT.js";import{u as be,a as ze}from"./questions-CWkUJBjO.js";const G=new WeakMap;function ee(o,e,l={}){const{mode:m="replace",route:i=le(),router:g=te(),transform:c=v=>v}=l;G.has(g)||G.set(g,new Map);const d=G.get(g);let f=i.params[o];de(()=>{f=void 0});let u;const s=ce((v,C)=>(u=C,{get(){return v(),c(f!==void 0&&f!==""?f:J(e))},set(_){f!==_&&(f=_===e||_===null?void 0:_,d.set(o,_===e||_===null?void 0:_),C(),se(()=>{if(d.size===0)return;const b=Object.fromEntries(d.entries());d.clear();const{params:q,query:h,hash:T}=i;g[J(m)]({params:{...q,...b},query:h,hash:T})}))}}));return W(()=>i.params[o],v=>{f=v,u()},{flush:"sync"}),s}const xe=ve(()=>{const o=A(new Map),e=A(new Map),{questions:l,loadAll:m,loadSection:i,reset:g}=be(),c=S(()=>{const a=new Map;for(const O of l.values())O.type==="choice"&&a.set(O.id,O);return a}),d=A(),f=fe({id:-1,value:"I don't know",isAnswer:!1}),u=()=>{let a=d.value;for(;a===d.value&&c.value.size>1;)if(a=Be(c.value,o.value,e.value),!a)return a;return a},s=S(()=>{if(!d.value)return null;const a=l.get(d.value);return a||null}),v=A([]),C=()=>{var a;v.value=[...(((a=s.value)==null?void 0:a.options)??[]).sort(()=>Math.random()-.5),f]},_=A(),b=A(!1),q=a=>{d.value=a},h=a=>l.has(a),T=a=>{if(s.value&&s.value.type==="choice"){if(!v.value.includes(a))throw new Error("Current question does not have the selected option");_.value=a}},L=()=>{_.value&&s.value&&(_.value.isAnswer?(o.value.set(s.value.id,(o.value.get(s.value.id)??0)+1),e.value.set(s.value.id,(e.value.get(s.value.id)??0)-1),(e.value.get(s.value.id)??0)<=0&&e.value.delete(s.value.id)):(e.value.set(s.value.id,(e.value.get(s.value.id)??0)+1),o.value.set(s.value.id,(o.value.get(s.value.id)??0)-1),(o.value.get(s.value.id)??0)<=0&&o.value.delete(s.value.id)))},x=()=>{s.value&&s.value.type==="text"&&(b.value=!0)};W(()=>{var a;return(a=s.value)==null?void 0:a.id},()=>{_.value=void 0,b.value=!1,C()},{immediate:!0,flush:"sync"});const N=S(()=>({correctQuestions:o.value.size,wrongQuestions:e.value.size,unansweredQuestions:c.value.size-o.value.size-e.value.size,totalQuestions:c.value.size,correctPercentage:o.value.size/c.value.size*100,wrongPercentage:e.value.size/c.value.size*100,unansweredPercentage:(c.value.size-o.value.size-e.value.size)/c.value.size*100}));return{startAll:async()=>{await m(),o.value.clear(),e.value.clear()},startSection:async a=>{g(),await i(a),o.value.clear(),e.value.clear()},stat:N,correctCount:S(()=>o.value),correctQuestions:o,wrongQuestions:e,currentOptionsRandomized:v,currentQuestion:s,isAnswerRevealed:b,selectedAnswer:_,wrongCount:S(()=>e.value.size),getRandomQuestionId:u,updateCounters:L,revealAnswer:x,selectAnswer:T,setQuestion:q,hasQuestion:h}});function Be(o,e,l){const m=[...o.keys()],i=m.map(g=>l.has(g)?5:e.has(g)?1/(e.get(g)||1)**2:10);return Oe(m,i)}function Oe(o,e){if(o.length!==e.length)throw new Error("Длины массивов values и weights должны совпадать.");const l=o.length;if(l===0)throw new Error("Массив values не должен быть пустым.");const m=e.reduce((u,s)=>u+s,0);if(m===0)throw new Error("Сумма весов не должна быть равна 0.");const i=new Array(l);for(let u=0;u<l;u++)i[u]=e[u]/m*l;const g=new Array(l),c=[],d=[];for(let u=0;u<l;u++)i[u]<1?c.push(u):d.push(u);for(;c.length>0&&d.length>0;){const u=c.pop(),s=d.pop();g[u]=s,i[s]=i[s]+i[u]-1,i[s]<1?c.push(s):d.push(s)}for(;c.length>0;)i[c.pop()]=1;for(;d.length>0;)i[d.pop()]=1;const f=Math.floor(Math.random()*l);return Math.random()<i[f]?o[f]:o[g[f]]}const Se=ge({__name:"QuestionPage",setup(o){const e=_e(),l=te(),m=ze(),{locale:i,getLanguageName:g}=he(),{startAll:c,startSection:d,stat:f,isAnswerRevealed:u,currentOptionsRandomized:s,currentQuestion:v,getRandomQuestionId:C,revealAnswer:_,selectAnswer:b,updateCounters:q,selectedAnswer:h,setQuestion:T,hasQuestion:L}=xe(),x=ee("id",""),N=ee("sectionId",""),B=A(),j=()=>{if(x.value!=="")if(B.value=void 0,L(x.value))T(x.value);else{const n=C();if(!n){l.replace({name:V.Home});return}l.replace({params:{id:n}})}},a=A(!1);W(()=>[x.value,N.value],async(n,r)=>{r||(r=["",""]),!(!n[0]&&!n[1])&&(n[0]===r[0]&&n[1]===r[1]||((n[1]!==r[1]||!r[1])&&(n[1]?(a.value=!1,await d(n[1])):a.value||(a.value=!0,await c())),j()))},{immediate:!0});let O;const E=A(!1);let I;const ne=()=>{B.value=void 0,window.clearTimeout(O),I=void 0,window.clearTimeout(I),E.value=!0,I=window.setTimeout(async()=>{I=void 0,await l.replace({params:{id:C()}}),await me(h).toBeUndefined(),await se(),E.value=!1},parseInt(e.pageFadeOutDuration,10))},F=()=>{var n,r;if(!I&&!(((n=v.value)==null?void 0:n.type)==="choice"&&!h.value)){if(((r=v.value)==null?void 0:r.type)==="text"&&!u.value){_();return}ne()}},ae=n=>{const r=[];return n.id===-1&&r.push(e.dontKnowOption),h.value?h.value.isAnswer?n===h.value?e.correct:(r.push(e["wrong-fade"]),r):n===B.value?(r.push(e["correct-blinking"]),r):n.isAnswer?(r.push(e.correct),r):(r.push(e.wrong),r):r},oe=n=>{if(h.value){F();return}if(b(n),q(),!n.isAnswer){const r=s.value.find(k=>k.isAnswer);B.value=r}O=window.setTimeout(()=>{B.value=void 0},1e3)},$=A(!1),H=S(()=>$.value?"es":i.value),re=n=>{ie(n)||F()},K=()=>{var n;(n=window.getSelection())!=null&&n.isCollapsed&&($.value=!$.value)},M=n=>m.t(H.value,n),ue=()=>{l.push({name:V.Settings})};function ie(n){const r=n.target;return r.tagName==="BUTTON"||r.tagName==="A"}return(n,r)=>(Q(),we(Ae,{onClick:re,class:w({[t(e).fadeOut]:E.value})},{topBar:D(()=>[p("div",{class:w(t(e).navigation)},[p("div",{onClick:R(ue,["stop"])},[X(Qe,{type:"mdi",path:t(ke)},null,8,["path"])])],2)]),default:D(()=>[p("div",{class:w(t(e).progress)},[p("div",{class:w(t(e).correctAnswers)},y(t(f).correctQuestions),3),p("div",{class:w(t(e).wrongAnswers)},y(t(f).wrongQuestions),3),p("div",{class:w(t(e).allAnswers)},y(t(f).totalQuestions),3)],2),t(v)?(Q(),z("div",{key:0,class:w(t(e).question)},[p("div",{class:w(t(e).text),onClick:R(K,["stop"])},[p("div",null,[p("div",{class:w(t(e).sectionTitle)},y(M(t(v).section.title)),3),p("div",null,y(M(t(v).question)),1)])],2),p("div",{class:w(t(e).languageButtonContainer)},[t(i)!=="es"?(Q(),z("div",{key:0,onClick:R(K,["stop"]),class:w(t(e).languageButton)},[p("span",{class:w(t(e).languageLabel)},"→ "+y(H.value===t(i)?t(g)("es"):t(g)(t(i))),3)],2)):P("",!0)],2),p("div",{class:w(t(e).answers)},[t(v).type==="choice"?(Q(!0),z(Y,{key:0},Z(t(s),k=>(Q(),z("div",{key:`${t(v).id}-${k.id}`,class:w(t(e).option)},[X(Ce,{onClick:R(U=>oe(k),["stop"]),disabled:!!t(h),class:w([t(e).button,ae(k)])},{default:D(()=>[pe(y(M(k.value)),1)]),_:2},1032,["onClick","disabled","class"])],2))),128)):P("",!0),t(v).type==="text"?(Q(),z("div",{key:1,class:w([t(e).answer,t(u)?"":t(e).hiddenAnswer]),onClick:R(F,["stop"])},[(Q(!0),z(Y,null,Z(M(t(v).answer).split(`
`),(k,U)=>(Q(),z("p",{key:U},y(k),1))),128))],2)):P("",!0)],2)],2)):P("",!0)]),_:1},8,["class"]))}}),qe="100ms",Te="_counter_f49n1_4",Ie="_question_f49n1_8",Re="_text_f49n1_15",Me="_languageButtonContainer_f49n1_46",Pe="_answers_f49n1_53",Le="_option_f49n1_63",Ne="_fadeOut_f49n1_67",Ee="_button_f49n1_73",Fe="_correct_f49n1_73",$e="_success_f49n1_1",De="_wrong_f49n1_80",Ge="_next_f49n1_87",We="_answer_f49n1_53",je="_hiddenAnswer_f49n1_100",He="_navigation_f49n1_103",Ke="_back_f49n1_110",Ue="_forward_f49n1_114",Je="_disabled_f49n1_123",Xe="_progress_f49n1_127",Ye="_correctAnswers_f49n1_141",Ze="_wrongAnswers_f49n1_145",Ve="_allAnswers_f49n1_149",et="_sectionTitle_f49n1_164",tt="_languageButton_f49n1_46",st="_languageLabel_f49n1_189",nt={pageFadeOutDuration:qe,counter:Te,question:Ie,text:Re,languageButtonContainer:Me,answers:Pe,option:Le,fadeOut:Ne,button:Ee,correct:Fe,"correct-blinking":"_correct-blinking_f49n1_77",success:$e,wrong:De,"wrong-fade":"_wrong-fade_f49n1_84",next:Ge,answer:We,hiddenAnswer:je,navigation:He,back:Ke,forward:Ue,disabled:Je,progress:Xe,correctAnswers:Ye,wrongAnswers:Ze,allAnswers:Ve,sectionTitle:et,languageButton:tt,languageLabel:st},at={$style:nt},lt=ye(Se,[["__cssModules",at]]);export{lt as default};
