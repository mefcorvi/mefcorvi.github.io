import{p as _e,l as se,q as H,s as we,v as U,x as ne,y as fe,z as pe,A as ge,B as m,C as me,D as L,d as he,h as ke,i as D,n as d,b as t,E as be,R as W,o as g,a as f,w as O,j as $,e as J,c as k,t as E,F as X,r as Y,f as M,m as ye,G as Ae}from"./index-C8Ap_B6C.js";import{G as Ce,m as je,S as Z,a as Qe,_ as ze}from"./GeneralPage-Dg0V3b8_.js";import{G as Se}from"./GeneralButton-bARr3CM-.js";import{u as xe,a as Oe,_ as Me}from"./questions-Bc4yI46-.js";const G=new WeakMap;function ee(l,e,i={}){const{mode:b="replace",route:c=_e(),router:o=se(),transform:_=v=>v}=i;G.has(o)||G.set(o,new Map);const h=G.get(o);let a=c.params[l];fe(()=>{a=void 0});let r;const S=we((v,y)=>(r=y,{get(){return v(),_(a!==void 0&&a!==""?a:U(e))},set(w){a!==w&&(a=w===e||w===null?void 0:w,h.set(l,w===e||w===null?void 0:w),y(),ne(()=>{if(h.size===0)return;const p=Object.fromEntries(h.entries());h.clear();const{params:C,query:j,hash:q}=c;o[U(b)]({params:{...C,...p},query:j,hash:q})}))}}));return H(()=>c.params[l],v=>{a=v,r()},{flush:"sync"}),S}function te(l){return pe(l,()=>new Set,void 0,{serializer:{read(e){return e?new Set(e.split(",")):new Set},write(e){return[...e].join(",")}}})}const qe=ge(()=>{const l=te("correct-questions-2"),e=te("wrong-questions-2"),{questions:i,loadAll:b,loadSection:c}=xe(),o=m(),_=me({id:-1,value:"I don't know",isAnswer:!1}),h=()=>{let n=o.value;for(;n===o.value;)if(n=Ie(i,l.value,e.value),!n)return n;return n},a=L(()=>{if(!o.value)return null;const n=i.get(o.value);if(!n)throw new Error(`Failed to get question by id ${o.value}`);return n}),r=m([]),S=()=>{var n;r.value=[...(((n=a.value)==null?void 0:n.options)??[]).sort(()=>Math.random()-.5),_]},v=m(),y=m(!1),w=n=>{o.value=n},p=n=>i.has(n),C=m(0),j=m(0),q=()=>{C.value=0,j.value=0},x=n=>{if(a.value&&a.value.type==="choice"){if(!r.value.includes(n))throw new Error("Current question does not have the selected option");v.value=n}},P=()=>{v.value&&a.value&&(v.value.isAnswer?(C.value++,l.value.add(a.value.id),e.value.delete(a.value.id)):(j.value++,e.value.add(a.value.id),l.value.delete(a.value.id)))},Q=()=>{a.value&&a.value.type==="text"&&(y.value=!0)};H(()=>{var n;return(n=a.value)==null?void 0:n.id},()=>{v.value=void 0,y.value=!1,S()},{immediate:!0,flush:"sync"});const z=L(()=>({correctQuestions:l.value.size,wrongQuestions:e.value.size,unansweredQuestions:i.size-l.value.size-e.value.size,totalQuestions:i.size,correctPercentage:l.value.size/i.size*100,wrongPercentage:e.value.size/i.size*100,unansweredPercentage:(i.size-l.value.size-e.value.size)/i.size*100}));return{startAll:async()=>{await b()},startSection:async n=>{await c(n)},stat:z,correctCount:C,correctQuestions:l,wrongQuestions:e,currentOptionsRandomized:r,currentQuestion:a,isAnswerRevealed:y,selectedAnswer:v,wrongCount:j,getRandomQuestionId:h,resetCount:q,updateCounters:P,revealAnswer:Q,selectAnswer:x,setQuestion:w,hasQuestion:p}});function Ie(l,e,i){if(Math.random()<i.size/10){const c=[...i];let o="";for(;c.length>0;){const _=Math.floor(Math.random()*c.length);if(o=c[_],l.has(o))return o;c.splice(_,1),i.delete(o)}}if(Math.random()<.2){const c=[...e];let o="";for(;c.length>0;){const _=Math.floor(Math.random()*c.length);if(o=c[_],l.has(o))return o;c.splice(_,1),e.delete(o)}}const b=[...l.keys()];return b[Math.floor(Math.random()*b.length)]}const Pe=["src"],Re=["innerHTML"],Ne=he({__name:"QuestionPage",setup(l){const e=be(),i=se(),b=Oe(),{startAll:c,startSection:o,stat:_,isAnswerRevealed:h,currentOptionsRandomized:a,currentQuestion:r,getRandomQuestionId:S,revealAnswer:v,selectAnswer:y,updateCounters:w,selectedAnswer:p,setQuestion:C,hasQuestion:j}=qe(),q=L(()=>{var s;return((s=r.value)==null?void 0:s.note)!==void 0}),x=ee("id",""),P=ee("sectionId",""),Q=m(),z=m(!1),R=()=>{if(x.value!=="")if(Q.value=void 0,z.value=!1,j(x.value))C(x.value);else{const s=S();if(!s){i.replace({name:W.Home});return}i.replace({params:{id:s}})}};H(x,R),P.value?o(P.value).then(R):c().then(R);let B;const n=m(!1);let I;const oe=()=>{Q.value=void 0,window.clearTimeout(B),I=void 0,window.clearTimeout(I),n.value=!0,I=window.setTimeout(async()=>{I=void 0,await i.replace({params:{id:S()}}),await Ae(p).toBeUndefined(),await ne(),n.value=!1},parseInt(e.pageFadeOutDuration,10))},F=()=>{var s,u;if(!I&&!(((s=r.value)==null?void 0:s.type)==="choice"&&!p.value)){if(((u=r.value)==null?void 0:u.type)==="text"&&!h.value){v();return}oe()}},ae=s=>{const u=[];return s.id===-1&&u.push(e.dontKnowOption),p.value?p.value.isAnswer?s===p.value?e.correct:(u.push(e["wrong-fade"]),u):s===Q.value?(u.push(e["correct-blinking"]),u):s.isAnswer?(u.push(e.correct),u):(u.push(e.wrong),u):u},re=s=>{if(p.value){F();return}if(y(s),w(),!s.isAnswer){const u=a.value.find(A=>A.isAnswer);Q.value=u}B=window.setTimeout(()=>{Q.value=void 0},1e3)},N=m("es"),ie=s=>{V(s)||F()},le=()=>{var s;(s=window.getSelection())!=null&&s.isCollapsed&&(N.value==="es"?N.value="ru":N.value="es")},T=s=>b.t(N.value,s),ue=s=>{V(s)||(s.stopPropagation(),ce())},ce=()=>{z.value=!1},de=()=>{z.value=!0},ve=()=>{i.push({name:W.Settings})};function V(s){const u=s.target;return u.tagName==="BUTTON"||u.tagName==="A"}return(s,u)=>(g(),ke(Ce,{onClick:ie,class:d({[t(e).fadeOut]:n.value})},{topBar:D(()=>[f("div",{class:d(t(e).navigation)},[f("div",{class:d([{[t(e).disabled]:!q.value}]),onClick:O(de,["stop"])},[$(Z,{type:"mdi",path:t(je)},null,8,["path"])],2),f("div",{onClick:O(ve,["stop"])},[$(Z,{type:"mdi",path:t(Qe)},null,8,["path"])])],2)]),default:D(()=>[f("div",{class:d(t(e).progress)},[f("div",{class:d(t(e).correctAnswers),style:J({width:`${t(_).correctPercentage}%`})},null,6),f("div",{class:d(t(e).wrongAnswers),style:J({width:`${t(_).wrongPercentage}%`})},null,6)],2),t(r)?(g(),k("div",{key:0,class:d(t(e).question)},[f("div",{class:d(t(e).text),onClick:O(le,["stop"])},[f("div",null,[$(Me,{section:t(r).section},null,8,["section"]),f("div",null,E(T(t(r).question)),1)])],2),f("div",{class:d(t(e).answers)},[t(r).type==="choice"?(g(!0),k(X,{key:0},Y(t(a),A=>(g(),k("div",{key:`${t(r).id}-${A.id}`,class:d(t(e).option)},[$(Se,{onClick:O(K=>re(A),["stop"]),class:d([t(e).button,ae(A)])},{default:D(()=>[ye(E(T(A.value)),1)]),_:2},1032,["onClick","class"])],2))),128)):M("",!0),t(r).type==="text"?(g(),k("div",{key:1,class:d([t(e).answer,t(h)?"":t(e).hiddenAnswer]),onClick:O(F,["stop"])},[(g(!0),k(X,null,Y(T(t(r).answer).split(`
`),(A,K)=>(g(),k("p",{key:K},E(A),1))),128))],2)):M("",!0)],2)],2)):M("",!0),t(r)?(g(),k("div",{key:1,onClick:O(ue,["stop"]),class:d([t(e).noteContainer,{[t(e).hidden]:!z.value}])},[t(r).note?(g(),k("div",{key:0,class:d(["scroll",[t(e).note,{[t(e).hidden]:!z.value}]])},[t(r).noteImage?(g(),k("img",{key:0,src:`/notes/${t(r).noteImage}`},null,8,Pe)):M("",!0),f("div",{innerHTML:T(t(r).note)},null,8,Re)],2)):M("",!0)],2)):M("",!0)]),_:1},8,["class"]))}}),Te="200ms",$e="_counter_1lkbj_4",Be="_question_1lkbj_8",Fe="_text_1lkbj_15",De="_answers_1lkbj_46",Ee="_option_1lkbj_56",Ge="_fadeOut_1lkbj_60",Le="_button_1lkbj_66",He="_correct_1lkbj_66",Ve="_success_1lkbj_1",Ke="_wrong_1lkbj_73",Ue="_next_1lkbj_80",We="_answer_1lkbj_46",Je="_hiddenAnswer_1lkbj_93",Xe="_navigation_1lkbj_96",Ye="_back_1lkbj_103",Ze="_forward_1lkbj_107",et="_disabled_1lkbj_116",tt="_progress_1lkbj_120",st="_correctAnswers_1lkbj_129",nt="_wrongAnswers_1lkbj_135",ot="_noteContainer_1lkbj_153",at="_hidden_1lkbj_93",rt="_note_1lkbj_153",it={pageFadeOutDuration:Te,counter:$e,question:Be,text:Fe,answers:De,option:Ee,fadeOut:Ge,button:Le,correct:He,"correct-blinking":"_correct-blinking_1lkbj_70",success:Ve,wrong:Ke,"wrong-fade":"_wrong-fade_1lkbj_77",next:Ue,answer:We,hiddenAnswer:Je,navigation:Xe,back:Ye,forward:Ze,disabled:et,progress:tt,correctAnswers:st,wrongAnswers:nt,noteContainer:ot,hidden:at,note:rt},lt={$style:it},_t=ze(Ne,[["__cssModules",lt]]);export{_t as default};
